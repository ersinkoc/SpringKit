{"version":3,"sources":["../src/core/config.ts","../src/core/physics.ts","../src/animation/loop.ts","../src/utils/math.ts","../src/utils/warnings.ts","../src/core/spring.ts","../src/core/spring-value.ts","../src/core/spring-group.ts","../src/animation/sequence.ts","../src/animation/trail.ts","../src/animation/decay.ts","../src/animation/keyframes.ts","../src/interpolation/interpolate.ts","../src/interpolation/color.ts","../src/gesture/drag.ts","../src/gesture/scroll.ts","../src/utils/color.ts","../src/core/MotionValue.ts","../src/svg/path.ts","../src/layout/flip.ts"],"names":["defaultConfig","springPresets","configFromDuration","ms","configFromBounce","bounce","simulateSpring","position","velocity","target","config","stiffness","damping","mass","restSpeed","restDelta","displacement","absDisplacement","absVelocity","dt","springForce","dampingForce","acceleration","newVelocity","newPosition","isRest","calculatePeriod","calculateDampingRatio","isUnderdamped","isCriticallyDamped","ratio","isOverdamped","AnimationState","AnimationLoop","id","cb","now","rawDelta","clampedDelta","listener","toRemove","ref","animation","i","existingId","callback","count","delta","globalLoop","clamp","value","min","max","actualMin","actualMax","lerp","a","b","mapRange","inMin","inMax","outMin","outMax","degToRad","degrees","radToDeg","radians","isDev","warnedMessages","warnOnce","message","validateSpringConfig","validateDragConfig","rubberBandFactor","bounds","validateDecayConfig","deceleration","clearWarnings","SpringAnimationImpl","from","to","resolve","temp","_now","result","spring","SpringValueImpl","initial","mergedConfig","originalOnUpdate","originalOnComplete","subscriber","createSpringValue","SpringGroupImpl","initialValues","key","springValue","values","promises","createSpringGroup","sequence","animations","createAnimation","parallel","stagger","items","animate","options","delay","startIndex","indices","used","offset","left","right","getDelay","_i","index","anim","delayMs","TrailImpl","followDelay","springConfig","targetValue","delayFrames","targetFrame","startFrame","framesToWait","s","unsubscribers","unsubscribe","createTrail","DecayAnimationImpl","decay","keyframes","times","onKeyframe","onComplete","onUpdate","normalizedKeyframes","v","keyframeCount","kf","currentIndex","isPlaying","isPaused","currentValue","destroyed","createSpring","animateToNext","targetKf","checkComplete","parseKeyframeArray","isKeyframeArray","defaultInterpolateOptions","InterpolationImpl","source","input","output","extrapolate","extrapolateLeft","extrapolateRight","mode","specificMode","fallbackMode","interpolate","ColorInterpolationImpl","colorStrings","c","r","g","color","hexMatch","hex","rgbMatch","rgbaMatch","hslMatch","h","l","gray","hue2rgb","p","q","t","interpolateColor","colors","defaultDragConfig","DragSpringImpl","element","newX","newY","factor","x","y","velocityX","velocityY","top","bottom","targetX","targetY","createDragSpring","defaultScrollConfig","ScrollSpringImpl","container","deltaX","deltaY","maxScrollX","maxScrollY","checkEnd","containerRect","elementRect","createScrollSpring","parseColor","hexToRgb","hslToRgb","rgbToHex","toHex","n","cleanHex","rgbToHsl","MotionValue","initialValue","newValue","event","e","createMotionValue","transformValue","transform","derived","inputRange","outputRange","normalized","createPathAnimation","autoPlay","totalLength","waitForRest","check","getPathLength","preparePathForAnimation","initialProgress","length","getPointAtProgress","path","progress","measureElement","rect","createFlip","first","last","size","deltaWidth","deltaHeight","cancelled","originalTransform","originalTransformOrigin","applyTransform","invertedT","transforms","scaleX","scaleY","cleanup","flip","mutate","flipBatch","elements","firstStates","el"],"mappings":"AA+BO,IAAMA,CAAAA,CAA8B,CACzC,SAAA,CAAW,GAAA,CACX,QAAS,EAAA,CACT,IAAA,CAAM,CAAA,CACN,QAAA,CAAU,CAAA,CACV,SAAA,CAAW,IACX,SAAA,CAAW,GAAA,CACX,MAAO,KACT,CAAA,CA2BaC,GAA+B,CAC1C,OAAA,CAAS,CAAE,SAAA,CAAW,GAAA,CAAK,OAAA,CAAS,EAAG,CAAA,CACvC,MAAA,CAAQ,CAAE,SAAA,CAAW,GAAA,CAAK,QAAS,EAAG,CAAA,CACtC,MAAA,CAAQ,CAAE,SAAA,CAAW,GAAA,CAAK,QAAS,EAAG,CAAA,CACtC,KAAA,CAAO,CAAE,SAAA,CAAW,GAAA,CAAK,QAAS,EAAG,CAAA,CACrC,IAAA,CAAM,CAAE,SAAA,CAAW,GAAA,CAAK,QAAS,EAAG,CAAA,CACpC,SAAU,CAAE,SAAA,CAAW,IAAK,OAAA,CAAS,GAAI,CAAA,CACzC,MAAA,CAAQ,CAAE,SAAA,CAAW,IAAK,OAAA,CAAS,CAAE,EACrC,QAAA,CAAU,CAAE,UAAW,GAAA,CAAK,OAAA,CAAS,EAAG,CAC1C,EAOO,SAASC,GAAmBC,CAAAA,CAA0B,CAC3D,OAAIA,CAAAA,CAAK,GAAA,CACA,CAAE,SAAA,CAAW,GAAA,CAAK,OAAA,CAAS,EAAG,CAAA,CAEnCA,CAAAA,CAAK,IACA,CAAE,SAAA,CAAW,GAAA,CAAK,OAAA,CAAS,EAAG,CAAA,CAEhC,CAAE,SAAA,CAAW,EAAA,CAAI,OAAA,CAAS,EAAG,CACtC,CAOO,SAASC,EAAAA,CAAiBC,CAAAA,CAA8B,CAC7D,OAAIA,CAAAA,EAAU,EACL,CAAE,SAAA,CAAW,GAAA,CAAK,OAAA,CAAS,EAAG,CAAA,CAEnCA,GAAU,GAAA,CACL,CAAE,UAAW,GAAA,CAAK,OAAA,CAAS,EAAG,CAAA,CAEhC,CAAE,SAAA,CAAW,GAAA,CAAK,OAAA,CAAS,CAAE,CACtC,CCrEO,SAASC,EACdC,CAAAA,CACAC,CAAAA,CACAC,EACAC,CAAAA,CACkB,CAClB,GAAM,CACJ,SAAA,CAAAC,CAAAA,CAAY,IACZ,OAAA,CAAAC,CAAAA,CAAU,EAAA,CACV,IAAA,CAAAC,CAAAA,CAAO,CAAA,CACP,UAAAC,CAAAA,CAAY,GAAA,CACZ,SAAA,CAAAC,CAAAA,CAAY,GACd,CAAA,CAAIL,EAGEM,CAAAA,CAAeP,CAAAA,CAASF,EACxBU,CAAAA,CAAkB,IAAA,CAAK,IAAID,CAAY,CAAA,CACvCE,CAAAA,CAAc,IAAA,CAAK,GAAA,CAAIV,CAAQ,EAIrC,GAAIS,CAAAA,EAAmBF,GAAaG,CAAAA,EAAeJ,CAAAA,CACjD,OAAO,CACL,QAAA,CAAUL,CAAAA,CACV,QAAA,CAAU,CAAA,CACV,MAAA,CAAQ,IACV,CAAA,CAKF,IAAMU,EAAK,CAAA,CAAI,EAAA,CAGTC,EAAcT,CAAAA,CAAYK,CAAAA,CAI1BK,CAAAA,CAAeH,CAAAA,CAAc,IAAA,CAASN,CAAAA,CAAUJ,EAAW,CAAA,CAG3Dc,CAAAA,CAAAA,CAAgBF,CAAAA,CAAcC,CAAAA,EAAgBR,CAAAA,CAK9CU,CAAAA,CAAcf,EAAWc,CAAAA,CAAeH,CAAAA,CACxCK,CAAAA,CAAcjB,CAAAA,CAAWgB,CAAAA,CAAcJ,CAAAA,CAMvCM,EACJR,CAAAA,EAAmBF,CAAAA,EACnB,KAAK,GAAA,CAAIQ,CAAW,GAAKT,CAAAA,CAE3B,OAAO,CACL,QAAA,CAAUU,CAAAA,CACV,QAAA,CAAUD,EACV,MAAA,CAAAE,CACF,CACF,CAQO,SAASC,GAAgBf,CAAAA,CAAmBE,CAAAA,CAAsB,CACvE,OAAO,CAAA,CAAI,IAAA,CAAK,GAAK,IAAA,CAAK,IAAA,CAAKA,EAAOF,CAAS,CACjD,CASO,SAASgB,CAAAA,CACdf,CAAAA,CACAD,CAAAA,CACAE,CAAAA,CACQ,CACR,OAAOD,CAAAA,EAAW,CAAA,CAAI,IAAA,CAAK,IAAA,CAAKD,CAAAA,CAAYE,CAAI,EAClD,CAOO,SAASe,EAAAA,CAAclB,CAAAA,CAA+B,CAC3D,GAAM,CAAE,SAAA,CAAAC,CAAAA,CAAY,IAAK,OAAA,CAAAC,CAAAA,CAAU,GAAI,IAAA,CAAAC,CAAAA,CAAO,CAAE,CAAA,CAAIH,CAAAA,CAEpD,OADciB,EAAsBf,CAAAA,CAASD,CAAAA,CAAWE,CAAI,CAAA,CAC7C,CACjB,CAOO,SAASgB,EAAAA,CAAmBnB,CAAAA,CAA+B,CAChE,GAAM,CAAE,UAAAC,CAAAA,CAAY,GAAA,CAAK,QAAAC,CAAAA,CAAU,EAAA,CAAI,KAAAC,CAAAA,CAAO,CAAE,CAAA,CAAIH,CAAAA,CAC9CoB,CAAAA,CAAQH,CAAAA,CAAsBf,EAASD,CAAAA,CAAWE,CAAI,CAAA,CAC5D,OAAO,IAAA,CAAK,GAAA,CAAIiB,EAAQ,CAAC,CAAA,CAAI,IAC/B,CAOO,SAASC,EAAAA,CAAarB,EAA+B,CAC1D,GAAM,CAAE,SAAA,CAAAC,CAAAA,CAAY,IAAK,OAAA,CAAAC,CAAAA,CAAU,EAAA,CAAI,IAAA,CAAAC,CAAAA,CAAO,CAAE,EAAIH,CAAAA,CAEpD,OADciB,EAAsBf,CAAAA,CAASD,CAAAA,CAAWE,CAAI,CAAA,CAC7C,CACjB,CCzJO,IAAKmB,CAAAA,CAAAA,CAAAA,CAAAA,GACVA,CAAAA,CAAA,KAAO,MAAA,CACPA,CAAAA,CAAA,QAAU,SAAA,CACVA,CAAAA,CAAA,OAAS,QAAA,CACTA,CAAAA,CAAA,QAAA,CAAW,UAAA,CAJDA,CAAAA,CAAAA,EAAAA,CAAAA,EAAA,EAAA,MA4CNC,CAAAA,CAAN,KAAoB,CAApB,WAAA,EAAA,CACE,IAAA,CAAQ,UAAA,CAAa,IAAI,GAAA,CACzB,IAAA,CAAQ,YAAA,CAAe,IAAI,OAAA,CAC3B,IAAA,CAAQ,MAAuB,IAAA,CAC/B,IAAA,CAAQ,UAAY,KAAA,CACpB,IAAA,CAAQ,SAAmB,CAAA,CAC3B,IAAA,CAAQ,MAAA,CAAS,CAAA,CACjB,IAAA,CAAQ,KAAA,CAAQ,IAAI,OAAA,CACpB,IAAA,CAAQ,eAAiB,IAAI,GAAA,CAG7B,KAAQ,QAAA,CAAW,IAAI,oBAAA,CAA8BC,CAAAA,EAAO,CAC1D,IAAA,CAAK,iBAAiB,OAAA,CAASC,CAAAA,EAAOA,EAAGD,CAAE,CAAC,EAC9C,CAAC,CAAA,CACD,IAAA,CAAQ,gBAAA,CAAmB,IAAI,GAAA,CAwF/B,KAAQ,IAAA,CAAO,IAAY,CACzB,IAAME,CAAAA,CAAM,WAAA,CAAY,KAAI,CAItBC,CAAAA,CAAWD,CAAAA,CAAM,IAAA,CAAK,QAAA,CACtBE,CAAAA,CAAe,KAAK,GAAA,CAAID,CAAAA,CAAU,EAAc,CAAA,CACtD,IAAA,CAAK,SAAWD,CAAAA,CAGhB,IAAA,IAAWG,CAAAA,IAAY,IAAA,CAAK,cAAA,CAC1BA,CAAAA,CAASD,CAAY,CAAA,CAIvB,IAAME,EAAkC,EAAC,CAEzC,QAAWC,CAAAA,IAAO,IAAA,CAAK,UAAA,CAAY,CACjC,IAAMC,CAAAA,CAAYD,EAAI,KAAA,EAAM,CAG5B,GAAI,CAACC,CAAAA,CAAW,CACdF,CAAAA,CAAS,IAAA,CAAKC,CAAG,CAAA,CACjB,QACF,CAEAC,EAAU,MAAA,CAAON,CAAG,CAAA,CAEhBM,CAAAA,CAAU,UAAA,EAAW,GACvBF,EAAS,IAAA,CAAKC,CAAG,CAAA,CACjB,IAAA,CAAK,YAAA,CAAa,MAAA,CAAOC,CAAS,CAAA,CAClC,IAAA,CAAK,MAAM,MAAA,CAAOA,CAAS,GAE/B,CAGA,IAAA,IAASC,CAAAA,CAAI,CAAA,CAAGA,CAAAA,CAAIH,CAAAA,CAAS,OAAQG,CAAAA,EAAAA,CACnC,IAAA,CAAK,WAAW,MAAA,CAAOH,CAAAA,CAASG,CAAC,CAAE,CAAA,CAIjC,IAAA,CAAK,UAAA,CAAW,IAAA,CAAO,CAAA,CACzB,KAAK,KAAA,CAAQ,qBAAA,CAAsB,KAAK,IAAI,CAAA,CAE5C,KAAK,IAAA,GAET,EAAA,CA/HA,GAAA,CAAID,CAAAA,CAA+B,CAEjC,IAAME,CAAAA,CAAa,IAAA,CAAK,KAAA,CAAM,GAAA,CAAIF,CAAS,CAAA,CAC3C,GAAIE,CAAAA,GAAe,MAAA,CAAW,OAAOA,CAAAA,CAErC,IAAMV,CAAAA,CAAK,KAAK,MAAA,EAAA,CACVO,CAAAA,CAAM,IAAI,OAAA,CAAQC,CAAS,EACjC,OAAA,IAAA,CAAK,UAAA,CAAW,GAAA,CAAID,CAAG,CAAA,CACvB,IAAA,CAAK,aAAa,GAAA,CAAIC,CAAAA,CAAWD,CAAG,CAAA,CACpC,IAAA,CAAK,MAAM,GAAA,CAAIC,CAAAA,CAAWR,CAAE,CAAA,CAG5B,IAAA,CAAK,QAAA,CAAS,SAASQ,CAAAA,CAAWR,CAAE,EAEpC,IAAA,CAAK,KAAA,GACEA,CACT,CAKA,MAAA,CAAOQ,CAAAA,CAA6B,CAClC,IAAMD,EAAM,IAAA,CAAK,YAAA,CAAa,GAAA,CAAIC,CAAS,CAAA,CACvCD,CAAAA,GACF,KAAK,UAAA,CAAW,MAAA,CAAOA,CAAG,CAAA,CAC1B,IAAA,CAAK,YAAA,CAAa,OAAOC,CAAS,CAAA,CAClC,KAAK,KAAA,CAAM,MAAA,CAAOA,CAAS,CAAA,CAAA,CAGzB,IAAA,CAAK,UAAA,CAAW,IAAA,GAAS,CAAA,EAC3B,IAAA,CAAK,OAET,CAMA,UAAUG,CAAAA,CAAuC,CAC/C,YAAK,gBAAA,CAAiB,GAAA,CAAIA,CAAQ,CAAA,CAC3B,IAAM,IAAA,CAAK,iBAAiB,MAAA,CAAOA,CAAQ,CACpD,CAMA,OAAA,CAAQA,EAAmD,CACzD,OAAA,IAAA,CAAK,cAAA,CAAe,GAAA,CAAIA,CAAQ,CAAA,CACzB,IAAM,IAAA,CAAK,cAAA,CAAe,MAAA,CAAOA,CAAQ,CAClD,CAKQ,OAAc,CAChB,IAAA,CAAK,SAAA,GACT,IAAA,CAAK,SAAA,CAAY,IAAA,CACjB,KAAK,QAAA,CAAW,WAAA,CAAY,KAAI,CAChC,IAAA,CAAK,MAAK,EACZ,CAKQ,IAAA,EAAa,CACnB,IAAA,CAAK,SAAA,CAAY,MACb,IAAA,CAAK,KAAA,GAAU,OACjB,oBAAA,CAAqB,IAAA,CAAK,KAAK,CAAA,CAC/B,IAAA,CAAK,KAAA,CAAQ,IAAA,EAEjB,CA6DA,IAAI,MAAe,CACjB,OAAO,KAAK,UAAA,CAAW,IACzB,CAKA,aAAA,EAAwB,CACtB,IAAIC,CAAAA,CAAQ,CAAA,CACZ,IAAA,IAAWL,KAAO,IAAA,CAAK,UAAA,CACjBA,CAAAA,CAAI,KAAA,EAAM,EAAGK,CAAAA,EAAAA,CAEnB,OAAOA,CACT,CAKA,MAAA,EAAiB,CACf,IAAMC,CAAAA,CAAQ,YAAY,GAAA,EAAI,CAAI,KAAK,QAAA,CACvC,OAAOA,EAAQ,CAAA,CAAI,IAAA,CAAK,KAAA,CAAM,GAAA,CAAOA,CAAK,CAAA,CAAI,EAChD,CACF,CAAA,CAKaC,EAAa,IAAIf,EC5NvB,SAASgB,CAAAA,CAAMC,CAAAA,CAAeC,CAAAA,CAAaC,CAAAA,CAAqB,CAErE,IAAMC,EAAY,IAAA,CAAK,GAAA,CAAIF,EAAKC,CAAG,CAAA,CAC7BE,EAAY,IAAA,CAAK,GAAA,CAAIH,CAAAA,CAAKC,CAAG,CAAA,CACnC,OAAO,KAAK,GAAA,CAAIC,CAAAA,CAAW,IAAA,CAAK,GAAA,CAAIC,CAAAA,CAAWJ,CAAK,CAAC,CACvD,CASO,SAASK,EAAAA,CAAKC,CAAAA,CAAWC,CAAAA,CAAW,EAAmB,CAC5D,OAAOD,GAAKC,CAAAA,CAAID,CAAAA,EAAK,CACvB,CAWO,SAASE,EAAAA,CACdR,CAAAA,CACAS,CAAAA,CACAC,CAAAA,CACAC,EACAC,CAAAA,CACQ,CACR,QAASZ,CAAAA,CAAQS,CAAAA,GAAUG,EAASD,CAAAA,CAAAA,EAAYD,CAAAA,CAAQD,CAAAA,CAAAA,CAASE,CACnE,CAOO,SAASE,GAASC,CAAAA,CAAyB,CAChD,OAAQA,CAAAA,CAAU,IAAA,CAAK,GAAM,GAC/B,CAOO,SAASC,EAAAA,CAASC,CAAAA,CAAyB,CAChD,OAAQA,CAAAA,CAAU,GAAA,CAAO,IAAA,CAAK,EAChC,CCvDA,IAAMC,EAAQ,OAAO,OAAA,CAAY,GAAA,EAAe,OAAA,CAAQ,GAAA,EAAK,QAAA,GAAa,aACpEC,CAAAA,CAAiB,IAAI,IAK3B,SAASC,CAAAA,CAASC,EAAuB,CACnC,CAACH,CAAAA,EAASC,CAAAA,CAAe,GAAA,CAAIE,CAAO,IACxCF,CAAAA,CAAe,GAAA,CAAIE,CAAO,CAAA,CAC1B,OAAA,CAAQ,IAAA,CAAK,eAAeA,CAAO,CAAA,CAAE,CAAA,EACvC,CAKO,SAASC,CAAAA,CAAqB7D,EAI5B,CACP,GAAI,CAACyD,CAAAA,CAAO,OAEZ,GAAM,CAAE,SAAA,CAAAxD,CAAAA,CAAY,GAAA,CAAK,OAAA,CAAAC,CAAAA,CAAU,GAAI,IAAA,CAAAC,CAAAA,CAAO,CAAE,CAAA,CAAIH,CAAAA,CAGhDC,CAAAA,CAAY,KAAOC,CAAAA,CAAU,EAAA,EAC/ByD,CAAAA,CACE,CAAA,gBAAA,EAAmB1D,CAAS,CAAA,oBAAA,EAAuBC,CAAO,CAAA,2EAAA,EACf,IAAA,CAAK,MAAMD,CAAAA,CAAY,EAAE,CAAC,CAAA,wBAAA,CACvE,CAAA,CAIEA,CAAAA,CAAY,EAAA,EACd0D,CAAAA,CACE,CAAA,oBAAA,EAAuB1D,CAAS,CAAA,6FAAA,CAElC,CAAA,CAIEC,EAAUD,CAAAA,EACZ0D,CAAAA,CACE,YAAYzD,CAAO,CAAA,4BAAA,EAA+BD,CAAS,CAAA,sFAAA,CAE7D,CAAA,CAIEE,CAAAA,EAAQ,GACVwD,CAAAA,CACE,CAAA,2BAAA,EAA8BxD,CAAI,CAAA,0BAAA,CACpC,CAAA,CAIEA,EAAO,EAAA,EACTwD,CAAAA,CACE,CAAA,WAAA,EAAcxD,CAAI,CAAA,2FAAA,CAEpB,EAEJ,CAKO,SAAS2D,EAAAA,CAAmB9D,CAAAA,CAQ1B,CACP,GAAI,CAACyD,EAAO,OAEZ,GAAM,CAAE,gBAAA,CAAAM,CAAAA,CAAkB,MAAA,CAAAC,CAAO,CAAA,CAAIhE,CAAAA,CAGjC+D,IAAqB,MAAA,GAAcA,CAAAA,CAAmB,GAAKA,CAAAA,CAAmB,CAAA,CAAA,EAChFJ,CAAAA,CACE,CAAA,gDAAA,EAAmDI,CAAgB,CAAA,0DAAA,CAErE,EAIEC,CAAAA,GACEA,CAAAA,CAAO,OAAS,MAAA,EAAaA,CAAAA,CAAO,QAAU,MAAA,EAAaA,CAAAA,CAAO,IAAA,CAAOA,CAAAA,CAAO,KAAA,EAClFL,CAAAA,CACE,mCAAmCK,CAAAA,CAAO,IAAI,cAAcA,CAAAA,CAAO,KAAK,wCAE1E,CAAA,CAEEA,CAAAA,CAAO,GAAA,GAAQ,MAAA,EAAaA,CAAAA,CAAO,MAAA,GAAW,QAAaA,CAAAA,CAAO,GAAA,CAAMA,CAAAA,CAAO,MAAA,EACjFL,CAAAA,CACE,CAAA,+BAAA,EAAkCK,EAAO,GAAG,CAAA,YAAA,EAAeA,CAAAA,CAAO,MAAM,CAAA,sCAAA,CAE1E,CAAA,EAGN,CAKO,SAASC,CAAAA,CAAoBjE,EAG3B,CACP,GAAI,CAACyD,CAAAA,CAAO,OAEZ,GAAM,CAAE,QAAA,CAAA3D,CAAAA,CAAU,aAAAoE,CAAAA,CAAe,IAAM,EAAIlE,CAAAA,CAGvCF,CAAAA,GAAa,GACf6D,CAAAA,CACE,sFAEF,CAAA,CAAA,CAIEO,CAAAA,EAAgB,CAAA,EAAKA,CAAAA,EAAgB,IACvCP,CAAAA,CACE,CAAA,wDAAA,EAA2DO,CAAY,CAAA,gCAAA,CAEzE,EAEJ,CAKO,SAASC,EAAAA,EAAsB,CACpCT,CAAAA,CAAe,KAAA,GACjB,CCnGA,IAAMU,CAAAA,CAAN,KAAiE,CAc/D,WAAA,CACEC,CAAAA,CACAC,EACAtE,CAAAA,CAAuB,EAAC,CACxB,CAbF,IAAA,CAAQ,KAAA,CAAwB,OAChC,IAAA,CAAQ,eAAA,CAAuC,KAc7C6D,CAAAA,CAAqB7D,CAAM,EAE3B,IAAA,CAAK,IAAA,CAAOqE,CAAAA,CACZ,IAAA,CAAK,EAAA,CAAKC,CAAAA,CACV,KAAK,WAAA,CAAcD,CAAAA,CACnB,KAAK,SAAA,CAAYC,CAAAA,CACjB,KAAK,QAAA,CAAWD,CAAAA,CAChB,IAAA,CAAK,QAAA,CAAWrE,CAAAA,CAAO,QAAA,EAAY,EACnC,IAAA,CAAK,MAAA,CAASsE,EACd,IAAA,CAAK,MAAA,CAAS,CACZ,GAAGhF,CAAAA,CACH,GAAGU,CAAAA,CACH,SAAA,CAAWA,CAAAA,CAAO,WAAaV,CAAAA,CAAc,SAAA,CAC7C,OAAA,CAASU,CAAAA,CAAO,OAAA,EAAWV,CAAAA,CAAc,QACzC,IAAA,CAAMU,CAAAA,CAAO,IAAA,EAAQV,CAAAA,CAAc,IAAA,CACnC,SAAA,CAAWU,EAAO,SAAA,EAAaV,CAAAA,CAAc,UAC7C,SAAA,CAAWU,CAAAA,CAAO,WAAaV,CAAAA,CAAc,SAC/C,CAAA,CAEA,IAAA,CAAK,QAAA,CAAW,IAAI,QAASiF,CAAAA,EAAY,CACvC,KAAK,eAAA,CAAkBA,EACzB,CAAC,EACH,CAEA,KAAA,EAAyB,CACvB,OAAI,IAAA,CAAK,QAAU,SAAA,CAA+B,IAAA,EAElD,KAAK,KAAA,CAAQ,SAAA,CACb,KAAK,MAAA,CAAO,OAAA,IAAU,CACtBjC,CAAAA,CAAW,GAAA,CAAI,IAAI,EACZ,IAAA,CACT,CAEA,IAAA,EAAa,CACX,IAAA,CAAK,KAAA,CAAQ,OACbA,CAAAA,CAAW,MAAA,CAAO,IAAI,EACxB,CAEA,KAAA,EAAc,CACR,IAAA,CAAK,KAAA,GAAU,YACjB,IAAA,CAAK,KAAA,CAAQ,SACbA,CAAAA,CAAW,MAAA,CAAO,IAAI,CAAA,EAE1B,CAEA,MAAA,EAAe,CACT,IAAA,CAAK,KAAA,GAAU,WACjB,IAAA,CAAK,KAAA,CAAQ,UACbA,CAAAA,CAAW,GAAA,CAAI,IAAI,CAAA,EAEvB,CAEA,OAAA,EAAgB,CACd,IAAMkC,CAAAA,CAAO,KAAK,IAAA,CAClB,IAAA,CAAK,KAAO,IAAA,CAAK,EAAA,CACjB,IAAA,CAAK,EAAA,CAAKA,CAAAA,CACV,IAAA,CAAK,YAAc,IAAA,CAAK,IAAA,CACxB,IAAA,CAAK,SAAA,CAAY,IAAA,CAAK,EAAA,CACtB,KAAK,MAAA,CAAS,IAAA,CAAK,GACrB,CAEA,GAAA,CAAIF,CAAAA,CAAkB,CACpB,IAAA,CAAK,EAAA,CAAKA,EACV,IAAA,CAAK,SAAA,CAAYA,EACjB,IAAA,CAAK,MAAA,CAASA,EAChB,CAEA,eAAA,CAAgBA,CAAAA,CAAYxE,EAAyB,CAEnD,IAAA,CAAK,KAAO,IAAA,CAAK,QAAA,CACjB,KAAK,WAAA,CAAc,IAAA,CAAK,QAAA,CACxB,IAAA,CAAK,EAAA,CAAKwE,CAAAA,CACV,KAAK,SAAA,CAAYA,CAAAA,CACjB,KAAK,MAAA,CAASA,CAAAA,CAGVxE,IAAa,MAAA,GACf,IAAA,CAAK,QAAA,CAAWA,CAAAA,CAAAA,CAGd,IAAA,CAAK,KAAA,GAAU,WACjB,IAAA,CAAK,KAAA,GAET,CAEA,MAAA,CAAO2E,CAAAA,CAAoB,CACzB,GAAI,IAAA,CAAK,KAAA,GAAU,SAAA,CAAwB,OAE3C,IAAMC,EAAS9E,CAAAA,CACb,IAAA,CAAK,SACL,IAAA,CAAK,QAAA,CACL,KAAK,MAAA,CACL,IAAA,CAAK,MACP,CAAA,CAMA,GAJA,IAAA,CAAK,SAAW8E,CAAAA,CAAO,QAAA,CACvB,KAAK,QAAA,CAAWA,CAAAA,CAAO,SAGnB,IAAA,CAAK,MAAA,CAAO,KAAA,CAAO,CACrB,IAAMjC,CAAAA,CAAM,KAAK,GAAA,CAAI,IAAA,CAAK,YAAa,IAAA,CAAK,SAAS,EAC/CC,CAAAA,CAAM,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,WAAA,CAAa,IAAA,CAAK,SAAS,CAAA,CACrD,IAAA,CAAK,QAAA,CAAWH,CAAAA,CAAM,IAAA,CAAK,QAAA,CAAUE,EAAKC,CAAG,EAC/C,CAGA,IAAA,CAAK,MAAA,CAAO,QAAA,GAAW,KAAK,QAAQ,CAAA,CAGhCgC,EAAO,MAAA,GACT,IAAA,CAAK,MAAQ,UAAA,CACbpC,CAAAA,CAAW,MAAA,CAAO,IAAI,CAAA,CACtB,IAAA,CAAK,SAAW,IAAA,CAAK,MAAA,CACrB,KAAK,MAAA,CAAO,QAAA,GAAW,KAAK,QAAQ,CAAA,CACpC,IAAA,CAAK,MAAA,CAAO,UAAA,IAAa,CACzB,KAAK,MAAA,CAAO,MAAA,KACZ,IAAA,CAAK,eAAA,MAET,CAEA,WAAA,EAAuB,CACrB,OAAO,IAAA,CAAK,KAAA,GAAU,SACxB,CAEA,QAAA,EAAoB,CAClB,OAAO,IAAA,CAAK,KAAA,GAAU,QACxB,CAEA,UAAA,EAAsB,CACpB,OAAO,IAAA,CAAK,KAAA,GAAU,UACxB,CAEA,QAAA,EAAmB,CACjB,OAAO,IAAA,CAAK,QACd,CAEA,WAAA,EAAsB,CACpB,OAAO,IAAA,CAAK,QACd,CAEA,OAAA,EAAgB,CACd,KAAK,IAAA,EAAK,CACV,KAAK,MAAA,CAAO,QAAA,CAAW,MAAA,CACvB,IAAA,CAAK,MAAA,CAAO,OAAA,CAAU,OACtB,IAAA,CAAK,MAAA,CAAO,WAAa,MAAA,CACzB,IAAA,CAAK,OAAO,MAAA,CAAS,OACvB,CACF,CAAA,CAqBO,SAASqC,CAAAA,CACdN,EACAC,CAAAA,CACAtE,CAAAA,CACiB,CACjB,OAAO,IAAIoE,CAAAA,CAAoBC,EAAMC,CAAAA,CAAItE,CAAM,CACjD,CC7MA,IAAM4E,CAAAA,CAAN,KAA6C,CAQ3C,WAAA,CAAYC,EAAiB7E,CAAAA,CAAuB,GAAI,CALxD,IAAA,CAAQ,gBAAA,CAA2C,IAAA,CACnD,IAAA,CAAQ,WAAA,CAAc,IAAI,GAAA,CAC1B,IAAA,CAAQ,gBAAuC,IAAA,CAI7C,IAAA,CAAK,MAAQ6E,CAAAA,CACb,IAAA,CAAK,MAAA,CAAS,CAAE,GAAGvF,CAAAA,CAAe,GAAGU,CAAO,CAAA,CAE5C,KAAK,eAAA,CAAkB,IAAI,QAASuE,CAAAA,EAAY,CAC9C,IAAA,CAAK,eAAA,CAAkBA,EACzB,CAAC,EACH,CAEA,GAAA,EAAc,CACZ,OAAO,IAAA,CAAK,KACd,CAEA,WAAA,EAAsB,CACpB,OAAO,IAAA,CAAK,gBAAA,EAAkB,WAAA,IAAiB,CACjD,CAEA,IAAID,CAAAA,CAAYtE,CAAAA,CAAgC,EAAC,CAAS,CAEpD,IAAA,CAAK,gBAAA,GACP,IAAA,CAAK,gBAAA,CAAiB,SAAQ,CAC9B,IAAA,CAAK,iBAAmB,IAAA,CAAA,CAI1B,IAAA,CAAK,gBAAkB,IAAI,OAAA,CAASuE,CAAAA,EAAY,CAC9C,IAAA,CAAK,eAAA,CAAkBA,EACzB,CAAC,CAAA,CAGD,IAAMO,CAAAA,CAAe,CAAE,GAAG,IAAA,CAAK,MAAA,CAAQ,GAAG9E,CAAO,CAAA,CAC3C+E,CAAAA,CAAmBD,EAAa,QAAA,CAChCE,CAAAA,CAAqBF,CAAAA,CAAa,UAAA,CAExC,IAAA,CAAK,gBAAA,CAAmBH,EAAO,IAAA,CAAK,KAAA,CAAOL,CAAAA,CAAI,CAC7C,GAAGQ,CAAAA,CACH,SAAWtC,CAAAA,EAAU,CACnB,KAAK,KAAA,CAAQA,CAAAA,CACb,KAAK,MAAA,EAAO,CAEZuC,CAAAA,GAAmBvC,CAAK,EAC1B,CAAA,CACA,WAAY,IAAM,CAChBwC,KAAqB,CACjB,IAAA,CAAK,iBACP,IAAA,CAAK,eAAA,GAET,CACF,CAAC,CAAA,CAED,KAAK,gBAAA,CAAiB,KAAA,GACxB,CAEA,IAAA,CAAKV,EAAkB,CACjB,IAAA,CAAK,gBAAA,GACP,IAAA,CAAK,gBAAA,CAAiB,OAAA,GACtB,IAAA,CAAK,gBAAA,CAAmB,IAAA,CAAA,CAE1B,IAAA,CAAK,KAAA,CAAQA,CAAAA,CACb,KAAK,MAAA,GACP,CAEA,IAAA,EAAa,CACP,IAAA,CAAK,mBACP,IAAA,CAAK,gBAAA,CAAiB,SAAQ,CAC9B,IAAA,CAAK,iBAAmB,IAAA,CAAA,CAEtB,IAAA,CAAK,eAAA,EACP,IAAA,CAAK,eAAA,GAET,CAEA,SAAA,CAAUtE,CAAAA,CAAqC,CAC7C,IAAA,CAAK,MAAA,CAAS,CAAE,GAAG,IAAA,CAAK,MAAA,CAAQ,GAAGA,CAAO,EAC5C,CAEA,SAAA,CAAUmC,CAAAA,CAA+C,CACvD,OAAA,IAAA,CAAK,WAAA,CAAY,IAAIA,CAAQ,CAAA,CAG7BA,CAAAA,CAAS,IAAA,CAAK,KAAK,CAAA,CAEZ,IAAM,CACX,IAAA,CAAK,WAAA,CAAY,MAAA,CAAOA,CAAQ,EAClC,CACF,CAEA,WAAA,EAAuB,CACrB,OAAO,IAAA,CAAK,gBAAA,EAAkB,aAAY,EAAK,KACjD,CAEA,IAAI,QAAA,EAA0B,CAC5B,OAAO,IAAA,CAAK,eACd,CAEQ,MAAA,EAAe,CACrB,QAAW8C,CAAAA,IAAc,IAAA,CAAK,YAC5BA,CAAAA,CAAW,IAAA,CAAK,KAAK,EAEzB,CAEA,OAAA,EAAgB,CACd,IAAA,CAAK,gBAAA,EAAkB,SAAQ,CAC/B,IAAA,CAAK,iBAAmB,IAAA,CACxB,IAAA,CAAK,YAAY,KAAA,GACnB,CACF,CAAA,CAqBO,SAASC,CAAAA,CACdL,EACA7E,CAAAA,CACa,CACb,OAAO,IAAI4E,CAAAA,CAAgBC,CAAAA,CAAS7E,CAAM,CAC5C,CChJA,IAAMmF,CAAAA,CAAN,KAAkF,CAOhF,YAAYC,CAAAA,CAAkBpF,CAAAA,CAAuB,EAAC,CAAG,CAJzD,KAAQ,WAAA,CAAc,IAAI,GAAA,CAC1B,IAAA,CAAQ,eAAA,CAAuC,IAAA,CAI7C,KAAK,MAAA,CAAS,CAAE,GAAGV,CAAAA,CAAe,GAAGU,CAAO,EAG5C,IAAA,CAAK,MAAA,CAAS,IAAI,GAAA,CAClB,IAAA,GAAW,CAACqF,EAAK7C,CAAK,CAAA,GAAK,OAAO,OAAA,CAAQ4C,CAAa,EAAG,CACxD,IAAME,CAAAA,CAAcJ,CAAAA,CAAkB1C,CAAAA,CAAO,IAAA,CAAK,MAAM,CAAA,CACxD8C,CAAAA,CAAY,SAAA,CAAU,IAAM,IAAA,CAAK,MAAA,EAAQ,CAAA,CACzC,IAAA,CAAK,MAAA,CAAO,GAAA,CAAID,CAAAA,CAAgBC,CAAW,EAC7C,CAEA,IAAA,CAAK,gBAAkB,OAAA,CAAQ,OAAA,GAG/B,IAAA,CAAK,YAAA,GACP,CAEQ,YAAA,EAAqB,CAC3B,KAAK,eAAA,CAAkB,IAAI,QAASf,CAAAA,EAAY,CAC9C,KAAK,eAAA,CAAkBA,EACzB,CAAC,EACH,CAEA,GAAA,EAAS,CACP,IAAMG,CAAAA,CAAS,EAAC,CAChB,IAAA,GAAW,CAACW,CAAAA,CAAKC,CAAW,CAAA,GAAK,IAAA,CAAK,MAAA,CACnCZ,CAAAA,CAAkCW,CAAa,CAAA,CAAIC,CAAAA,CAAY,GAAA,EAAI,CAEtE,OAAOZ,CACT,CAEA,QAAA,CAASW,CAAAA,CAAsB,CAC7B,OAAO,IAAA,CAAK,MAAA,CAAO,IAAIA,CAAG,CAAA,EAAG,KAAI,EAAK,CACxC,CAEA,GAAA,CAAIE,CAAAA,CAAoBvF,CAAAA,CAAgC,EAAC,CAAS,CAEhE,KAAK,YAAA,EAAa,CAElB,IAAMwF,CAAAA,CAA4B,GAElC,IAAA,GAAW,CAACH,CAAAA,CAAK7C,CAAK,CAAA,GAAK,MAAA,CAAO,QAAQ+C,CAAM,CAAA,CAAG,CACjD,IAAMD,CAAAA,CAAc,KAAK,MAAA,CAAO,GAAA,CAAID,CAAc,CAAA,CAC9CC,CAAAA,GACFA,CAAAA,CAAY,IAAI9C,CAAAA,CAAOxC,CAAM,CAAA,CAC7BwF,CAAAA,CAAS,IAAA,CAAKF,CAAAA,CAAY,QAAQ,CAAA,EAEtC,CAGA,OAAA,CAAQ,GAAA,CAAIE,CAAQ,CAAA,CAAE,KAAK,IAAM,CAC3B,KAAK,eAAA,EACP,IAAA,CAAK,kBAET,CAAC,EACH,CAEA,IAAA,CAAKD,CAAAA,CAA0B,CAC7B,IAAA,GAAW,CAACF,EAAK7C,CAAK,CAAA,GAAK,OAAO,OAAA,CAAQ+C,CAAM,CAAA,CAAG,CACjD,IAAMD,CAAAA,CAAc,KAAK,MAAA,CAAO,GAAA,CAAID,CAAc,CAAA,CAC9CC,CAAAA,EACFA,EAAY,IAAA,CAAK9C,CAAK,EAE1B,CAEF,CAEA,SAAA,CAAUL,EAA2C,CACnD,OAAA,IAAA,CAAK,WAAA,CAAY,GAAA,CAAIA,CAAQ,CAAA,CAC7BA,EAAS,IAAA,CAAK,GAAA,EAAK,CAAA,CACZ,IAAM,IAAA,CAAK,YAAY,MAAA,CAAOA,CAAQ,CAC/C,CAEA,WAAA,EAAuB,CACrB,IAAA,IAAWmD,CAAAA,IAAe,IAAA,CAAK,MAAA,CAAO,MAAA,EAAO,CAC3C,GAAIA,CAAAA,CAAY,WAAA,GAAe,OAAO,KAAA,CAExC,OAAO,MACT,CAEA,IAAI,QAAA,EAA0B,CAC5B,OAAO,KAAK,eACd,CAEQ,QAAe,CACrB,IAAMC,EAAS,IAAA,CAAK,GAAA,EAAI,CACxB,IAAA,IAAWN,CAAAA,IAAc,IAAA,CAAK,YAC5BA,CAAAA,CAAWM,CAAM,EAErB,CAEA,OAAA,EAAgB,CACd,QAAWD,CAAAA,IAAe,IAAA,CAAK,MAAA,CAAO,MAAA,EAAO,CAC3CA,CAAAA,CAAY,SAAQ,CAEtB,IAAA,CAAK,YAAY,KAAA,GACnB,CACF,CAAA,CA0BO,SAASG,EAAAA,CACdL,CAAAA,CACApF,CAAAA,CACgB,CAChB,OAAO,IAAImF,CAAAA,CAAgBC,EAAepF,CAAM,CAClD,CCvIA,eAAsB0F,EAAAA,CACpBC,CAAAA,CACe,CACf,IAAA,IAAWC,CAAAA,IAAmBD,EAE5B,MADaC,CAAAA,GACF,SAEf,CAmBA,eAAsBC,EAAAA,CACpBF,CAAAA,CACe,CACf,IAAMH,CAAAA,CAAWG,CAAAA,CAAW,IAAKC,CAAAA,EAClBA,CAAAA,EAAgB,CACjB,QACb,CAAA,CACD,MAAM,QAAQ,GAAA,CAAIJ,CAAQ,EAC5B,CA2BA,eAAsBM,EAAAA,CACpBC,EACAC,CAAAA,CACAC,CAAAA,CAA0B,EAAC,CACZ,CACf,GAAM,CAAE,KAAA,CAAAC,CAAAA,CAAQ,CAAA,CAAG,IAAA,CAAA7B,CAAAA,CAAO,OAAQ,CAAA,CAAI4B,CAAAA,CAGlCE,EAAa,CAAA,CACb9B,CAAAA,GAAS,OAAQ8B,CAAAA,CAAaJ,CAAAA,CAAM,MAAA,CAAS,CAAA,CACxC1B,CAAAA,GAAS,QAAA,CAAU8B,EAAa,IAAA,CAAK,KAAA,CAAMJ,EAAM,MAAA,CAAS,CAAC,EAC3D,OAAO1B,CAAAA,EAAS,QAAA,GAAU8B,CAAAA,CAAa9B,CAAAA,CAAAA,CAGhD,IAAM+B,EAAoB,EAAC,CACrBC,CAAAA,CAAO,IAAI,GAAA,CAEjBD,CAAAA,CAAQ,KAAKD,CAAU,CAAA,CACvBE,CAAAA,CAAK,GAAA,CAAIF,CAAU,CAAA,CAEnB,QAASG,CAAAA,CAAS,CAAA,CAAGA,EAASP,CAAAA,CAAM,MAAA,CAAQO,IAAU,CACpD,IAAMC,CAAAA,CAAOJ,CAAAA,CAAaG,CAAAA,CACpBE,CAAAA,CAAQL,EAAaG,CAAAA,CAGvBE,CAAAA,CAAQT,EAAM,MAAA,EAAU,CAACM,EAAK,GAAA,CAAIG,CAAK,CAAA,GACzCJ,CAAAA,CAAQ,IAAA,CAAKI,CAAK,EAClBH,CAAAA,CAAK,GAAA,CAAIG,CAAK,CAAA,CAAA,CAIZD,CAAAA,EAAQ,GAAK,CAACF,CAAAA,CAAK,GAAA,CAAIE,CAAI,CAAA,GAC7BH,CAAAA,CAAQ,KAAKG,CAAI,CAAA,CACjBF,CAAAA,CAAK,GAAA,CAAIE,CAAI,CAAA,EAEjB,CAMA,IAAME,CAAAA,CAAW,OAAOP,CAAAA,EAAU,UAAA,CAAaA,CAAAA,CAASQ,GAAeR,CAAAA,CACjEP,CAAAA,CAAgC,EAAC,CAEvC,IAAA,IAAS1D,EAAI,CAAA,CAAGA,CAAAA,CAAImE,CAAAA,CAAQ,MAAA,CAAQnE,CAAAA,EAAAA,CAAK,CACvC,IAAM0E,CAAAA,CAAQP,CAAAA,CAAQnE,CAAC,CAAA,CACjB2E,CAAAA,CAAOZ,EAAQD,CAAAA,CAAMY,CAAK,CAAA,CAAIA,CAAK,CAAA,CACzChB,CAAAA,CAAW,KAAKiB,CAAI,CAAA,CAEpB,IAAMC,CAAAA,CAAUJ,CAAAA,CAASxE,CAAC,CAAA,CAEtB4E,CAAAA,CAAU,CAAA,CACZ,UAAA,CAAW,IAAM,CACfD,EAAK,KAAA,GACP,CAAA,CAAGC,CAAO,CAAA,CAEVD,CAAAA,CAAK,QAET,CAEA,MAAM,OAAA,CAAQ,GAAA,CAAIjB,CAAAA,CAAW,IAAK7C,CAAAA,EAAMA,CAAAA,CAAE,QAAQ,CAAC,EACrD,CCvHA,IAAMgE,CAAAA,CAAN,KAAiC,CAQ/B,WAAA,CAAY1E,CAAAA,CAAepC,EAAsB,EAAC,CAAG,CAJrD,IAAA,CAAQ,WAAA,CAAc,IAAI,GAAA,CAC1B,IAAA,CAAQ,UAAA,CAAqB,CAAA,CAC7B,IAAA,CAAQ,cAAA,CAAsC,IAAI,GAAA,CAGhD,GAAM,CAAE,WAAA,CAAA+G,CAAAA,CAAc,EAAG,GAAGC,CAAa,CAAA,CAAIhH,CAAAA,CAE7C,IAAA,CAAK,WAAA,CAAc+G,EAGnB,IAAA,CAAK,MAAA,CAAS7B,CAAAA,CAAkB,CAAA,CAAG8B,CAAY,CAAA,CAG/C,KAAK,OAAA,CAAU,EAAC,CAChB,IAAA,IAAS/E,CAAAA,CAAI,CAAA,CAAGA,EAAIG,CAAAA,CAAOH,CAAAA,EAAAA,CAAK,CAC9B,IAAM0C,CAAAA,CAASO,EAAkB,CAAA,CAAG8B,CAAY,CAAA,CAChD,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAKrC,CAAM,EAC1B,CAGA,KAAK,MAAA,CAAO,SAAA,CAAU,IAAM,CAC1B,IAAA,CAAK,UAAA,EAAA,CACL,IAAA,CAAK,uBAAA,GACP,CAAC,EACH,CAEQ,yBAAgC,CACtC,IAAMsC,EAAc,IAAA,CAAK,MAAA,CAAO,GAAA,EAAI,CAEpC,IAAA,IAAShF,CAAAA,CAAI,EAAGA,CAAAA,CAAI,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAQA,CAAAA,EAAAA,CAAK,CAC5C,IAAMiF,CAAAA,CAAAA,CAAejF,CAAAA,CAAI,CAAA,EAAK,IAAA,CAAK,WAAA,CAC7BkF,CAAAA,CAAc,KAAK,UAAA,CAAaD,CAAAA,CAGtC,KAAK,cAAA,CAAe,GAAA,CAAIjF,EAAGkF,CAAW,CAAA,CAGtC,IAAA,CAAK,sBAAA,CAAuBlF,CAAAA,CAAGgF,CAAAA,CAAaE,EAAaD,CAAW,EACtE,CACF,CAEQ,sBAAA,CACNP,EACAM,CAAAA,CACAE,CAAAA,CACAD,CAAAA,CACM,CACN,IAAME,CAAAA,CAAa,KAAK,UAAA,CAClBC,CAAAA,CAAeF,EAAcC,CAAAA,CAEnC,GAAIC,GAAgB,CAAA,CAElB,IAAA,CAAK,OAAA,CAAQV,CAAK,CAAA,CAAG,GAAA,CAAIM,CAAW,CAAA,CAAA,KAC/B,CAEL,IAAMJ,CAAAA,CAAU,IAAA,CAAK,GAAA,CAAIQ,EAAe,EAAA,CAAI,CAAC,CAAA,CAE7C,UAAA,CAAW,IAAM,CAEO,KAAK,cAAA,CAAe,GAAA,CAAIV,CAAK,CAAA,GAC7BQ,CAAAA,EACpB,KAAK,OAAA,CAAQR,CAAK,CAAA,CAAG,GAAA,CAAIM,CAAW,EAExC,EAAGJ,CAAO,EACZ,CACF,CAEA,GAAA,CAAIrE,EAAqB,CACvB,IAAA,CAAK,MAAA,CAAO,GAAA,CAAIA,CAAK,EACvB,CAEA,IAAA,CAAKA,CAAAA,CAAqB,CACxB,IAAA,CAAK,MAAA,CAAO,KAAKA,CAAK,CAAA,CACtB,IAAA,IAAWmC,CAAAA,IAAU,IAAA,CAAK,OAAA,CACxBA,EAAO,IAAA,CAAKnC,CAAK,EAErB,CAEA,SAAA,EAAsB,CACpB,OAAO,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAK8E,CAAAA,EAAMA,CAAAA,CAAE,GAAA,EAAK,CACxC,CAEA,UAAUnF,CAAAA,CAAkD,CAC1D,KAAK,WAAA,CAAY,GAAA,CAAIA,CAAQ,CAAA,CAG7B,IAAMoF,CAAAA,CAAgC,EAAC,CACvC,IAAA,IAAW5C,KAAU,IAAA,CAAK,OAAA,CACxB4C,EAAc,IAAA,CACZ5C,CAAAA,CAAO,SAAA,CAAU,IAAM,CACrB,IAAA,CAAK,SACP,CAAC,CACH,CAAA,CAIF,OAAAxC,EAAS,IAAA,CAAK,SAAA,EAAW,CAAA,CAGlB,IAAM,CACX,KAAK,WAAA,CAAY,MAAA,CAAOA,CAAQ,CAAA,CAChC,IAAA,IAAWqF,CAAAA,IAAeD,EACxBC,CAAAA,GAEJ,CACF,CAEQ,MAAA,EAAe,CACrB,IAAMjC,CAAAA,CAAS,IAAA,CAAK,WAAU,CAC9B,IAAA,IAAWN,KAAc,IAAA,CAAK,WAAA,CAC5BA,CAAAA,CAAWM,CAAM,EAErB,CAEA,SAAgB,CACd,IAAA,CAAK,OAAO,OAAA,EAAQ,CACpB,QAAWZ,CAAAA,IAAU,IAAA,CAAK,OAAA,CACxBA,CAAAA,CAAO,OAAA,EAAQ,CAEjB,KAAK,WAAA,CAAY,KAAA,GACjB,IAAA,CAAK,cAAA,CAAe,QACtB,CACF,CAAA,CA0BO,SAAS8C,EAAAA,CAAYrF,CAAAA,CAAepC,EAA6B,CACtE,OAAO,IAAI8G,CAAAA,CAAU1E,CAAAA,CAAOpC,CAAM,CACpC,CCtJA,IAAM0H,CAAAA,CAAN,KAA+D,CAY7D,WAAA,CAAY1H,EAAqB,CAPjC,IAAA,CAAQ,MAAwB,MAAA,CAChC,IAAA,CAAQ,MAAuB,IAAA,CAC/B,IAAA,CAAQ,eAAA,CAAuC,IAAA,CAO7CiE,CAAAA,CAAoBjE,CAAM,EAE1B,IAAA,CAAK,KAAA,CAAQ,EACb,IAAA,CAAK,QAAA,CAAWA,EAAO,QAAA,CACvB,IAAA,CAAK,YAAA,CAAeA,CAAAA,CAAO,YAAA,EAAgB,IAAA,CAC3C,KAAK,UAAA,CAAaA,CAAAA,CAAO,MACzB,IAAA,CAAK,KAAA,CAAQ,OACb,IAAA,CAAK,MAAA,CAASA,CAAAA,CAEd,IAAA,CAAK,QAAA,CAAW,IAAI,QAASuE,CAAAA,EAAY,CACvC,IAAA,CAAK,eAAA,CAAkBA,EACzB,CAAC,EACH,CAEA,KAAA,EAAwB,CACtB,OAAI,IAAA,CAAK,KAAA,GAAU,UAA+B,IAAA,EAClD,IAAA,CAAK,MAAQ,SAAA,CACbjC,CAAAA,CAAW,IAAI,IAAI,CAAA,CACZ,IAAA,CACT,CAEA,IAAA,EAAa,CACX,KAAK,KAAA,CAAQ,MAAA,CACbA,CAAAA,CAAW,MAAA,CAAO,IAAI,EACxB,CAEA,MAAA,CAAOmC,CAAAA,CAAoB,CACzB,GAAI,IAAA,CAAK,KAAA,GAAU,UAOnB,CAAA,GAJA,IAAA,CAAK,UAAY,IAAA,CAAK,YAAA,CACtB,KAAK,KAAA,EAAS,IAAA,CAAK,QAAA,CAGf,IAAA,CAAK,UAAA,CAAY,CACnB,GAAM,CAAChC,CAAAA,CAAKC,CAAG,CAAA,CAAI,IAAA,CAAK,UAAA,CACxB,KAAK,KAAA,CAAQH,CAAAA,CAAM,IAAA,CAAK,KAAA,CAAOE,CAAAA,CAAKC,CAAG,GAGlC,IAAA,CAAK,KAAA,EAASD,GAAO,IAAA,CAAK,QAAA,CAAW,GAAO,IAAA,CAAK,KAAA,EAASC,CAAAA,EAAO,IAAA,CAAK,QAAA,CAAW,CAAA,IACpF,KAAK,QAAA,CAAW,CAAA,EAEpB,CAEA,IAAA,CAAK,MAAA,CAAO,WAAW,IAAA,CAAK,KAAK,CAAA,CAG7B,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,QAAQ,CAAA,CAAI,GAAA,GAC5B,KAAK,KAAA,CAAQ,UAAA,CACbJ,EAAW,MAAA,CAAO,IAAI,CAAA,CACtB,IAAA,CAAK,MAAA,CAAO,UAAA,KACZ,IAAA,CAAK,eAAA,IAAkB,EAAA,CAE3B,CAEA,UAAA,EAAsB,CACpB,OAAO,IAAA,CAAK,KAAA,GAAU,UACxB,CAEA,OAAA,EAAgB,CACd,KAAK,IAAA,EAAK,CACV,KAAK,MAAA,CAAO,QAAA,CAAW,OACvB,IAAA,CAAK,MAAA,CAAO,UAAA,CAAa,OAC3B,CACF,CAAA,CAoBO,SAASqF,EAAAA,CAAM3H,CAAAA,CAAqC,CACzD,OAAO,IAAI0H,EAAmB1H,CAAM,CACtC,CCnDO,SAAS4H,EAAAA,CACdrC,CAAAA,CACAU,EAA4B,EAAC,CACT,CACpB,GAAM,CACJ,OAAAjG,CAAAA,CAAS,EAAC,CACV,KAAA,CAAA6H,CAAAA,CACA,UAAA,CAAAC,EACA,UAAA,CAAAC,CAAAA,CACA,QAAA,CAAAC,CACF,CAAA,CAAI/B,CAAAA,CAGEgC,EAAsB1C,CAAAA,CAAO,GAAA,CAAI,CAAC2C,CAAAA,CAAGjG,CAAAA,GACrC,OAAOiG,GAAM,QAAA,CACR,CACL,MAAOA,CAAAA,CACP,EAAA,CAAIL,IAAQ5F,CAAC,CACf,CAAA,CAEK,CAAE,GAAGiG,CAAAA,CAAG,GAAIA,CAAAA,CAAE,EAAA,EAAML,IAAQ5F,CAAC,CAAE,CACvC,CAAA,CAGKkG,CAAAA,CAAgBF,CAAAA,CAAoB,MAAA,CAC1CA,CAAAA,CAAoB,OAAA,CAAQ,CAACG,CAAAA,CAAInG,CAAAA,GAAM,CACjCmG,CAAAA,CAAG,EAAA,GAAO,SACZA,CAAAA,CAAG,EAAA,CAAKD,CAAAA,CAAgB,CAAA,CAAIlG,CAAAA,EAAKkG,CAAAA,CAAgB,GAAK,CAAA,EAE1D,CAAC,CAAA,CAGDF,CAAAA,CAAoB,IAAA,CAAK,CAACnF,EAAG,CAAA,GAAA,CAAOA,CAAAA,CAAE,EAAA,EAAM,CAAA,GAAM,CAAA,CAAE,EAAA,EAAM,EAAE,CAAA,CAG5D,IAAIuF,EAAe,CAAA,CACfC,CAAAA,CAAY,MACZC,CAAAA,CAAW,KAAA,CACX5D,CAAAA,CAAsD,IAAA,CACtD6D,CAAAA,CAAeP,CAAAA,CAAoB,CAAC,CAAA,EAAG,KAAA,EAAS,EAChDQ,CAAAA,CAAY,KAAA,CAEVC,EAAe,IAAM,CACrB/D,CAAAA,EACFA,CAAAA,CAAO,OAAA,EAAQ,CAIjB,IAAMqC,CAAAA,CADYiB,CAAAA,CAAoBI,CAAY,CAAA,EAClB,MAAA,EAAUrI,EAE1C2E,CAAAA,CAASO,CAAAA,CAAkBsD,CAAAA,CAAcxB,CAAY,CAAA,CACrDrC,CAAAA,CAAO,UAAWnC,CAAAA,EAAU,CAC1BgG,CAAAA,CAAehG,CAAAA,CACfwF,CAAAA,GAAWxF,CAAK,EAClB,CAAC,EACH,CAAA,CAEMmG,CAAAA,CAAgB,SAA8B,CAElD,GADIF,CAAAA,EAAaF,CAAAA,EACbF,GAAgBJ,CAAAA,CAAoB,MAAA,CAAS,EAAG,OAAO,MAAA,CAE3DI,CAAAA,EAAAA,CACA,IAAMO,CAAAA,CAAWX,CAAAA,CAAoBI,CAAY,CAAA,CACjD,OAAKO,GAGDA,CAAAA,CAAS,MAAA,EACXF,GAAa,CAGfZ,CAAAA,GAAaO,CAAY,CAAA,CAErB1D,CAAAA,GACFA,CAAAA,CAAO,IAAIiE,CAAAA,CAAS,KAAK,EAGzB,MAAM,IAAI,QAAerE,CAAAA,EAAY,CACnC,IAAMsE,CAAAA,CAAgB,IAAM,CAC1B,GAAIJ,CAAAA,EAAaF,CAAAA,CAAU,CACzBhE,CAAAA,EAAQ,CACR,MACF,CAEII,CAAAA,EAAU,CAACA,CAAAA,CAAO,WAAA,EAAY,CAChCJ,CAAAA,GAEA,qBAAA,CAAsBsE,CAAa,EAEvC,CAAA,CAEA,UAAA,CAAWA,EAAe,EAAE,EAC9B,CAAC,CAAA,CAAA,CAGI,IAAA,EA/Be,KAgCxB,EAsGA,OApGsC,CACpC,KAAM,SAAY,CAChB,GAAI,CAAAJ,CAAAA,EACA,CAAAH,CAAAA,CAeJ,CAAA,IAbAA,CAAAA,CAAY,KACZC,CAAAA,CAAW,KAAA,CAGPF,GAAgBJ,CAAAA,CAAoB,MAAA,CAAS,IAC/CI,CAAAA,CAAe,CAAA,CACfG,CAAAA,CAAeP,CAAAA,CAAoB,CAAC,CAAA,EAAG,OAAS,CAAA,CAAA,CAGlDS,CAAAA,EAAa,CACbZ,CAAAA,GAAa,CAAC,CAAA,CAGP,MAAMa,CAAAA,EAAc,EAAG,CAI1B,CAACJ,CAAAA,EAAY,CAACE,IAChBH,CAAAA,CAAY,KAAA,CACZP,KAAa,EAAA,CAEjB,CAAA,CAEA,MAAO,IAAM,CACXQ,CAAAA,CAAW,IAAA,CACXD,CAAAA,CAAY,KAAA,CACR3D,GACFA,CAAAA,CAAO,IAAA,GAEX,CAAA,CAEA,MAAA,CAAQ,IAAM,CACZ,GAAI,CAAC4D,CAAAA,EAAYE,CAAAA,CAAW,OAC5BF,EAAW,KAAA,CACXD,CAAAA,CAAY,MAGc,SAAY,CACpC,KAAO,MAAMK,CAAAA,EAAc,EAAG,CAI1B,CAACJ,CAAAA,EAAY,CAACE,CAAAA,GAChBH,CAAAA,CAAY,KAAA,CACZP,CAAAA,IAAa,EAEjB,CAAA,IAGF,CAAA,CAEA,IAAA,CAAM,IAAM,CACVQ,CAAAA,CAAW,KAAA,CACXD,EAAY,KAAA,CACZD,CAAAA,CAAe,EACfG,CAAAA,CAAeP,CAAAA,CAAoB,CAAC,CAAA,EAAG,KAAA,EAAS,CAAA,CAE5CtD,CAAAA,EACFA,CAAAA,CAAO,IAAA,CAAK6D,CAAY,EAE5B,CAAA,CAEA,GAAA,CAAK,IAAMA,CAAAA,CAEX,kBAAA,CAAoB,IAAMH,CAAAA,CAE1B,SAAA,CAAW,IAAMC,CAAAA,CAEjB,MAAA,CAAS3B,CAAAA,EAAkB,CACzB,GAAIA,CAAAA,CAAQ,GAAKA,CAAAA,EAASsB,CAAAA,CAAoB,OAAQ,OAEtDI,CAAAA,CAAe1B,CAAAA,CACf,IAAMM,CAAAA,CAAcgB,CAAAA,CAAoBtB,CAAK,CAAA,EAAG,KAAA,EAAS,CAAA,CACzD6B,CAAAA,CAAevB,CAAAA,CAEXtC,CAAAA,EACFA,EAAO,IAAA,CAAKsC,CAAW,CAAA,CAGzBe,CAAAA,GAAWf,CAAW,CAAA,CACtBa,IAAanB,CAAK,EACpB,EAEA,OAAA,CAAS,IAAM,CACb8B,CAAAA,CAAY,IAAA,CACZH,CAAAA,CAAY,KAAA,CACZC,CAAAA,CAAW,KAAA,CAEP5D,IACFA,CAAAA,CAAO,OAAA,GACPA,CAAAA,CAAS,IAAA,EAEb,CACF,CAGF,CAWO,SAASmE,EAAAA,CACdvD,CAAAA,CACAsC,CAAAA,CACoB,CACpB,OAAOtC,CAAAA,CAAO,IAAI,CAAC/C,CAAAA,CAAOmE,KAAW,CACnC,KAAA,CAAAnE,CAAAA,CACA,EAAA,CAAIqF,CAAAA,GAAQlB,CAAK,CACnB,CAAA,CAAE,CACJ,CAKO,SAASoC,EAAAA,CAAgBvG,CAAAA,CAAmC,CACjE,OAAO,KAAA,CAAM,OAAA,CAAQA,CAAK,CAAA,EAAKA,CAAAA,CAAM,MAAO0F,CAAAA,EAAM,OAAOA,GAAM,QAAQ,CACzE,CCzRA,IAAMc,EAAAA,CAAyE,CAC7E,KAAA,CAAO,KACT,CAAA,CAKMC,EAAN,KAAiD,CAM/C,YACEC,CAAAA,CACAC,CAAAA,CACAC,EACAnD,CAAAA,CAA8B,EAAC,CAC/B,CACA,IAAA,CAAK,MAAA,CAASiD,EACd,IAAA,CAAK,KAAA,CAAQC,EACb,IAAA,CAAK,MAAA,CAASC,EACd,IAAA,CAAK,OAAA,CAAU,CAAE,GAAGJ,EAAAA,CAA2B,GAAG/C,CAAQ,EAC5D,CAEA,GAAA,EAAc,CACZ,IAAMzD,CAAAA,CAAQ,OAAO,IAAA,CAAK,MAAA,EAAW,UAAA,CAAa,IAAA,CAAK,MAAA,EAAO,CAAI,KAAK,MAAA,CAAO,GAAA,GAC9E,OAAO,IAAA,CAAK,YAAYA,CAAK,CAC/B,CAEQ,WAAA,CAAYA,CAAAA,CAAuB,CACzC,GAAM,CAAE,KAAA,CAAA2G,EAAO,MAAA,CAAAC,CAAO,EAAI,IAAA,CACpB,CAAE,WAAA,CAAAC,CAAAA,CAAa,eAAA,CAAAC,CAAAA,CAAiB,iBAAAC,CAAAA,CAAkB,KAAA,CAAAhH,CAAM,CAAA,CAAI,IAAA,CAAK,QAGvE,GAAI4G,CAAAA,CAAM,MAAA,GAAW,CAAA,CACnB,OAAOC,CAAAA,CAAO,CAAC,CAAA,CAIjB,GAAI5G,CAAAA,CAAQ2G,CAAAA,CAAM,CAAC,CAAA,CAAI,CAErB,IAAMK,CAAAA,CAAO,IAAA,CAAK,oBAAA,CAAqBF,CAAAA,CAAiBD,CAAW,EACnE,GAAIG,CAAAA,GAAS,QACXhH,CAAAA,CAAQ2G,CAAAA,CAAM,CAAC,CAAA,CAAA,KAAA,GACNK,CAAAA,GAAS,UAAA,CAClB,OAAOhH,CAEX,CAAA,KAAA,GAAWA,EAAQ2G,CAAAA,CAAMA,CAAAA,CAAM,OAAS,CAAC,CAAA,CAAI,CAE3C,IAAMK,CAAAA,CAAO,IAAA,CAAK,oBAAA,CAAqBD,CAAAA,CAAkBF,CAAW,EACpE,GAAIG,CAAAA,GAAS,QACXhH,CAAAA,CAAQ2G,CAAAA,CAAMA,EAAM,MAAA,CAAS,CAAC,CAAA,CAAA,KAAA,GACrBK,CAAAA,GAAS,UAAA,CAClB,OAAOhH,CAEX,CAGA,IAAIP,CAAAA,CAAI,CAAA,CACR,KAAOA,CAAAA,CAAIkH,EAAM,MAAA,CAAS,CAAA,EAAK3G,CAAAA,CAAQ2G,CAAAA,CAAMlH,CAAC,CAAA,EAC5CA,IAIF,IAAMb,CAAAA,CAAAA,CAASoB,EAAQ2G,CAAAA,CAAMlH,CAAAA,CAAI,CAAC,CAAA,GAAOkH,CAAAA,CAAMlH,CAAC,CAAA,CAAKkH,CAAAA,CAAMlH,CAAAA,CAAI,CAAC,CAAA,CAAA,CAC1DyC,CAAAA,CAAS0E,EAAOnH,CAAAA,CAAI,CAAC,EAAKb,CAAAA,EAASgI,CAAAA,CAAOnH,CAAC,CAAA,CAAKmH,CAAAA,CAAOnH,CAAAA,CAAI,CAAC,CAAA,CAAA,CAElE,GAAIM,EAAO,CACT,IAAME,EAAM,IAAA,CAAK,GAAA,CAAI,GAAG2G,CAAM,CAAA,CACxB1G,CAAAA,CAAM,KAAK,GAAA,CAAI,GAAG0G,CAAM,CAAA,CAC9B,OAAO,IAAA,CAAK,IAAI3G,CAAAA,CAAK,IAAA,CAAK,GAAA,CAAIC,CAAAA,CAAKgC,CAAM,CAAC,CAC5C,CAEA,OAAOA,CACT,CAEQ,oBAAA,CACN+E,EACAC,CAAAA,CACiC,CACjC,OAAID,CAAAA,GAAiB,MAAA,CACZA,CAAAA,CAELC,IAAiB,MAAA,CACZA,CAAAA,CAEF,QACT,CACF,CAAA,CAyBO,SAASC,EAAAA,CACdnH,CAAAA,CACA2G,CAAAA,CACAC,CAAAA,CACAnD,CAAAA,CACe,CACf,OAAO,IAAIgD,CAAAA,CAAkBzG,EAAO2G,CAAAA,CAAOC,CAAAA,CAAQnD,CAAO,CAC5D,CCvIA,IAAM2D,CAAAA,CAAN,KAA2D,CAMzD,YACEV,CAAAA,CACAC,CAAAA,CACAU,CAAAA,CACA5D,CAAAA,CAA8B,EAAC,CAC/B,CACA,IAAA,CAAK,MAAA,CAASiD,CAAAA,CACd,IAAA,CAAK,KAAA,CAAQC,CAAAA,CACb,KAAK,MAAA,CAASU,CAAAA,CAAa,IAAKC,CAAAA,EAAM,IAAA,CAAK,WAAWA,CAAC,CAAC,CAAA,CACxD,IAAA,CAAK,OAAA,CAAU7D,EACjB,CAEA,GAAA,EAAc,CACZ,IAAIzD,CAAAA,CAAQ,OAAO,KAAK,MAAA,EAAW,UAAA,CAAa,IAAA,CAAK,MAAA,EAAO,CAAI,IAAA,CAAK,OAAO,GAAA,EAAI,CAC1E,CAAE,WAAA,CAAA6G,CAAAA,CAAa,gBAAAC,CAAAA,CAAiB,gBAAA,CAAAC,CAAiB,CAAA,CAAI,IAAA,CAAK,OAAA,CAGhE,GAAI,IAAA,CAAK,KAAA,CAAM,MAAA,GAAW,CAAA,CAAG,CAC3B,GAAM,CAACQ,CAAAA,CAAGC,CAAAA,CAAGjH,CAAC,CAAA,CAAI,IAAA,CAAK,MAAA,CAAO,CAAC,CAAA,CAC/B,OAAO,OAAOgH,CAAC,CAAA,EAAA,EAAKC,CAAC,CAAA,EAAA,EAAKjH,CAAC,CAAA,CAAA,CAC7B,CAGA,GAAIP,CAAAA,CAAQ,KAAK,KAAA,CAAM,CAAC,CAAA,CAAI,CAC1B,IAAMgH,CAAAA,CAAOF,GAAmBD,CAAAA,EAAe,QAAA,CAC3CG,CAAAA,GAAS,OAAA,CACXhH,CAAAA,CAAQ,IAAA,CAAK,MAAM,CAAC,CAAA,CACXgH,IAAS,UAAA,GAElBhH,CAAAA,CAAQ,KAAK,KAAA,CAAM,CAAC,CAAA,EAExB,CAAA,KAAA,GAAWA,CAAAA,CAAQ,IAAA,CAAK,MAAM,IAAA,CAAK,KAAA,CAAM,MAAA,CAAS,CAAC,CAAA,CAAI,CACrD,IAAMgH,CAAAA,CAAOD,CAAAA,EAAoBF,CAAAA,EAAe,QAAA,CAC5CG,CAAAA,GAAS,OAAA,CACXhH,EAAQ,IAAA,CAAK,KAAA,CAAM,KAAK,KAAA,CAAM,MAAA,CAAS,CAAC,CAAA,CAC/BgH,CAAAA,GAAS,UAAA,GAElBhH,CAAAA,CAAQ,IAAA,CAAK,KAAA,CAAM,KAAK,KAAA,CAAM,MAAA,CAAS,CAAC,CAAA,EAE5C,CAGA,IAAIP,CAAAA,CAAI,CAAA,CACR,KAAOA,CAAAA,CAAI,IAAA,CAAK,KAAA,CAAM,OAAS,CAAA,EAAKO,CAAAA,CAAQ,KAAK,KAAA,CAAMP,CAAC,GACtDA,CAAAA,EAAAA,CAIF,IAAMb,CAAAA,CAAAA,CAASoB,CAAAA,CAAQ,IAAA,CAAK,KAAA,CAAMP,EAAI,CAAC,CAAA,GAAO,IAAA,CAAK,KAAA,CAAMA,CAAC,CAAA,CAAK,KAAK,KAAA,CAAMA,CAAAA,CAAI,CAAC,CAAA,CAAA,CAGzE8H,CAAAA,CAAI,IAAA,CAAK,KAAK,IAAA,CAAK,MAAA,CAAO9H,EAAI,CAAC,CAAA,CAAG,CAAC,CAAA,CAAG,IAAA,CAAK,MAAA,CAAOA,CAAC,CAAA,CAAG,CAAC,EAAGb,CAAK,CAAA,CAC/D4I,EAAI,IAAA,CAAK,IAAA,CAAK,KAAK,MAAA,CAAO/H,CAAAA,CAAI,CAAC,CAAA,CAAG,CAAC,CAAA,CAAG,KAAK,MAAA,CAAOA,CAAC,EAAG,CAAC,CAAA,CAAGb,CAAK,CAAA,CAC/D2B,CAAAA,CAAI,IAAA,CAAK,IAAA,CAAK,IAAA,CAAK,MAAA,CAAOd,EAAI,CAAC,CAAA,CAAG,CAAC,CAAA,CAAG,IAAA,CAAK,MAAA,CAAOA,CAAC,CAAA,CAAG,CAAC,CAAA,CAAGb,CAAK,CAAA,CAErE,OAAO,OAAO,IAAA,CAAK,KAAA,CAAM2I,CAAC,CAAC,CAAA,EAAA,EAAK,KAAK,KAAA,CAAMC,CAAC,CAAC,CAAA,EAAA,EAAK,IAAA,CAAK,KAAA,CAAMjH,CAAC,CAAC,CAAA,CAAA,CACjE,CAEQ,UAAA,CAAWkH,CAAAA,CAAyC,CAE1D,IAAMC,CAAAA,CAAWD,CAAAA,CAAM,KAAA,CAAM,+BAA+B,CAAA,CAC5D,GAAIC,CAAAA,CAAU,CACZ,IAAMC,CAAAA,CAAMD,CAAAA,CAAS,CAAC,CAAA,CACtB,OAAIC,CAAAA,CAAI,MAAA,GAAW,CAAA,CACV,CACL,SAASA,CAAAA,CAAI,MAAA,CAAO,CAAC,CAAA,CAAIA,CAAAA,CAAI,MAAA,CAAO,CAAC,CAAA,CAAG,EAAE,CAAA,CAC1C,QAAA,CAASA,CAAAA,CAAI,MAAA,CAAO,CAAC,CAAA,CAAIA,CAAAA,CAAI,OAAO,CAAC,CAAA,CAAG,EAAE,CAAA,CAC1C,QAAA,CAASA,CAAAA,CAAI,MAAA,CAAO,CAAC,CAAA,CAAIA,EAAI,MAAA,CAAO,CAAC,EAAG,EAAE,CAC5C,EAEK,CACL,QAAA,CAASA,CAAAA,CAAI,KAAA,CAAM,CAAA,CAAG,CAAC,EAAG,EAAE,CAAA,CAC5B,SAASA,CAAAA,CAAI,KAAA,CAAM,EAAG,CAAC,CAAA,CAAG,EAAE,CAAA,CAC5B,QAAA,CAASA,CAAAA,CAAI,MAAM,CAAA,CAAG,CAAC,CAAA,CAAG,EAAE,CAC9B,CACF,CAGA,IAAMC,CAAAA,CAAWH,CAAAA,CAAM,KAAA,CAAM,iCAAiC,CAAA,CAC9D,GAAIG,CAAAA,CACF,OAAO,CACL,QAAA,CAASA,CAAAA,CAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CACzB,QAAA,CAASA,CAAAA,CAAS,CAAC,EAAI,EAAE,CAAA,CACzB,SAASA,CAAAA,CAAS,CAAC,EAAI,EAAE,CAC3B,CAAA,CAIF,IAAMC,CAAAA,CAAYJ,CAAAA,CAAM,MAAM,4CAA4C,CAAA,CAC1E,GAAII,CAAAA,CACF,OAAO,CACL,QAAA,CAASA,CAAAA,CAAU,CAAC,CAAA,CAAI,EAAE,CAAA,CAC1B,SAASA,CAAAA,CAAU,CAAC,CAAA,CAAI,EAAE,CAAA,CAC1B,QAAA,CAASA,EAAU,CAAC,CAAA,CAAI,EAAE,CAC5B,CAAA,CAIF,IAAMC,EAAWL,CAAAA,CAAM,KAAA,CAAM,mCAAmC,CAAA,CAChE,OAAIK,EACK,IAAA,CAAK,QAAA,CACV,QAAA,CAASA,CAAAA,CAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CACzB,QAAA,CAASA,EAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CACzB,QAAA,CAASA,CAAAA,CAAS,CAAC,CAAA,CAAI,EAAE,CAC3B,CAAA,CAIK,CAAC,EAAG,CAAA,CAAG,CAAC,CACjB,CAEQ,QAAA,CAASC,CAAAA,CAAWjD,CAAAA,CAAWkD,CAAAA,CAAqC,CAK1E,GAJAD,CAAAA,CAAAA,CAAMA,CAAAA,CAAI,GAAA,CAAO,GAAA,EAAO,GAAA,CACxBjD,CAAAA,CAAI,KAAK,GAAA,CAAI,CAAA,CAAG,IAAA,CAAK,GAAA,CAAI,GAAA,CAAKA,CAAC,CAAC,CAAA,CAAI,GAAA,CACpCkD,EAAI,IAAA,CAAK,GAAA,CAAI,EAAG,IAAA,CAAK,GAAA,CAAI,GAAA,CAAKA,CAAC,CAAC,CAAA,CAAI,IAEhClD,CAAAA,GAAM,CAAA,CAAG,CACX,IAAMmD,CAAAA,CAAO,KAAK,KAAA,CAAMD,CAAAA,CAAI,GAAG,CAAA,CAC/B,OAAO,CAACC,EAAMA,CAAAA,CAAMA,CAAI,CAC1B,CAEA,IAAMC,EAAU,CAACC,CAAAA,CAAWC,CAAAA,CAAWC,CAAAA,IACjCA,CAAAA,CAAI,CAAA,GAAGA,GAAK,CAAA,CAAA,CACZA,CAAAA,CAAI,CAAA,GAAGA,CAAAA,EAAK,CAAA,CAAA,CACZA,CAAAA,CAAI,EAAI,CAAA,CAAUF,CAAAA,CAAAA,CAAKC,CAAAA,CAAID,CAAAA,EAAK,CAAA,CAAIE,CAAAA,CACpCA,EAAI,CAAA,CAAI,CAAA,CAAUD,EAClBC,CAAAA,CAAI,CAAA,CAAI,EAAUF,CAAAA,CAAAA,CAAKC,CAAAA,CAAID,CAAAA,GAAM,CAAA,CAAI,CAAA,CAAIE,CAAAA,CAAAA,CAAK,EAC3CF,CAAAA,CAAAA,CAGHC,CAAAA,CAAIJ,EAAI,EAAA,CAAMA,CAAAA,EAAK,EAAIlD,CAAAA,CAAAA,CAAKkD,CAAAA,CAAIlD,CAAAA,CAAIkD,CAAAA,CAAIlD,CAAAA,CACxCqD,CAAAA,CAAI,EAAIH,CAAAA,CAAII,CAAAA,CAElB,OAAO,CACL,IAAA,CAAK,MAAMF,CAAAA,CAAQC,CAAAA,CAAGC,CAAAA,CAAGL,CAAAA,CAAI,GAAA,CAAM,CAAA,CAAI,CAAC,CAAA,CAAI,GAAG,CAAA,CAC/C,IAAA,CAAK,KAAA,CAAMG,CAAAA,CAAQC,EAAGC,CAAAA,CAAGL,CAAAA,CAAI,GAAG,CAAA,CAAI,GAAG,CAAA,CACvC,KAAK,KAAA,CAAMG,CAAAA,CAAQC,EAAGC,CAAAA,CAAGL,CAAAA,CAAI,IAAM,CAAA,CAAI,CAAC,CAAA,CAAI,GAAG,CACjD,CACF,CAEQ,IAAA,CAAKzH,CAAAA,CAAWC,EAAW8H,CAAAA,CAAmB,CACpD,OAAO/H,CAAAA,CAAAA,CAAKC,CAAAA,CAAID,CAAAA,EAAK+H,CACvB,CACF,CAAA,CA6BO,SAASC,EAAAA,CACdtI,CAAAA,CACA2G,EACA4B,CAAAA,CACA9E,CAAAA,CACoB,CACpB,OAAO,IAAI2D,CAAAA,CAAuBpH,CAAAA,CAAO2G,CAAAA,CAAO4B,CAAAA,CAAQ9E,CAAO,CACjE,CCjIA,IAAM+E,EAAAA,CAAmI,CACvI,IAAA,CAAM,OACN,UAAA,CAAY,KAAA,CACZ,gBAAA,CAAkB,EAAA,CAClB,SAAA,CAAW,GAAA,CACX,QAAS,EAAA,CACT,IAAA,CAAM,EACN,SAAA,CAAW,GAAA,CACX,UAAW,GAAA,CACX,KAAA,CAAO,KACT,CAAA,CAKMC,CAAAA,CAAN,KAA2C,CAgBzC,WAAA,CAAYC,CAAAA,CAAsBlL,EAA2B,EAAC,CAAG,CAbjE,IAAA,CAAQ,OAAA,CAAU,IAAA,CAClB,IAAA,CAAQ,QAAA,CAAW,CAAE,EAAG,CAAA,CAAG,CAAA,CAAG,CAAE,CAAA,CAChC,IAAA,CAAQ,WAAa,KAAA,CACrB,IAAA,CAAQ,aAAA,CAAgB,CAAE,CAAA,CAAG,CAAA,CAAG,EAAG,CAAE,CAAA,CACrC,IAAA,CAAQ,YAAA,CAAe,CAAE,CAAA,CAAG,EAAG,CAAA,CAAG,CAAE,CAAA,CACpC,IAAA,CAAQ,YAAA,CAAe,CAAE,EAAG,CAAA,CAAG,CAAA,CAAG,CAAE,CAAA,CACpC,IAAA,CAAQ,SAAW,CAAA,CACnB,IAAA,CAAQ,QAAA,CAAW,CAAE,CAAA,CAAG,CAAA,CAAG,EAAG,CAAE,CAAA,CAiDhC,KAAQ,aAAA,CAAiB,CAAA,EAA0B,CAC7C,CAAC,IAAA,CAAK,OAAA,EAAW,CAAA,CAAE,MAAA,GAAW,CAAA,GAElC,KAAK,UAAA,CAAa,IAAA,CAClB,KAAK,aAAA,CAAgB,CAAE,GAAG,IAAA,CAAK,QAAS,CAAA,CACxC,IAAA,CAAK,YAAA,CAAe,CAAE,EAAG,CAAA,CAAE,OAAA,CAAS,CAAA,CAAG,CAAA,CAAE,OAAQ,CAAA,CACjD,KAAK,YAAA,CAAe,CAAE,CAAA,CAAG,CAAA,CAAE,OAAA,CAAS,CAAA,CAAG,EAAE,OAAQ,CAAA,CACjD,KAAK,QAAA,CAAW,WAAA,CAAY,KAAI,CAChC,IAAA,CAAK,QAAA,CAAW,CAAE,CAAA,CAAG,CAAA,CAAG,EAAG,CAAE,CAAA,CAE7B,KAAK,OAAA,CAAQ,iBAAA,CAAkB,EAAE,SAAS,CAAA,CAC1C,IAAA,CAAK,OAAA,CAAQ,gBAAA,CAAiB,aAAA,CAAe,KAAK,aAAa,CAAA,CAC/D,KAAK,OAAA,CAAQ,gBAAA,CAAiB,YAAa,IAAA,CAAK,WAAW,CAAA,CAC3D,IAAA,CAAK,OAAA,CAAQ,gBAAA,CAAiB,gBAAiB,IAAA,CAAK,WAAW,CAAA,CAG3D,IAAA,CAAK,MAAA,CAAO,WAAA,EACd,KAAK,MAAA,CAAO,WAAA,CAAY,CAAC,CAAA,EAE7B,CAAA,CAEA,IAAA,CAAQ,cAAiB,CAAA,EAA0B,CACjD,IAAM0B,CAAAA,CAAM,WAAA,CAAY,KAAI,CACtBjB,CAAAA,CAAKiB,CAAAA,CAAM,IAAA,CAAK,QAAA,CAGtB,IAAA,CAAK,SAAW,CACd,CAAA,CAAA,CAAI,EAAE,OAAA,CAAU,IAAA,CAAK,aAAa,CAAA,EAAK,IAAA,CAAK,GAAA,CAAIjB,CAAAA,CAAI,CAAC,CAAA,CACrD,GAAI,CAAA,CAAE,OAAA,CAAU,KAAK,YAAA,CAAa,CAAA,EAAK,KAAK,GAAA,CAAIA,CAAAA,CAAI,CAAC,CACvD,CAAA,CAEA,IAAA,CAAK,aAAe,CAAE,CAAA,CAAG,CAAA,CAAE,OAAA,CAAS,CAAA,CAAG,CAAA,CAAE,OAAQ,CAAA,CACjD,IAAA,CAAK,QAAA,CAAWiB,CAAAA,CAGhB,IAAIyJ,CAAAA,CAAO,KAAK,aAAA,CAAc,CAAA,EAAK,EAAE,OAAA,CAAU,IAAA,CAAK,aAAa,CAAA,CAAA,CAC7DC,CAAAA,CAAO,IAAA,CAAK,aAAA,CAAc,CAAA,EAAK,CAAA,CAAE,QAAU,IAAA,CAAK,YAAA,CAAa,GAG7D,IAAA,CAAK,MAAA,CAAO,SACdD,CAAAA,CAAO,IAAA,CAAK,WAAA,CACVA,CAAAA,CACA,IAAA,CAAK,MAAA,CAAO,OAAO,IAAA,EAAQ,EAAA,CAAA,CAAA,CAC3B,KAAK,MAAA,CAAO,MAAA,CAAO,OAAS,CAAA,CAAA,CAC9B,CAAA,CACAC,CAAAA,CAAO,IAAA,CAAK,WAAA,CACVA,CAAAA,CACA,KAAK,MAAA,CAAO,MAAA,CAAO,GAAA,EAAO,EAAA,CAAA,CAAA,CAC1B,IAAA,CAAK,MAAA,CAAO,OAAO,MAAA,EAAU,CAAA,CAAA,CAC/B,CAAA,CAAA,CAIE,IAAA,CAAK,MAAA,CAAO,IAAA,GAAS,IACvBA,CAAAA,CAAO,CAAA,CACE,KAAK,MAAA,CAAO,IAAA,GAAS,MAC9BD,CAAAA,CAAO,CAAA,CAAA,CAGT,IAAA,CAAK,QAAA,CAAW,CAAE,CAAA,CAAGA,EAAM,CAAA,CAAGC,CAAK,EAC/B,IAAA,CAAK,MAAA,CAAO,QACd,IAAA,CAAK,MAAA,CAAO,MAAA,CAAOD,CAAAA,CAAMC,CAAAA,CAAM,CAAC,EAE9B,IAAA,CAAK,MAAA,CAAO,UACd,IAAA,CAAK,MAAA,CAAO,SAASD,CAAAA,CAAMC,CAAI,EAEnC,CAAA,CAqBA,IAAA,CAAQ,WAAA,CAAe,GAA0B,CAC/C,IAAA,CAAK,UAAA,CAAa,KAAA,CAElB,IAAA,CAAK,OAAA,CAAQ,sBAAsB,CAAA,CAAE,SAAS,CAAA,CAC9C,IAAA,CAAK,OAAA,CAAQ,mBAAA,CAAoB,cAAe,IAAA,CAAK,aAAa,EAClE,IAAA,CAAK,OAAA,CAAQ,oBAAoB,WAAA,CAAa,IAAA,CAAK,WAAW,CAAA,CAC9D,IAAA,CAAK,OAAA,CAAQ,oBAAoB,eAAA,CAAiB,IAAA,CAAK,WAAW,CAAA,CAGlE,IAAA,CAAK,OAAA,CAAQ,KAAK,QAAA,CAAS,CAAA,CAAI,EAAA,CAAI,IAAA,CAAK,QAAA,CAAS,CAAA,CAAI,EAAE,CAAA,CAEnD,IAAA,CAAK,OAAO,SAAA,EACd,IAAA,CAAK,OAAO,SAAA,CAAU,IAAA,CAAK,QAAA,CAAS,CAAA,CAAG,IAAA,CAAK,QAAA,CAAS,EAAG,IAAA,CAAK,QAAQ,EAEzE,CAAA,CA/IE,IAAA,CAAK,OAAA,CAAUF,EACf,IAAA,CAAK,MAAA,CAAS,CAAE,GAAGF,EAAAA,CAAmB,GAAGhL,CAAO,CAAA,CAGhD,IAAMgH,EAAe,CACnB,SAAA,CAAW,KAAK,MAAA,CAAO,SAAA,CACvB,OAAA,CAAS,IAAA,CAAK,MAAA,CAAO,OAAA,CACrB,KAAM,IAAA,CAAK,MAAA,CAAO,KAClB,SAAA,CAAW,IAAA,CAAK,OAAO,SAAA,CACvB,SAAA,CAAW,IAAA,CAAK,MAAA,CAAO,SAAA,CACvB,KAAA,CAAO,KAAK,MAAA,CAAO,KACrB,EAEA,IAAA,CAAK,OAAA,CAAU9B,EAAkB,CAAA,CAAG8B,CAAY,CAAA,CAChD,IAAA,CAAK,OAAA,CAAU9B,CAAAA,CAAkB,EAAG8B,CAAY,CAAA,CAGhD,IAAA,CAAK,OAAA,CAAQ,SAAA,CAAU,IAAM,CACtB,IAAA,CAAK,UAAA,GACR,IAAA,CAAK,QAAA,CAAS,CAAA,CAAI,IAAA,CAAK,QAAQ,GAAA,EAAI,CAC/B,KAAK,MAAA,CAAO,QAAA,EACd,KAAK,MAAA,CAAO,QAAA,CAAS,IAAA,CAAK,QAAA,CAAS,CAAA,CAAG,IAAA,CAAK,SAAS,CAAC,CAAA,EAG3D,CAAC,CAAA,CAED,IAAA,CAAK,QAAQ,SAAA,CAAU,IAAM,CACtB,IAAA,CAAK,UAAA,GACR,IAAA,CAAK,SAAS,CAAA,CAAI,IAAA,CAAK,QAAQ,GAAA,EAAI,CAC/B,KAAK,MAAA,CAAO,QAAA,EACd,IAAA,CAAK,MAAA,CAAO,QAAA,CAAS,IAAA,CAAK,SAAS,CAAA,CAAG,IAAA,CAAK,QAAA,CAAS,CAAC,CAAA,EAG3D,CAAC,EAED,IAAA,CAAK,kBAAA,GACP,CAEQ,kBAAA,EAA2B,CACjC,KAAK,OAAA,CAAQ,gBAAA,CAAiB,cAAe,IAAA,CAAK,aAAa,EACjE,CAsEQ,WAAA,CAAYxE,CAAAA,CAAeC,CAAAA,CAAaC,CAAAA,CAAqB,CACnE,GAAI,CAAC,QAAA,CAASD,CAAG,CAAA,EAAK,CAAC,SAASC,CAAG,CAAA,CAAG,OAAOF,CAAAA,CAE7C,IAAMG,CAAAA,CAAY,SAASF,CAAG,CAAA,CAAIA,EAAM,EAAA,CAAA,CAAA,CAClCG,CAAAA,CAAY,SAASF,CAAG,CAAA,CAAIA,CAAAA,CAAM,CAAA,CAAA,CAAA,CAExC,GAAI,IAAA,CAAK,OAAO,UAAA,CAAY,CAC1B,IAAM2I,CAAAA,CAAS,IAAA,CAAK,MAAA,CAAO,kBAAoB,EAAA,CAC/C,GAAI7I,CAAAA,CAAQG,CAAAA,CACV,OAAOA,CAAAA,CAAAA,CAAaA,EAAYH,CAAAA,EAAS6I,CAAAA,CAE3C,GAAI7I,CAAAA,CAAQI,CAAAA,CACV,OAAOA,CAAAA,CAAAA,CAAaJ,CAAAA,CAAQI,CAAAA,EAAayI,CAE7C,CAEA,OAAO9I,EAAMC,CAAAA,CAAOG,CAAAA,CAAWC,CAAS,CAC1C,CAkBA,QAAe,CACb,IAAA,CAAK,OAAA,CAAU,KACjB,CAEA,OAAA,EAAgB,CACd,IAAA,CAAK,OAAA,CAAU,MACX,IAAA,CAAK,UAAA,GACP,KAAK,UAAA,CAAa,KAAA,EAEtB,CAEA,SAAA,EAAqB,CACnB,OAAO,KAAK,OACd,CAEA,KAAA,EAAc,CACZ,IAAA,CAAK,OAAA,CAAQ,KAAK,CAAC,CAAA,CACnB,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,CAAC,EACnB,IAAA,CAAK,QAAA,CAAW,CAAE,CAAA,CAAG,CAAA,CAAG,EAAG,CAAE,CAAA,CAEzB,IAAA,CAAK,MAAA,CAAO,QAAA,EACd,IAAA,CAAK,OAAO,QAAA,CAAS,CAAA,CAAG,CAAC,EAE7B,CAEA,aAAwC,CACtC,OAAO,CAAE,GAAG,IAAA,CAAK,QAAS,CAC5B,CAEA,WAAA,CAAY0I,EAAWC,CAAAA,CAAiB,CAEtC,KAAK,QAAA,CAAW,CAAE,CAAA,CAAAD,CAAAA,CAAG,CAAA,CAAAC,CAAE,EAEvB,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAKD,CAAC,CAAA,CACnB,IAAA,CAAK,QAAQ,IAAA,CAAKC,CAAC,EACrB,CAEA,OAAA,CAAQC,CAAAA,CAAmBC,EAAyB,CAElD,GAAI,KAAK,MAAA,CAAO,MAAA,CAAQ,CACtB,GAAM,CACJ,IAAA,CAAAlF,CAAAA,CAAO,EAAA,CAAA,CAAA,CACP,KAAA,CAAAC,EAAQ,CAAA,CAAA,CAAA,CACR,GAAA,CAAAkF,EAAM,EAAA,CAAA,CAAA,CACN,MAAA,CAAAC,EAAS,CAAA,CAAA,CACX,CAAA,CAAI,IAAA,CAAK,MAAA,CAAO,MAAA,CAEVC,CAAAA,CAAUrJ,EAAM,IAAA,CAAK,QAAA,CAAS,EAAGgE,CAAAA,CAAMC,CAAK,EAC5CqF,CAAAA,CAAUtJ,CAAAA,CAAM,IAAA,CAAK,QAAA,CAAS,CAAA,CAAGmJ,CAAAA,CAAKC,CAAM,CAAA,CAE9CC,CAAAA,GAAY,IAAA,CAAK,QAAA,CAAS,CAAA,EAC5B,IAAA,CAAK,QAAQ,GAAA,CAAIA,CAAAA,CAAS,CAAE,QAAA,CAAUJ,CAAU,CAAC,EAE/CK,CAAAA,GAAY,IAAA,CAAK,SAAS,CAAA,EAC5B,IAAA,CAAK,QAAQ,GAAA,CAAIA,CAAAA,CAAS,CAAE,QAAA,CAAUJ,CAAU,CAAC,EAErD,CACF,CAEA,SAAgB,CACd,IAAA,CAAK,QAAQ,mBAAA,CAAoB,aAAA,CAAe,IAAA,CAAK,aAAa,CAAA,CAClE,IAAA,CAAK,QAAQ,OAAA,EAAQ,CACrB,KAAK,OAAA,CAAQ,OAAA,GACf,CACF,CAAA,CAkBO,SAASK,EAAAA,CACdZ,CAAAA,CACAlL,CAAAA,CACY,CACZ,OAAO,IAAIiL,CAAAA,CAAeC,CAAAA,CAASlL,CAAM,CAC3C,CClRA,IAAM+L,EAAAA,CAUF,CACF,SAAA,CAAW,UAAA,CACX,QAAA,CAAU,MACV,aAAA,CAAe,GAAA,CACf,OAAQ,KAAA,CACR,SAAA,CAAW,IACX,OAAA,CAAS,EAAA,CACT,IAAA,CAAM,CAAA,CACN,SAAA,CAAW,GAAA,CACX,UAAW,GAAA,CACX,KAAA,CAAO,KACT,CAAA,CAKMC,CAAAA,CAAN,KAA+C,CAW7C,WAAA,CAAYC,CAAAA,CAAwBjM,CAAAA,CAA6B,EAAC,CAAG,CARrE,IAAA,CAAQ,MAAA,CAAS,CAAE,CAAA,CAAG,CAAA,CAAG,EAAG,CAAE,CAAA,CAC9B,IAAA,CAAQ,MAAA,CAAS,CAAE,CAAA,CAAG,EAAG,CAAA,CAAG,CAAE,CAAA,CAC9B,IAAA,CAAQ,WAAA,CAAc,KAAA,CACtB,KAAQ,SAAA,CAAY,IAAA,CAwCpB,IAAA,CAAQ,OAAA,CAAW,CAAA,EAAwB,CACzC,GAAI,CAAC,IAAA,CAAK,UAAW,OAEhB,IAAA,CAAK,cACR,IAAA,CAAK,WAAA,CAAc,IAAA,CACnB,IAAA,CAAK,MAAA,CAAO,aAAA,MAId,IAAIkM,CAAAA,CAAS,EAAE,MAAA,CACXC,CAAAA,CAAS,EAAE,MAAA,CASf,GAPI,IAAA,CAAK,MAAA,CAAO,SAAA,GAAc,YAAA,CAC5BA,EAAS,CAAA,CACA,IAAA,CAAK,OAAO,SAAA,GAAc,UAAA,GACnCD,EAAS,CAAA,CAAA,CAIP,IAAA,CAAK,MAAA,CAAO,MAAA,CAAQ,CACtB,IAAME,EAAa,IAAA,CAAK,SAAA,CAAU,WAAA,CAAc,IAAA,CAAK,SAAA,CAAU,WAAA,CACzDC,EAAa,IAAA,CAAK,SAAA,CAAU,YAAA,CAAe,IAAA,CAAK,SAAA,CAAU,YAAA,CAEhE,KAAK,MAAA,CAAO,CAAA,EAAKH,EACjB,IAAA,CAAK,MAAA,CAAO,GAAKC,CAAAA,CAGb,IAAA,CAAK,MAAA,CAAO,CAAA,CAAI,CAAA,CAClB,IAAA,CAAK,OAAO,CAAA,CAAI,CAAC,KAAK,IAAA,CAAK,CAAC,KAAK,MAAA,CAAO,CAAC,CAAA,CAAI,EAAA,CACpC,IAAA,CAAK,MAAA,CAAO,EAAIC,CAAAA,GACzB,IAAA,CAAK,OAAO,CAAA,CAAIA,CAAAA,CAAa,KAAK,IAAA,CAAK,IAAA,CAAK,MAAA,CAAO,CAAA,CAAIA,CAAU,CAAA,CAAI,IAGnE,IAAA,CAAK,MAAA,CAAO,CAAA,CAAI,CAAA,CAClB,IAAA,CAAK,MAAA,CAAO,EAAI,CAAC,IAAA,CAAK,IAAA,CAAK,CAAC,IAAA,CAAK,MAAA,CAAO,CAAC,CAAA,CAAI,EAAA,CACpC,KAAK,MAAA,CAAO,CAAA,CAAIC,IACzB,IAAA,CAAK,MAAA,CAAO,CAAA,CAAIA,CAAAA,CAAa,IAAA,CAAK,IAAA,CAAK,KAAK,MAAA,CAAO,CAAA,CAAIA,CAAU,CAAA,CAAI,EAAA,CAAA,CAIvE,EAAE,cAAA,GACJ,CAAA,KAAO,CACL,IAAA,CAAK,MAAA,CAAO,GAAKH,CAAAA,CACjB,IAAA,CAAK,OAAO,CAAA,EAAKC,CAAAA,CAGjB,IAAMC,CAAAA,CAAa,IAAA,CAAK,SAAA,CAAU,WAAA,CAAc,IAAA,CAAK,SAAA,CAAU,YACzDC,CAAAA,CAAa,IAAA,CAAK,SAAA,CAAU,YAAA,CAAe,IAAA,CAAK,SAAA,CAAU,aAEhE,IAAA,CAAK,MAAA,CAAO,CAAA,CAAI,IAAA,CAAK,GAAA,CAAI,CAAA,CAAG,KAAK,GAAA,CAAI,IAAA,CAAK,OAAO,CAAA,CAAGD,CAAU,CAAC,CAAA,CAC/D,IAAA,CAAK,MAAA,CAAO,CAAA,CAAI,IAAA,CAAK,GAAA,CAAI,EAAG,IAAA,CAAK,GAAA,CAAI,KAAK,MAAA,CAAO,CAAA,CAAGC,CAAU,CAAC,EACjE,CAEA,IAAA,CAAK,eAAA,GACP,EAxFE,IAAA,CAAK,SAAA,CAAYJ,EACjB,IAAA,CAAK,MAAA,CAAS,CAAE,GAAGF,EAAAA,CAAqB,GAAG/L,CAAO,CAAA,CAGlD,IAAMgH,EAAe,CACnB,SAAA,CAAW,IAAA,CAAK,MAAA,CAAO,SAAA,CACvB,OAAA,CAAS,KAAK,MAAA,CAAO,OAAA,CACrB,IAAA,CAAM,IAAA,CAAK,MAAA,CAAO,IAAA,CAClB,UAAW,IAAA,CAAK,MAAA,CAAO,UACvB,SAAA,CAAW,IAAA,CAAK,OAAO,SAAA,CACvB,KAAA,CAAO,IAAA,CAAK,MAAA,CAAO,KACrB,CAAA,CAEA,KAAK,OAAA,CAAU9B,CAAAA,CAAkB,EAAG8B,CAAY,CAAA,CAChD,KAAK,OAAA,CAAU9B,CAAAA,CAAkB,CAAA,CAAG8B,CAAY,CAAA,CAGhD,IAAA,CAAK,QAAQ,SAAA,CAAU,IAAM,CAC3B,IAAA,CAAK,MAAA,CAAO,EAAI,IAAA,CAAK,OAAA,CAAQ,GAAA,EAAI,CACjC,IAAA,CAAK,MAAA,CAAO,WAAW,IAAA,CAAK,MAAA,CAAO,CAAA,CAAG,IAAA,CAAK,MAAA,CAAO,CAAC,EACrD,CAAC,CAAA,CAED,IAAA,CAAK,OAAA,CAAQ,SAAA,CAAU,IAAM,CAC3B,IAAA,CAAK,MAAA,CAAO,EAAI,IAAA,CAAK,OAAA,CAAQ,KAAI,CACjC,IAAA,CAAK,MAAA,CAAO,QAAA,GAAW,IAAA,CAAK,MAAA,CAAO,EAAG,IAAA,CAAK,MAAA,CAAO,CAAC,EACrD,CAAC,EAED,IAAA,CAAK,iBAAA,GACP,CAEQ,iBAAA,EAA0B,CAChC,KAAK,SAAA,CAAU,gBAAA,CAAiB,QAAS,IAAA,CAAK,OAAA,CAAS,CAAE,OAAA,CAAS,KAAM,CAAC,EAC3E,CA0DQ,eAAA,EAAwB,CAE9B,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,MAAA,CAAO,CAAC,EAC9B,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,MAAA,CAAO,CAAC,EAG9B,IAAMsF,CAAAA,CAAW,IAAM,CAEnB,IAAA,CAAK,IAAI,IAAA,CAAK,MAAA,CAAO,CAAA,CAAI,IAAA,CAAK,MAAA,CAAO,CAAC,EAAI,EAAA,EAC1C,IAAA,CAAK,IAAI,IAAA,CAAK,MAAA,CAAO,EAAI,IAAA,CAAK,MAAA,CAAO,CAAC,CAAA,CAAI,EAAA,EAC1C,CAAC,KAAK,OAAA,CAAQ,WAAA,IACd,CAAC,IAAA,CAAK,QAAQ,WAAA,EAAY,EAEb,IAAA,CAAK,WAAA,EAClB,IAAA,CAAK,WAAA,CAAc,MACnB,IAAA,CAAK,MAAA,CAAO,WAAA,IAAc,EACjB,IAAA,CAAK,WAAA,EACd,sBAAsBA,CAAQ,EAElC,CAAA,CAEAA,CAAAA,GACF,CAEA,WAAsC,CACpC,OAAO,CAAE,GAAG,IAAA,CAAK,MAAO,CAC1B,CAEA,QAAA,CAAShB,CAAAA,CAAWC,CAAAA,CAAiB,CACnC,KAAK,MAAA,CAAS,CAAE,CAAA,CAAAD,CAAAA,CAAG,CAAA,CAAAC,CAAE,EACrB,IAAA,CAAK,OAAA,CAAQ,GAAA,CAAID,CAAC,CAAA,CAClB,IAAA,CAAK,QAAQ,GAAA,CAAIC,CAAC,EACpB,CAEA,eAAA,CAAgBL,EAAsB5E,CAAAA,CAAS,CAAA,CAAS,CACtD,IAAMiG,CAAAA,CAAgB,IAAA,CAAK,UAAU,qBAAA,EAAsB,CACrDC,CAAAA,CAActB,CAAAA,CAAQ,qBAAA,EAAsB,CAE5CI,EAAIkB,CAAAA,CAAY,IAAA,CAAOD,CAAAA,CAAc,IAAA,CAAO,IAAA,CAAK,MAAA,CAAO,EAAIjG,CAAAA,CAC5DiF,CAAAA,CAAIiB,EAAY,GAAA,CAAMD,CAAAA,CAAc,IAAM,IAAA,CAAK,MAAA,CAAO,CAAA,CAAIjG,CAAAA,CAEhE,IAAA,CAAK,QAAA,CAASgF,EAAGC,CAAC,EACpB,CAEA,MAAA,EAAe,CACb,KAAK,SAAA,CAAY,KACnB,CAEA,OAAA,EAAgB,CACd,IAAA,CAAK,UAAY,MACnB,CAEA,SAAgB,CACd,IAAA,CAAK,UAAU,mBAAA,CAAoB,OAAA,CAAS,IAAA,CAAK,OAAO,CAAA,CACxD,IAAA,CAAK,QAAQ,OAAA,EAAQ,CACrB,IAAA,CAAK,OAAA,CAAQ,OAAA,GACf,CACF,CAAA,CAkBO,SAASkB,EAAAA,CACdR,CAAAA,CACAjM,CAAAA,CACc,CACd,OAAO,IAAIgM,CAAAA,CAAiBC,EAAWjM,CAAM,CAC/C,CClPO,SAAS0M,EAAAA,CAAWzC,CAAAA,CAAoB,CAG7C,GADiBA,CAAAA,CAAM,MAAM,+BAA+B,CAAA,CAE1D,OAAO0C,CAAAA,CAAS1C,CAAK,EAIvB,IAAMG,CAAAA,CAAWH,CAAAA,CAAM,KAAA,CAAM,iCAAiC,CAAA,CAC9D,GAAIG,CAAAA,CACF,OAAO,CACL,CAAA,CAAG,QAAA,CAASA,EAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CAC5B,CAAA,CAAG,QAAA,CAASA,EAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CAC5B,CAAA,CAAG,QAAA,CAASA,EAAS,CAAC,CAAA,CAAI,EAAE,CAC9B,CAAA,CAIF,IAAMC,EAAYJ,CAAAA,CAAM,KAAA,CAAM,4CAA4C,CAAA,CAC1E,GAAII,EACF,OAAO,CACL,CAAA,CAAG,QAAA,CAASA,CAAAA,CAAU,CAAC,EAAI,EAAE,CAAA,CAC7B,EAAG,QAAA,CAASA,CAAAA,CAAU,CAAC,CAAA,CAAI,EAAE,CAAA,CAC7B,CAAA,CAAG,QAAA,CAASA,CAAAA,CAAU,CAAC,CAAA,CAAI,EAAE,CAC/B,CAAA,CAIF,IAAMC,EAAWL,CAAAA,CAAM,KAAA,CAAM,mCAAmC,CAAA,CAChE,OAAIK,CAAAA,CACKsC,EACL,QAAA,CAAStC,CAAAA,CAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CACzB,SAASA,CAAAA,CAAS,CAAC,CAAA,CAAI,EAAE,CAAA,CACzB,QAAA,CAASA,EAAS,CAAC,CAAA,CAAI,EAAE,CAC3B,CAAA,CAIK,CAAE,CAAA,CAAG,CAAA,CAAG,CAAA,CAAG,CAAA,CAAG,CAAA,CAAG,CAAE,CAC5B,CASO,SAASuC,GAAS9C,CAAAA,CAAWC,CAAAA,CAAWjH,EAAmB,CAChE,IAAM+J,CAAAA,CAASC,CAAAA,EACG,IAAA,CAAK,KAAA,CAAM,KAAK,GAAA,CAAI,CAAA,CAAG,KAAK,GAAA,CAAI,GAAA,CAAKA,CAAC,CAAC,CAAC,CAAA,CACzC,QAAA,CAAS,EAAE,CAAA,CAAE,SAAS,CAAA,CAAG,GAAG,CAAA,CAE7C,OAAO,CAAA,CAAA,EAAID,CAAAA,CAAM/C,CAAC,CAAC,CAAA,EAAG+C,CAAAA,CAAM9C,CAAC,CAAC,CAAA,EAAG8C,EAAM/J,CAAC,CAAC,EAC3C,CAOO,SAAS4J,EAASxC,CAAAA,CAAkB,CACzC,IAAM6C,CAAAA,CAAW7C,CAAAA,CAAI,OAAA,CAAQ,IAAK,EAAE,CAAA,CAEpC,OAAI6C,CAAAA,CAAS,MAAA,GAAW,EACf,CACL,CAAA,CAAG,QAAA,CAASA,CAAAA,CAAS,MAAA,CAAO,CAAC,EAAIA,CAAAA,CAAS,MAAA,CAAO,CAAC,CAAA,CAAG,EAAE,EACvD,CAAA,CAAG,QAAA,CAASA,CAAAA,CAAS,MAAA,CAAO,CAAC,CAAA,CAAIA,EAAS,MAAA,CAAO,CAAC,CAAA,CAAG,EAAE,CAAA,CACvD,CAAA,CAAG,SAASA,CAAAA,CAAS,MAAA,CAAO,CAAC,CAAA,CAAIA,CAAAA,CAAS,MAAA,CAAO,CAAC,CAAA,CAAG,EAAE,CACzD,CAAA,CAGK,CACL,EAAG,QAAA,CAASA,CAAAA,CAAS,KAAA,CAAM,CAAA,CAAG,CAAC,CAAA,CAAG,EAAE,CAAA,CACpC,CAAA,CAAG,SAASA,CAAAA,CAAS,KAAA,CAAM,EAAG,CAAC,CAAA,CAAG,EAAE,CAAA,CACpC,CAAA,CAAG,QAAA,CAASA,EAAS,KAAA,CAAM,CAAA,CAAG,CAAC,CAAA,CAAG,EAAE,CACtC,CACF,CASO,SAASJ,CAAAA,CAASrC,CAAAA,CAAWjD,CAAAA,CAAWkD,EAAgB,CAK7D,GAJAD,CAAAA,CAAAA,CAAMA,CAAAA,CAAI,GAAA,CAAO,GAAA,EAAO,IACxBjD,CAAAA,CAAI,IAAA,CAAK,GAAA,CAAI,CAAA,CAAG,IAAA,CAAK,GAAA,CAAI,IAAKA,CAAC,CAAC,EAAI,GAAA,CACpCkD,CAAAA,CAAI,KAAK,GAAA,CAAI,CAAA,CAAG,IAAA,CAAK,GAAA,CAAI,GAAA,CAAKA,CAAC,CAAC,CAAA,CAAI,GAAA,CAEhClD,IAAM,CAAA,CAAG,CACX,IAAMmD,CAAAA,CAAO,IAAA,CAAK,KAAA,CAAMD,CAAAA,CAAI,GAAG,CAAA,CAC/B,OAAO,CAAE,CAAA,CAAGC,EAAM,CAAA,CAAGA,CAAAA,CAAM,EAAGA,CAAK,CACrC,CAEA,IAAMC,CAAAA,CAAU,CAACC,EAAWC,CAAAA,CAAWC,CAAAA,IACjCA,CAAAA,CAAI,CAAA,GAAGA,CAAAA,EAAK,CAAA,CAAA,CACZA,EAAI,CAAA,GAAGA,CAAAA,EAAK,CAAA,CAAA,CACZA,CAAAA,CAAI,CAAA,CAAI,CAAA,CAAUF,GAAKC,CAAAA,CAAID,CAAAA,EAAK,EAAIE,CAAAA,CACpCA,CAAAA,CAAI,EAAI,CAAA,CAAUD,CAAAA,CAClBC,CAAAA,CAAI,CAAA,CAAI,CAAA,CAAUF,CAAAA,CAAAA,CAAKC,EAAID,CAAAA,GAAM,CAAA,CAAI,EAAIE,CAAAA,CAAAA,CAAK,CAAA,CAC3CF,GAGHC,CAAAA,CAAIJ,CAAAA,CAAI,EAAA,CAAMA,CAAAA,EAAK,CAAA,CAAIlD,CAAAA,CAAAA,CAAKkD,EAAIlD,CAAAA,CAAIkD,CAAAA,CAAIlD,EACxCqD,CAAAA,CAAI,CAAA,CAAIH,EAAII,CAAAA,CAElB,OAAO,CACL,CAAA,CAAG,IAAA,CAAK,KAAA,CAAMF,EAAQC,CAAAA,CAAGC,CAAAA,CAAGL,CAAAA,CAAI,GAAA,CAAM,CAAA,CAAI,CAAC,EAAI,GAAG,CAAA,CAClD,CAAA,CAAG,IAAA,CAAK,KAAA,CAAMG,CAAAA,CAAQC,EAAGC,CAAAA,CAAGL,CAAAA,CAAI,GAAG,CAAA,CAAI,GAAG,EAC1C,CAAA,CAAG,IAAA,CAAK,KAAA,CAAMG,CAAAA,CAAQC,CAAAA,CAAGC,CAAAA,CAAGL,EAAI,GAAA,CAAM,CAAA,CAAI,CAAC,CAAA,CAAI,GAAG,CACpD,CACF,CASO,SAAS0C,EAAAA,CAASlD,CAAAA,CAAWC,CAAAA,CAAWjH,EAAgB,CAC7DgH,CAAAA,CAAI,KAAK,GAAA,CAAI,CAAA,CAAG,KAAK,GAAA,CAAI,GAAA,CAAKA,CAAC,CAAC,CAAA,CAAI,GAAA,CACpCC,EAAI,IAAA,CAAK,GAAA,CAAI,CAAA,CAAG,IAAA,CAAK,GAAA,CAAI,GAAA,CAAKA,CAAC,CAAC,CAAA,CAAI,GAAA,CACpCjH,CAAAA,CAAI,IAAA,CAAK,GAAA,CAAI,EAAG,IAAA,CAAK,GAAA,CAAI,IAAKA,CAAC,CAAC,EAAI,GAAA,CAEpC,IAAML,CAAAA,CAAM,IAAA,CAAK,GAAA,CAAIqH,CAAAA,CAAGC,EAAGjH,CAAC,CAAA,CACtBN,EAAM,IAAA,CAAK,GAAA,CAAIsH,EAAGC,CAAAA,CAAGjH,CAAC,CAAA,CACtBV,CAAAA,CAAQK,CAAAA,CAAMD,CAAAA,CAEhB8H,EAAI,CAAA,CACJjD,CAAAA,CAAI,EAER,OAAIjF,CAAAA,GAAU,IACZiF,CAAAA,CAAAA,CAAK5E,CAAAA,CAAMD,CAAAA,EAAO,CAAA,CAAI,EAAA,CAClBJ,CAAAA,EAAS,EAAIK,CAAAA,CAAMD,CAAAA,CAAAA,CACnBJ,CAAAA,EAASK,CAAAA,CAAMD,CAAAA,CAAAA,CAEfC,CAAAA,GAAQqH,EACVQ,CAAAA,CAAAA,CAAAA,CAAMP,CAAAA,CAAIjH,CAAAA,EAAKV,CAAAA,EAAS2H,CAAAA,CAAIjH,CAAAA,CAAI,EAAI,CAAA,CAAA,EAAM,CAAA,CACjCL,IAAQsH,CAAAA,CACjBO,CAAAA,CAAAA,CAAAA,CAAMxH,EAAIgH,CAAAA,EAAK1H,CAAAA,CAAQ,CAAA,EAAK,CAAA,CAE5BkI,CAAAA,CAAAA,CAAAA,CAAMR,CAAAA,CAAIC,GAAK3H,CAAAA,CAAQ,CAAA,EAAK,GAIzB,CACL,CAAA,CAAG,KAAK,KAAA,CAAMkI,CAAAA,CAAI,GAAG,CAAA,CACrB,CAAA,CAAG,IAAA,CAAK,MAAMjD,CAAAA,CAAI,GAAG,EACrB,CAAA,CAAG,IAAA,CAAK,OAAQ5E,CAAAA,CAAMD,CAAAA,EAAO,CAAA,CAAK,GAAG,CACvC,CACF,CC1IO,IAAMyK,CAAAA,CAAN,KAA8B,CAUnC,WAAA,CAAYC,CAAAA,CAAiBlH,EAA8B,EAAC,CAAG,CAR/D,IAAA,CAAQ,SAAA,CAAoB,CAAA,CAC5B,KAAQ,YAAA,CAA8C,IAAI,IAC1D,IAAA,CAAQ,eAAA,CAA0D,IAAI,GAAA,CACtE,IAAA,CAAQ,YAAA,CAA4D,IAAA,CAEpE,IAAA,CAAQ,YAAA,CAAwB,MAChC,IAAA,CAAQ,UAAA,CAAsB,MAG5B,IAAA,CAAK,MAAA,CAASkH,EACd,IAAA,CAAK,aAAA,CAAgBlH,CAAAA,CAAQ,MAAA,EAAU,CAAE,SAAA,CAAW,IAAK,OAAA,CAAS,EAAG,EAGjE,OAAOkH,CAAAA,EAAiB,WAC1B,IAAA,CAAK,YAAA,CAAejI,CAAAA,CAAkBiI,CAAAA,CAAwB,CAC5D,GAAG,KAAK,aAAA,CACR,QAAA,CAAWjF,CAAAA,EAAc,CACnB,IAAA,CAAK,UAAA,GACT,KAAK,MAAA,CAASA,CAAAA,CACd,IAAA,CAAK,SAAA,CAAY,IAAA,CAAK,YAAA,EAAc,aAAY,EAAK,CAAA,CACrD,KAAK,OAAA,EAAQ,EACf,CACF,CAAC,CAAA,EAEL,CAKA,GAAA,EAAS,CACP,OAAO,KAAK,MACd,CAKA,aAAsB,CACpB,OAAO,KAAK,SACd,CAKA,WAAA,EAAuB,CACrB,OAAO,IAAA,CAAK,YACd,CAKA,GAAA,CAAIkF,EAAapH,CAAAA,CAAmB,IAAA,CAAY,CAC9C,GAAI,CAAA,IAAA,CAAK,UAAA,CAET,GAAI,OAAOoH,CAAAA,EAAa,UAAY,IAAA,CAAK,YAAA,EAAgBpH,CAAAA,CAAS,CAChE,IAAA,CAAK,YAAA,CAAe,KACpB,IAAA,CAAK,KAAA,CAAM,gBAAgB,CAAA,CAE3B,IAAA,CAAK,YAAA,CAAa,IAAIoH,CAAkB,CAAA,CAGxC,IAAMd,CAAAA,CAAW,IAAM,CACjB,IAAA,CAAK,YAAA,EAAgB,IAAA,CAAK,GAAA,CAAI,IAAA,CAAK,YAAA,CAAa,aAAa,CAAA,CAAI,KACnE,IAAA,CAAK,YAAA,CAAe,MACpB,IAAA,CAAK,KAAA,CAAM,cAAc,CAAA,EAChB,IAAA,CAAK,YAAA,EACd,sBAAsBA,CAAQ,EAElC,EACA,qBAAA,CAAsBA,CAAQ,EAChC,CAAA,KACE,IAAA,CAAK,MAAA,CAASc,CAAAA,CACd,IAAA,CAAK,SAAA,CAAY,EACjB,IAAA,CAAK,OAAA,GAET,CAKA,IAAA,CAAKA,CAAAA,CAAmB,CAClB,IAAA,CAAK,UAAA,GAET,IAAA,CAAK,MAAA,CAASA,CAAAA,CACd,IAAA,CAAK,UAAY,CAAA,CAEb,OAAOA,GAAa,QAAA,EAAY,IAAA,CAAK,cACvC,IAAA,CAAK,YAAA,CAAa,IAAA,CAAKA,CAAkB,CAAA,CAG3C,IAAA,CAAK,aAAe,KAAA,CACpB,IAAA,CAAK,SAAQ,EACf,CAKA,MAAa,CAEP,IAAA,CAAK,YAAA,EACP,IAAA,CAAK,YAAA,CAAa,IAAA,CAAK,KAAK,YAAA,CAAa,GAAA,EAAK,CAAA,CAEhD,IAAA,CAAK,aAAe,KAAA,CACpB,IAAA,CAAK,KAAA,CAAM,cAAc,EAC3B,CAMA,UAAUjL,CAAAA,CAAgD,CACxD,OAAA,IAAA,CAAK,YAAA,CAAa,GAAA,CAAIA,CAAQ,EAG9BA,CAAAA,CAAS,IAAA,CAAK,MAAM,CAAA,CAEb,IAAM,CACX,KAAK,YAAA,CAAa,MAAA,CAAOA,CAAQ,EACnC,CACF,CAKA,EAAA,CAAGkL,CAAAA,CAAyBlL,CAAAA,CAAkC,CAC5D,OAAK,IAAA,CAAK,gBAAgB,GAAA,CAAIkL,CAAK,CAAA,EACjC,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAIA,EAAO,IAAI,GAAK,CAAA,CAE3C,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAIA,CAAK,CAAA,CAAG,GAAA,CAAIlL,CAAQ,CAAA,CAEtC,IAAM,CACX,IAAA,CAAK,eAAA,CAAgB,GAAA,CAAIkL,CAAK,CAAA,EAAG,MAAA,CAAOlL,CAAQ,EAClD,CACF,CAKA,SAAA,CAAUnC,CAAAA,CAAqC,CAC7C,KAAK,aAAA,CAAgB,CAAE,GAAG,IAAA,CAAK,aAAA,CAAe,GAAGA,CAAO,EAE1D,CAKA,SAAgB,CACd,IAAA,CAAK,WAAa,IAAA,CAClB,IAAA,CAAK,YAAA,CAAa,KAAA,EAAM,CACxB,IAAA,CAAK,gBAAgB,KAAA,EAAM,CAEvB,KAAK,YAAA,GACP,IAAA,CAAK,aAAa,OAAA,EAAQ,CAC1B,IAAA,CAAK,YAAA,CAAe,IAAA,EAExB,CAEQ,SAAgB,CACtB,IAAA,CAAK,aAAa,OAAA,CAASmC,CAAAA,EAAa,CACtC,GAAI,CACFA,CAAAA,CAAS,IAAA,CAAK,MAAM,EACtB,OAASmL,CAAAA,CAAG,CACV,OAAA,CAAQ,KAAA,CAAM,+BAAA,CAAiCA,CAAC,EAClD,CACF,CAAC,CAAA,CACD,IAAA,CAAK,KAAA,CAAM,QAAQ,EACrB,CAEQ,KAAA,CAAMD,EAA+B,CAC3C,IAAA,CAAK,gBAAgB,GAAA,CAAIA,CAAK,CAAA,EAAG,OAAA,CAASlL,CAAAA,EAAa,CACrD,GAAI,CACFA,CAAAA,GACF,CAAA,MAASmL,CAAAA,CAAG,CACV,OAAA,CAAQ,KAAA,CAAM,CAAA,YAAA,EAAeD,CAAK,CAAA,gBAAA,CAAA,CAAoBC,CAAC,EACzD,CACF,CAAC,EACH,CACF,EAYO,SAASC,EAAAA,CACdJ,CAAAA,CACAlH,CAAAA,CACgB,CAChB,OAAO,IAAIiH,EAAYC,CAAAA,CAAclH,CAAO,CAC9C,CAeO,SAASuH,CAAAA,CACdtE,EACAuE,CAAAA,CACgB,CAChB,IAAMC,CAAAA,CAAU,IAAIR,CAAAA,CAAeO,EAAUvE,CAAAA,CAAO,GAAA,EAAK,CAAC,CAAA,CAE1D,OAAAA,CAAAA,CAAO,SAAA,CAAW1G,CAAAA,EAAU,CAC1BkL,CAAAA,CAAQ,IAAA,CAAKD,EAAUjL,CAAK,CAAC,EAC/B,CAAC,CAAA,CAEMkL,CACT,CAcO,SAAS1K,EAAAA,CACdkG,CAAAA,CACAyE,CAAAA,CACAC,CAAAA,CACA3H,EAA+B,EAAC,CACX,CACrB,GAAM,CAAChD,EAAOC,CAAK,CAAA,CAAIyK,CAAAA,CACjB,CAACxK,CAAAA,CAAQC,CAAM,EAAIwK,CAAAA,CAEzB,OAAOJ,CAAAA,CAAetE,CAAAA,CAAS1G,CAAAA,EAAU,CACvC,IAAIqL,CAAAA,CAAAA,CAAcrL,CAAAA,CAAQS,CAAAA,GAAUC,CAAAA,CAAQD,CAAAA,CAAAA,CAE5C,OAAIgD,EAAQ,KAAA,GACV4H,CAAAA,CAAa,KAAK,GAAA,CAAI,CAAA,CAAG,KAAK,GAAA,CAAI,CAAA,CAAGA,CAAU,CAAC,CAAA,CAAA,CAG3C1K,CAAAA,CAAS0K,GAAczK,CAAAA,CAASD,CAAAA,CACzC,CAAC,CACH,CCjOO,SAAS2K,EAAAA,CACd5C,CAAAA,CACAjF,CAAAA,CAAgC,EAAC,CAClB,CACf,GAAM,CACJ,MAAA,CAAAjG,EAAS,EAAC,CACV,SAAA+N,CAAAA,CAAW,KAAA,CACX,QAAA,CAAA/F,CAAAA,CACA,UAAA,CAAAD,CACF,EAAI9B,CAAAA,CAGE+H,CAAAA,CAAc9C,CAAAA,CAAQ,cAAA,IAAiB,EAAK,CAAA,CAGlDA,EAAQ,KAAA,CAAM,eAAA,CAAkB,MAAA,CAAO8C,CAAW,CAAA,CAClD9C,CAAAA,CAAQ,MAAM,gBAAA,CAAmB,MAAA,CAAO8C,CAAW,CAAA,CAEnD,IAAIxF,EAAe,CAAA,CACfC,CAAAA,CAAY,KAAA,CACV9D,CAAAA,CAASO,CAAAA,CAAkB,CAAA,CAAGlF,CAAM,CAAA,CAGpCwH,CAAAA,CAAc7C,EAAO,SAAA,CAAWnC,CAAAA,EAAU,CAC9C,GAAIiG,CAAAA,CAAW,OAEfD,CAAAA,CAAehG,CAAAA,CAEf,IAAM8D,EAAS0H,CAAAA,EAAe,CAAA,CAAIxL,GAClC0I,CAAAA,CAAQ,KAAA,CAAM,iBAAmB,MAAA,CAAO5E,CAAM,CAAA,CAC9C0B,CAAAA,GAAWxF,CAAK,EAClB,CAAC,CAAA,CAEKyL,CAAAA,CAAc,IACX,IAAI,OAAA,CAAS1J,CAAAA,EAAY,CAC9B,IAAM2J,CAAAA,CAAQ,IAAM,CACdzF,CAAAA,EAAa,CAAC9D,EAAO,WAAA,EAAY,CACnCJ,GAAQ,CAER,qBAAA,CAAsB2J,CAAK,EAE/B,CAAA,CACA,UAAA,CAAWA,CAAAA,CAAO,EAAE,EACtB,CAAC,CAAA,CAGGlM,CAAAA,CAA2B,CAC/B,IAAA,CAAM,MAAOjC,EAAS,CAAA,GAAM,CACtB0I,CAAAA,GACJ9D,CAAAA,CAAO,GAAA,CAAI5E,CAAM,EACjB,MAAMkO,CAAAA,GACNlG,CAAAA,IAAa,EACf,EAEA,OAAA,CAAS,SAAY,CACfU,CAAAA,GACJ9D,CAAAA,CAAO,GAAA,CAAI,CAAC,CAAA,CACZ,MAAMsJ,CAAAA,EAAY,CAClBlG,CAAAA,IAAa,EACf,EAEA,GAAA,CAAK,CAACvF,CAAAA,CAAewD,CAAAA,CAAU,KAAA,GAAU,CACvC,GAAI,CAAAyC,CAAAA,CAEJ,GAAIzC,CAAAA,CACFrB,CAAAA,CAAO,IAAInC,CAAK,CAAA,CAAA,KACX,CACLmC,CAAAA,CAAO,IAAA,CAAKnC,CAAK,EACjBgG,CAAAA,CAAehG,CAAAA,CACf,IAAM8D,CAAAA,CAAS0H,CAAAA,EAAe,EAAIxL,CAAAA,CAAAA,CAClC0I,CAAAA,CAAQ,KAAA,CAAM,gBAAA,CAAmB,MAAA,CAAO5E,CAAM,EAChD,CACF,CAAA,CAEA,IAAK,IAAMkC,CAAAA,CAEX,MAAO,IAAM,CACPC,CAAAA,EACJ9D,CAAAA,CAAO,IAAA,GACT,EAEA,MAAA,CAAQ,IAAM,CACR8D,CAAAA,EAEJ9D,CAAAA,CAAO,GAAA,CAAI6D,CAAY,EACzB,CAAA,CAEA,KAAA,CAAO,IAAM,CACPC,CAAAA,GACJ9D,EAAO,IAAA,CAAK,CAAC,EACb6D,CAAAA,CAAe,CAAA,CACf0C,EAAQ,KAAA,CAAM,gBAAA,CAAmB,MAAA,CAAO8C,CAAW,CAAA,EACrD,CAAA,CAEA,YAAa,IAAMrJ,CAAAA,CAAO,WAAA,EAAY,CAEtC,OAAA,CAAS,IAAM,CACb8D,CAAAA,CAAY,IAAA,CACZjB,CAAAA,EAAY,CACZ7C,CAAAA,CAAO,OAAA,GACT,CACF,CAAA,CAEA,OAAIoJ,CAAAA,EACF/L,CAAAA,CAAU,MAAK,CAGVA,CACT,CAKO,SAASmM,EAAAA,CACdjD,CAAAA,CACQ,CACR,OAAOA,CAAAA,CAAQ,cAAA,IAAiB,EAAK,CACvC,CAKO,SAASkD,EAAAA,CACdlD,CAAAA,CACAmD,CAAAA,CAAkB,CAAA,CACZ,CACN,IAAMC,EAASpD,CAAAA,CAAQ,cAAA,MAAsB,CAAA,CAC7CA,CAAAA,CAAQ,MAAM,eAAA,CAAkB,MAAA,CAAOoD,CAAM,CAAA,CAC7CpD,CAAAA,CAAQ,KAAA,CAAM,iBAAmB,MAAA,CAAOoD,CAAAA,EAAU,EAAID,CAAAA,CAAgB,EACxE,CAKO,SAASE,EAAAA,CACdC,CAAAA,CACAC,CAAAA,CACiB,CACjB,GAAI,CACF,IAAMH,CAAAA,CAASE,EAAK,cAAA,EAAe,CACnC,OAAOA,CAAAA,CAAK,gBAAA,CAAiBF,CAAAA,CAAS,IAAA,CAAK,GAAA,CAAI,CAAA,CAAG,KAAK,GAAA,CAAI,CAAA,CAAGG,CAAQ,CAAC,CAAC,CAC1E,MAAQ,CACN,OAAO,IACT,CACF,CCvKO,SAASC,EAAexD,CAAAA,CAAmC,CAChE,IAAMyD,CAAAA,CAAOzD,CAAAA,CAAQ,uBAAsB,CAC3C,OAAO,CACL,CAAA,CAAGyD,CAAAA,CAAK,IAAA,CAAO,OAAO,OAAA,CACtB,CAAA,CAAGA,EAAK,GAAA,CAAM,MAAA,CAAO,QACrB,KAAA,CAAOA,CAAAA,CAAK,KAAA,CACZ,MAAA,CAAQA,CAAAA,CAAK,MACf,CACF,CAqCO,SAASC,EACd1D,CAAAA,CACA2D,CAAAA,CACAC,EACA7I,CAAAA,CAAuB,EAAC,CACT,CACf,GAAM,CACJ,OAAAjG,CAAAA,CAAS,EAAC,CACV,QAAA,CAAAH,CAAAA,CAAW,IAAA,CACX,KAAAkP,CAAAA,CAAO,IAAA,CACP,UAAA,CAAAhH,CAAAA,CACA,QAAA,CAAAC,CACF,EAAI/B,CAAAA,CAGEiG,CAAAA,CAAS2C,EAAM,CAAA,CAAIC,CAAAA,CAAK,EACxB3C,CAAAA,CAAS0C,CAAAA,CAAM,CAAA,CAAIC,CAAAA,CAAK,CAAA,CACxBE,CAAAA,CAAaH,EAAM,KAAA,CAAQC,CAAAA,CAAK,MAChCG,CAAAA,CAAcJ,CAAAA,CAAM,OAASC,CAAAA,CAAK,MAAA,CAEpCL,CAAAA,CAAW,CAAA,CACXnG,CAAAA,CAAY,KAAA,CACZ4G,EAAY,KAAA,CAEVvK,CAAAA,CAASO,EAAkB,CAAA,CAAGlF,CAAM,EAGpCmP,CAAAA,CAAoBjE,CAAAA,CAAQ,KAAA,CAAM,SAAA,CAClCkE,CAAAA,CAA0BlE,CAAAA,CAAQ,MAAM,eAAA,CAG1C6D,CAAAA,GACF7D,CAAAA,CAAQ,KAAA,CAAM,eAAA,CAAkB,KAAA,CAAA,CAGlC,IAAMmE,CAAAA,CAAkBxE,CAAAA,EAAc,CACpC4D,CAAAA,CAAW5D,CAAAA,CACX,IAAMyE,EAAY,CAAA,CAAIzE,CAAAA,CAEhB0E,EAAuB,EAAC,CAM9B,GAJI1P,CAAAA,EACF0P,CAAAA,CAAW,IAAA,CAAK,CAAA,UAAA,EAAarD,CAAAA,CAASoD,CAAS,OAAOnD,CAAAA,CAASmD,CAAS,KAAK,CAAA,CAG3EP,CAAAA,GAASC,IAAe,CAAA,EAAKC,CAAAA,GAAgB,CAAA,CAAA,CAAI,CACnD,IAAMO,CAAAA,CAAS,GAAKR,CAAAA,CAAa,CAAA,EAAKM,EAChCG,EAAAA,CAAS,CAAA,CAAA,CAAKR,EAAc,CAAA,EAAKK,CAAAA,CACvCC,CAAAA,CAAW,IAAA,CAAK,CAAA,MAAA,EAASC,CAAM,KAAKC,EAAM,CAAA,CAAA,CAAG,EAC/C,CAEAvE,CAAAA,CAAQ,KAAA,CAAM,UAAYqE,CAAAA,CAAW,MAAA,CAAS,CAAA,CAAIA,CAAAA,CAAW,IAAA,CAAK,GAAG,EAAI,EAAA,CACzEvH,CAAAA,GAAW6C,CAAC,EACd,CAAA,CAGAwE,EAAe,CAAC,CAAA,CAEhB,IAAMK,CAAAA,CAAU,IAAM,CAEpBxE,EAAQ,KAAA,CAAM,SAAA,CAAYiE,EAC1BjE,CAAAA,CAAQ,KAAA,CAAM,gBAAkBkE,EAClC,CAAA,CAEA,OAAO,CACL,IAAA,CAAM,SAAY,CAChB,GAAI,CAAAF,EAEJ,OAAA5G,CAAAA,CAAY,KAEL,IAAI,OAAA,CAAe/D,CAAAA,EAAY,CACpC,IAAMiD,CAAAA,CAAc7C,EAAO,SAAA,CAAWnC,CAAAA,EAAU,CAC9C,GAAI0M,CAAAA,CAAW,CACb1H,GAAY,CACZjD,CAAAA,EAAQ,CACR,MACF,CACA8K,CAAAA,CAAe7M,CAAK,EACtB,CAAC,EAEDmC,CAAAA,CAAO,GAAA,CAAI,CAAC,CAAA,CAGZ,IAAMkE,CAAAA,CAAgB,IAAM,CAC1B,GAAIqG,EAAW,CACb1H,CAAAA,GACAkI,CAAAA,EAAQ,CACRnL,GAAQ,CACR,MACF,CAEKI,CAAAA,CAAO,WAAA,EAAY,CAOtB,sBAAsBkE,CAAa,CAAA,EANnCP,EAAY,KAAA,CACZd,CAAAA,GACAkI,CAAAA,EAAQ,CACR3H,CAAAA,IAAa,CACbxD,CAAAA,EAAQ,EAIZ,EAEA,UAAA,CAAWsE,CAAAA,CAAe,EAAE,EAC9B,CAAC,CACH,EAEA,WAAA,CAAa,IAAM4F,CAAAA,CAEnB,MAAA,CAAQ,IAAM,CACZS,EAAY,IAAA,CACZ5G,CAAAA,CAAY,MACZ3D,CAAAA,CAAO,IAAA,GACP+K,CAAAA,GACF,CAAA,CAEA,WAAA,CAAa,IAAMpH,CACrB,CACF,CAaA,eAAsBqH,GACpBzE,CAAAA,CACA0E,CAAAA,CACA3J,EAAuB,EAAC,CACT,CAEf,IAAM4I,CAAAA,CAAQH,CAAAA,CAAexD,CAAO,CAAA,CAGpC,MAAM0E,GAAO,CAIb1E,CAAAA,CAAQ,aAER,IAAM4D,CAAAA,CAAOJ,CAAAA,CAAexD,CAAO,CAAA,CAInC,MADkB0D,EAAW1D,CAAAA,CAAS2D,CAAAA,CAAOC,CAAAA,CAAM7I,CAAO,CAAA,CAC1C,IAAA,GAClB,CAeA,eAAsB4J,EAAAA,CACpBC,CAAAA,CACAF,CAAAA,CACA3J,CAAAA,CAAuB,EAAC,CACT,CAEf,IAAM8J,CAAAA,CAAcD,CAAAA,CAAS,IAAKE,CAAAA,EAAOtB,CAAAA,CAAesB,CAAE,CAAC,CAAA,CAG3D,MAAMJ,GAAO,CAIb,QAAA,CAAS,IAAA,CAAK,YAAA,CAGd,IAAMjK,CAAAA,CAAamK,EAAS,GAAA,CAAI,CAAC5E,CAAAA,CAASjJ,CAAAA,GAAM,CAC9C,IAAM6M,EAAOJ,CAAAA,CAAexD,CAAO,EACnC,OAAO0D,CAAAA,CAAW1D,EAAS6E,CAAAA,CAAY9N,CAAC,CAAA,CAAI6M,CAAAA,CAAM7I,CAAO,CAC3D,CAAC,CAAA,CAGD,MAAM,OAAA,CAAQ,GAAA,CAAIN,CAAAA,CAAW,GAAA,CAAKiB,GAASA,CAAAA,CAAK,IAAA,EAAM,CAAC,EACzD","file":"index.mjs","sourcesContent":["/**\n * Spring configuration interface\n */\nexport interface SpringConfig {\n  /** Spring stiffness (default: 100) */\n  stiffness?: number\n  /** Damping ratio (default: 10) */\n  damping?: number\n  /** Mass (default: 1) */\n  mass?: number\n  /** Initial velocity */\n  velocity?: number\n  /** Speed threshold for considering spring at rest (default: 0.01) */\n  restSpeed?: number\n  /** Position threshold for considering spring at rest (default: 0.01) */\n  restDelta?: number\n  /** Clamp value to [from, to] range */\n  clamp?: boolean\n  /** Callback called on each update */\n  onUpdate?: (value: number) => void\n  /** Callback called when animation starts */\n  onStart?: () => void\n  /** Callback called when animation reaches target */\n  onComplete?: () => void\n  /** Callback called when spring is at rest */\n  onRest?: () => void\n}\n\n/**\n * Default spring configuration\n */\nexport const defaultConfig: SpringConfig = {\n  stiffness: 100,\n  damping: 10,\n  mass: 1,\n  velocity: 0,\n  restSpeed: 0.01,\n  restDelta: 0.01,\n  clamp: false,\n}\n\n/**\n * Spring presets interface\n */\nexport interface SpringPresets {\n  /** Default spring: { stiffness: 100, damping: 10 } */\n  default: SpringConfig\n  /** Gentle spring: { stiffness: 120, damping: 14 } */\n  gentle: SpringConfig\n  /** Wobbly spring: { stiffness: 180, damping: 12 } */\n  wobbly: SpringConfig\n  /** Stiff spring: { stiffness: 210, damping: 20 } */\n  stiff: SpringConfig\n  /** Slow spring: { stiffness: 280, damping: 60 } */\n  slow: SpringConfig\n  /** Molasses spring: { stiffness: 280, damping: 120 } */\n  molasses: SpringConfig\n  /** Bouncy spring: { stiffness: 200, damping: 8 } */\n  bounce: SpringConfig\n  /** No wobble spring: { stiffness: 170, damping: 26 } */\n  noWobble: SpringConfig\n}\n\n/**\n * Built-in spring presets\n */\nexport const springPresets: SpringPresets = {\n  default: { stiffness: 100, damping: 10 },\n  gentle: { stiffness: 120, damping: 14 },\n  wobbly: { stiffness: 180, damping: 12 },\n  stiff: { stiffness: 210, damping: 20 },\n  slow: { stiffness: 280, damping: 60 },\n  molasses: { stiffness: 280, damping: 120 },\n  bounce: { stiffness: 200, damping: 8 },\n  noWobble: { stiffness: 170, damping: 26 },\n}\n\n/**\n * Create a spring config that settles in approximately the given duration\n * @param ms - Approximate settling time in milliseconds\n * @returns Spring config\n */\nexport function configFromDuration(ms: number): SpringConfig {\n  if (ms < 300) {\n    return { stiffness: 170, damping: 26 }\n  }\n  if (ms < 500) {\n    return { stiffness: 100, damping: 20 }\n  }\n  return { stiffness: 80, damping: 15 }\n}\n\n/**\n * Create a spring config with specific bounce amount\n * @param bounce - Bounce factor (0 = no bounce, 0.5 = 50% overshoot)\n * @returns Spring config\n */\nexport function configFromBounce(bounce: number): SpringConfig {\n  if (bounce <= 0) {\n    return { stiffness: 170, damping: 26 }\n  }\n  if (bounce <= 0.25) {\n    return { stiffness: 200, damping: 12 }\n  }\n  return { stiffness: 200, damping: 8 }\n}\n","import type { SpringConfig } from './config.js'\n\n/**\n * Result of a spring physics simulation step\n */\nexport interface SimulationResult {\n  /** New position */\n  position: number\n  /** New velocity */\n  velocity: number\n  /** Whether the spring is at rest */\n  isRest: boolean\n}\n\n/**\n * Simulate one step of spring physics using semi-implicit Euler integration\n *\n * The spring follows the damped harmonic oscillator equation:\n * F = -k * x - c * v\n * a = F / m\n *\n * Where:\n * - k = stiffness (spring constant)\n * - c = damping coefficient\n * - m = mass\n * - x = displacement from rest (target - position)\n * - v = velocity\n * - a = acceleration\n * - dt = time step (1/60 for 60fps animation)\n *\n * @param position - Current position\n * @param velocity - Current velocity\n * @param target - Target position (rest position)\n * @param config - Spring configuration\n * @returns Simulation result with new position, velocity, and rest state\n */\nexport function simulateSpring(\n  position: number,\n  velocity: number,\n  target: number,\n  config: SpringConfig\n): SimulationResult {\n  const {\n    stiffness = 100,\n    damping = 10,\n    mass = 1,\n    restSpeed = 0.01,\n    restDelta = 0.01,\n  } = config\n\n  // Calculate displacement from target (cached for reuse)\n  const displacement = target - position\n  const absDisplacement = Math.abs(displacement)\n  const absVelocity = Math.abs(velocity)\n\n  // Early exit optimization: if already at rest, skip expensive calculations\n  // This significantly improves performance for springs that have settled\n  if (absDisplacement <= restDelta && absVelocity <= restSpeed) {\n    return {\n      position: target, // Snap to exact target\n      velocity: 0,\n      isRest: true,\n    }\n  }\n\n  // Time step for 60fps animation\n  // This ensures the spring simulation is stable with typical stiffness values\n  const dt = 1 / 60\n\n  // Calculate spring force (Hooke's law: F = -k * x)\n  const springForce = stiffness * displacement\n\n  // Calculate damping force (opposes velocity: F = -c * v)\n  // Optimization: skip multiplication if velocity is negligible\n  const dampingForce = absVelocity > 0.0001 ? damping * velocity : 0\n\n  // Calculate total force and acceleration (Newton's second law: a = F/m)\n  const acceleration = (springForce - dampingForce) / mass\n\n  // Semi-implicit Euler integration\n  // Update velocity first, then use new velocity to update position\n  // This provides better energy conservation than standard Euler\n  const newVelocity = velocity + acceleration * dt\n  const newPosition = position + newVelocity * dt\n\n  // Check if spring is at rest\n  // Spring is at rest when:\n  // 1. Close to target position (displacement < restDelta)\n  // 2. Moving slowly (velocity < restSpeed)\n  const isRest =\n    absDisplacement <= restDelta &&\n    Math.abs(newVelocity) <= restSpeed\n\n  return {\n    position: newPosition,\n    velocity: newVelocity,\n    isRest,\n  }\n}\n\n/**\n * Calculate the period of oscillation for a spring\n * @param stiffness - Spring stiffness\n * @param mass - Spring mass\n * @returns Period in seconds\n */\nexport function calculatePeriod(stiffness: number, mass: number): number {\n  return 2 * Math.PI * Math.sqrt(mass / stiffness)\n}\n\n/**\n * Calculate the damping ratio for a spring\n * @param damping - Damping coefficient\n * @param stiffness - Spring stiffness\n * @param mass - Spring mass\n * @returns Damping ratio\n */\nexport function calculateDampingRatio(\n  damping: number,\n  stiffness: number,\n  mass: number\n): number {\n  return damping / (2 * Math.sqrt(stiffness * mass))\n}\n\n/**\n * Check if a spring is underdamped (will oscillate)\n * @param config - Spring configuration\n * @returns True if underdamped\n */\nexport function isUnderdamped(config: SpringConfig): boolean {\n  const { stiffness = 100, damping = 10, mass = 1 } = config\n  const ratio = calculateDampingRatio(damping, stiffness, mass)\n  return ratio < 1\n}\n\n/**\n * Check if a spring is critically damped (fastest return to rest without oscillation)\n * @param config - Spring configuration\n * @returns True if critically damped\n */\nexport function isCriticallyDamped(config: SpringConfig): boolean {\n  const { stiffness = 100, damping = 10, mass = 1 } = config\n  const ratio = calculateDampingRatio(damping, stiffness, mass)\n  return Math.abs(ratio - 1) < 0.001\n}\n\n/**\n * Check if a spring is overdamped (slow return to rest without oscillation)\n * @param config - Spring configuration\n * @returns True if overdamped\n */\nexport function isOverdamped(config: SpringConfig): boolean {\n  const { stiffness = 100, damping = 10, mass = 1 } = config\n  const ratio = calculateDampingRatio(damping, stiffness, mass)\n  return ratio > 1\n}\n","/**\n * Animation state enum\n */\nexport enum AnimationState {\n  Idle = 'idle',\n  Running = 'running',\n  Paused = 'paused',\n  Complete = 'complete',\n}\n\n/**\n * Interface for objects that can be animated\n */\nexport interface Animatable {\n  /**\n   * Update the animation\n   * @param now - Current timestamp from performance.now()\n   */\n  update(now: number): void\n\n  /**\n   * Check if the animation is complete\n   */\n  isComplete(): boolean\n}\n\n/**\n * Callback type for cleanup notifications\n */\nexport type CleanupCallback = (id: number) => void\n\n/**\n * Maximum allowed delta time (ms) to prevent physics explosions after tab suspension\n * If more time has passed, we clamp to this value for stable simulation\n */\nconst MAX_DELTA_TIME = 64 // ~15fps minimum, prevents huge jumps\n\n/**\n * Global animation loop manager\n * Uses requestAnimationFrame to drive all animations\n * Features:\n * - WeakRef-based animation tracking for memory safety\n * - FinalizationRegistry for cleanup callbacks\n * - Frame-drop resilience with delta time clamping\n * - Single-pass update + cleanup for O(n) performance\n * - Frame event listeners for external monitoring\n */\nclass AnimationLoop {\n  private animations = new Set<WeakRef<Animatable>>()\n  private animationMap = new WeakMap<Animatable, WeakRef<Animatable>>()\n  private rafId: number | null = null\n  private isRunning = false\n  private lastTime: number = 0\n  private nextId = 1\n  private idMap = new WeakMap<Animatable, number>()\n  private frameListeners = new Set<(deltaTime: number) => void>()\n\n  // FinalizationRegistry for automatic cleanup notifications\n  private registry = new FinalizationRegistry<number>((id) => {\n    this.cleanupCallbacks.forEach((cb) => cb(id))\n  })\n  private cleanupCallbacks = new Set<CleanupCallback>()\n\n  /**\n   * Add an animation to the loop\n   * Uses WeakRef to prevent memory leaks if animation is garbage collected\n   * @returns Unique ID for this animation\n   */\n  add(animation: Animatable): number {\n    // Check if already added\n    const existingId = this.idMap.get(animation)\n    if (existingId !== undefined) return existingId\n\n    const id = this.nextId++\n    const ref = new WeakRef(animation)\n    this.animations.add(ref)\n    this.animationMap.set(animation, ref)\n    this.idMap.set(animation, id)\n\n    // Register for finalization callback\n    this.registry.register(animation, id)\n\n    this.start()\n    return id\n  }\n\n  /**\n   * Remove an animation from the loop\n   */\n  remove(animation: Animatable): void {\n    const ref = this.animationMap.get(animation)\n    if (ref) {\n      this.animations.delete(ref)\n      this.animationMap.delete(animation)\n      this.idMap.delete(animation)\n      // Note: unregister not strictly needed as registry uses weak refs\n    }\n    if (this.animations.size === 0) {\n      this.stop()\n    }\n  }\n\n  /**\n   * Register a callback for when animations are garbage collected\n   * Useful for debugging memory leaks\n   */\n  onCleanup(callback: CleanupCallback): () => void {\n    this.cleanupCallbacks.add(callback)\n    return () => this.cleanupCallbacks.delete(callback)\n  }\n\n  /**\n   * Register a callback for each frame\n   * Receives delta time in milliseconds\n   */\n  onFrame(callback: (deltaTime: number) => void): () => void {\n    this.frameListeners.add(callback)\n    return () => this.frameListeners.delete(callback)\n  }\n\n  /**\n   * Start the animation loop\n   */\n  private start(): void {\n    if (this.isRunning) return\n    this.isRunning = true\n    this.lastTime = performance.now()\n    this.tick()\n  }\n\n  /**\n   * Stop the animation loop\n   */\n  private stop(): void {\n    this.isRunning = false\n    if (this.rafId !== null) {\n      cancelAnimationFrame(this.rafId)\n      this.rafId = null\n    }\n  }\n\n  /**\n   * Single animation frame - optimized single-pass update + cleanup\n   * Features:\n   * - WeakRef dereferencing with automatic cleanup of dead refs\n   * - Delta time clamping for frame-drop resilience\n   * - O(n) single-pass performance\n   * - Frame listener notifications\n   */\n  private tick = (): void => {\n    const now = performance.now()\n\n    // Calculate and clamp delta time to prevent physics explosions\n    // This handles tab suspension, debugger pauses, etc.\n    const rawDelta = now - this.lastTime\n    const clampedDelta = Math.min(rawDelta, MAX_DELTA_TIME)\n    this.lastTime = now\n\n    // Notify frame listeners\n    for (const listener of this.frameListeners) {\n      listener(clampedDelta)\n    }\n\n    // Single pass: update all animations and collect refs to remove\n    const toRemove: WeakRef<Animatable>[] = []\n\n    for (const ref of this.animations) {\n      const animation = ref.deref()\n\n      // If WeakRef is dead (animation was garbage collected), mark for removal\n      if (!animation) {\n        toRemove.push(ref)\n        continue\n      }\n\n      animation.update(now)\n\n      if (animation.isComplete()) {\n        toRemove.push(ref)\n        this.animationMap.delete(animation)\n        this.idMap.delete(animation)\n      }\n    }\n\n    // Remove dead/completed refs\n    for (let i = 0; i < toRemove.length; i++) {\n      this.animations.delete(toRemove[i]!)\n    }\n\n    // Continue or stop loop\n    if (this.animations.size > 0) {\n      this.rafId = requestAnimationFrame(this.tick)\n    } else {\n      this.stop()\n    }\n  }\n\n  /**\n   * Get the number of active animations (including potentially dead refs)\n   */\n  get size(): number {\n    return this.animations.size\n  }\n\n  /**\n   * Get count of actually alive animations (for debugging/testing)\n   */\n  getAliveCount(): number {\n    let count = 0\n    for (const ref of this.animations) {\n      if (ref.deref()) count++\n    }\n    return count\n  }\n\n  /**\n   * Get current frame rate (based on last delta)\n   */\n  getFPS(): number {\n    const delta = performance.now() - this.lastTime\n    return delta > 0 ? Math.round(1000 / delta) : 60\n  }\n}\n\n/**\n * Global animation loop instance\n */\nexport const globalLoop = new AnimationLoop()\n","/**\n * Clamp a value between a minimum and maximum\n * @param value - The value to clamp\n * @param min - The minimum allowed value\n * @param max - The maximum allowed value\n * @returns The clamped value\n */\nexport function clamp(value: number, min: number, max: number): number {\n  // Handle inverted min/max (swap them)\n  const actualMin = Math.min(min, max)\n  const actualMax = Math.max(min, max)\n  return Math.max(actualMin, Math.min(actualMax, value))\n}\n\n/**\n * Linear interpolation between two values\n * @param a - The start value\n * @param b - The end value\n * @param t - The interpolation factor (0-1)\n * @returns The interpolated value\n */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t\n}\n\n/**\n * Map a value from one range to another\n * @param value - The value to map\n * @param inMin - The minimum of the input range\n * @param inMax - The maximum of the input range\n * @param outMin - The minimum of the output range\n * @param outMax - The maximum of the output range\n * @returns The mapped value\n */\nexport function mapRange(\n  value: number,\n  inMin: number,\n  inMax: number,\n  outMin: number,\n  outMax: number\n): number {\n  return ((value - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin\n}\n\n/**\n * Convert degrees to radians\n * @param degrees - The angle in degrees\n * @returns The angle in radians\n */\nexport function degToRad(degrees: number): number {\n  return (degrees * Math.PI) / 180\n}\n\n/**\n * Convert radians to degrees\n * @param radians - The angle in radians\n * @returns The angle in degrees\n */\nexport function radToDeg(radians: number): number {\n  return (radians * 180) / Math.PI\n}\n","/**\n * Development mode warnings for SpringKit\n * These warnings help developers avoid common configuration mistakes\n */\n\nconst isDev = typeof process !== 'undefined' && process.env?.NODE_ENV !== 'production'\nconst warnedMessages = new Set<string>()\n\n/**\n * Log a warning message once (won't repeat the same message)\n */\nfunction warnOnce(message: string): void {\n  if (!isDev || warnedMessages.has(message)) return\n  warnedMessages.add(message)\n  console.warn(`[SpringKit] ${message}`)\n}\n\n/**\n * Validate spring configuration and warn about potential issues\n */\nexport function validateSpringConfig(config: {\n  stiffness?: number\n  damping?: number\n  mass?: number\n}): void {\n  if (!isDev) return\n\n  const { stiffness = 100, damping = 10, mass = 1 } = config\n\n  // Check for extreme stiffness with low damping (unstable oscillation)\n  if (stiffness > 400 && damping < 10) {\n    warnOnce(\n      `High stiffness (${stiffness}) with low damping (${damping}) may cause excessive oscillation. ` +\n      `Consider increasing damping to at least ${Math.round(stiffness / 20)} for smoother animation.`\n    )\n  }\n\n  // Check for very low stiffness (sluggish animation)\n  if (stiffness < 20) {\n    warnOnce(\n      `Very low stiffness (${stiffness}) will result in sluggish animation. ` +\n      `Consider using stiffness >= 50 for more responsive feel.`\n    )\n  }\n\n  // Check for very high damping (overdamped, no spring feel)\n  if (damping > stiffness) {\n    warnOnce(\n      `Damping (${damping}) is higher than stiffness (${stiffness}), ` +\n      `which removes the \"springy\" feel. Consider reducing damping for bouncier animation.`\n    )\n  }\n\n  // Check for zero or negative mass\n  if (mass <= 0) {\n    warnOnce(\n      `Mass must be positive. Got ${mass}. Using default mass of 1.`\n    )\n  }\n\n  // Check for very high mass (slow animation)\n  if (mass > 10) {\n    warnOnce(\n      `High mass (${mass}) will make the animation very slow. ` +\n      `Consider mass between 0.5 and 5 for typical use cases.`\n    )\n  }\n}\n\n/**\n * Validate drag configuration\n */\nexport function validateDragConfig(config: {\n  rubberBandFactor?: number\n  bounds?: {\n    left?: number\n    right?: number\n    top?: number\n    bottom?: number\n  }\n}): void {\n  if (!isDev) return\n\n  const { rubberBandFactor, bounds } = config\n\n  // Check rubber band factor range\n  if (rubberBandFactor !== undefined && (rubberBandFactor < 0 || rubberBandFactor > 1)) {\n    warnOnce(\n      `rubberBandFactor should be between 0 and 1. Got ${rubberBandFactor}. ` +\n      `Values outside this range may cause unexpected behavior.`\n    )\n  }\n\n  // Check for inverted bounds\n  if (bounds) {\n    if (bounds.left !== undefined && bounds.right !== undefined && bounds.left > bounds.right) {\n      warnOnce(\n        `Drag bounds are inverted: left (${bounds.left}) > right (${bounds.right}). ` +\n        `This may cause unexpected behavior.`\n      )\n    }\n    if (bounds.top !== undefined && bounds.bottom !== undefined && bounds.top > bounds.bottom) {\n      warnOnce(\n        `Drag bounds are inverted: top (${bounds.top}) > bottom (${bounds.bottom}). ` +\n        `This may cause unexpected behavior.`\n      )\n    }\n  }\n}\n\n/**\n * Validate decay configuration\n */\nexport function validateDecayConfig(config: {\n  velocity: number\n  deceleration?: number\n}): void {\n  if (!isDev) return\n\n  const { velocity, deceleration = 0.998 } = config\n\n  // Check for zero velocity\n  if (velocity === 0) {\n    warnOnce(\n      `Decay animation started with zero velocity. ` +\n      `The animation will complete immediately.`\n    )\n  }\n\n  // Check deceleration range\n  if (deceleration <= 0 || deceleration >= 1) {\n    warnOnce(\n      `Deceleration should be between 0 and 1 (exclusive). Got ${deceleration}. ` +\n      `Typical values are 0.99-0.999.`\n    )\n  }\n}\n\n/**\n * Clear warned messages (useful for testing)\n */\nexport function clearWarnings(): void {\n  warnedMessages.clear()\n}\n","import type { SpringConfig } from './config.js'\nimport { defaultConfig } from './config.js'\nimport { simulateSpring } from './physics.js'\nimport { globalLoop, type Animatable, AnimationState } from '../animation/loop.js'\nimport { clamp } from '../utils/math.js'\nimport { validateSpringConfig } from '../utils/warnings.js'\n\n/**\n * Spring animation control interface\n */\nexport interface SpringAnimation {\n  /** Start the animation */\n  start(): SpringAnimation\n  /** Stop the animation immediately */\n  stop(): void\n  /** Pause the animation */\n  pause(): void\n  /** Resume the animation */\n  resume(): void\n  /** Reverse the animation direction */\n  reverse(): void\n  /** Update the target value */\n  set(to: number): void\n  /** Update target while preserving current velocity (for smooth interruptions) */\n  setWithVelocity(to: number, velocity?: number): void\n  /** Check if currently animating */\n  isAnimating(): boolean\n  /** Check if paused */\n  isPaused(): boolean\n  /** Check if complete */\n  isComplete(): boolean\n  /** Get current value */\n  getValue(): number\n  /** Get current velocity */\n  getVelocity(): number\n  /** Promise that resolves when complete */\n  finished: Promise<void>\n  /** Clean up resources */\n  destroy(): void\n}\n\n/**\n * Spring animation implementation\n */\nclass SpringAnimationImpl implements SpringAnimation, Animatable {\n  private position: number\n  private velocity: number\n  private target: number\n  private config: SpringConfig & Required<Pick<SpringConfig, 'stiffness' | 'damping' | 'mass' | 'restSpeed' | 'restDelta'>>\n  private state: AnimationState = AnimationState.Idle\n  private resolveComplete: (() => void) | null = null\n  private from: number\n  private to: number\n  private clampedFrom: number\n  private clampedTo: number\n\n  finished: Promise<void>\n\n  constructor(\n    from: number,\n    to: number,\n    config: SpringConfig = {}\n  ) {\n    // Validate config in development mode\n    validateSpringConfig(config)\n\n    this.from = from\n    this.to = to\n    this.clampedFrom = from\n    this.clampedTo = to\n    this.position = from\n    this.velocity = config.velocity ?? 0\n    this.target = to\n    this.config = {\n      ...defaultConfig,\n      ...config,\n      stiffness: config.stiffness ?? defaultConfig.stiffness!,\n      damping: config.damping ?? defaultConfig.damping!,\n      mass: config.mass ?? defaultConfig.mass!,\n      restSpeed: config.restSpeed ?? defaultConfig.restSpeed!,\n      restDelta: config.restDelta ?? defaultConfig.restDelta!,\n    }\n\n    this.finished = new Promise((resolve) => {\n      this.resolveComplete = resolve\n    })\n  }\n\n  start(): SpringAnimation {\n    if (this.state === AnimationState.Running) return this\n\n    this.state = AnimationState.Running\n    this.config.onStart?.()\n    globalLoop.add(this)\n    return this\n  }\n\n  stop(): void {\n    this.state = AnimationState.Idle\n    globalLoop.remove(this)\n  }\n\n  pause(): void {\n    if (this.state === AnimationState.Running) {\n      this.state = AnimationState.Paused\n      globalLoop.remove(this)\n    }\n  }\n\n  resume(): void {\n    if (this.state === AnimationState.Paused) {\n      this.state = AnimationState.Running\n      globalLoop.add(this)\n    }\n  }\n\n  reverse(): void {\n    const temp = this.from\n    this.from = this.to\n    this.to = temp\n    this.clampedFrom = this.from\n    this.clampedTo = this.to\n    this.target = this.to\n  }\n\n  set(to: number): void {\n    this.to = to\n    this.clampedTo = to\n    this.target = to\n  }\n\n  setWithVelocity(to: number, velocity?: number): void {\n    // Update from to current position for smooth continuation\n    this.from = this.position\n    this.clampedFrom = this.position\n    this.to = to\n    this.clampedTo = to\n    this.target = to\n\n    // Use provided velocity or preserve current velocity\n    if (velocity !== undefined) {\n      this.velocity = velocity\n    }\n    // If not running, start the animation\n    if (this.state !== AnimationState.Running) {\n      this.start()\n    }\n  }\n\n  update(_now: number): void {\n    if (this.state !== AnimationState.Running) return\n\n    const result = simulateSpring(\n      this.position,\n      this.velocity,\n      this.target,\n      this.config\n    )\n\n    this.position = result.position\n    this.velocity = result.velocity\n\n    // Handle clamping\n    if (this.config.clamp) {\n      const min = Math.min(this.clampedFrom, this.clampedTo)\n      const max = Math.max(this.clampedFrom, this.clampedTo)\n      this.position = clamp(this.position, min, max)\n    }\n\n    // Emit update\n    this.config.onUpdate?.(this.position)\n\n    // Check rest state\n    if (result.isRest) {\n      this.state = AnimationState.Complete\n      globalLoop.remove(this)\n      this.position = this.target // Ensure we end exactly at target\n      this.config.onUpdate?.(this.position)\n      this.config.onComplete?.()\n      this.config.onRest?.()\n      this.resolveComplete?.()\n    }\n  }\n\n  isAnimating(): boolean {\n    return this.state === AnimationState.Running\n  }\n\n  isPaused(): boolean {\n    return this.state === AnimationState.Paused\n  }\n\n  isComplete(): boolean {\n    return this.state === AnimationState.Complete\n  }\n\n  getValue(): number {\n    return this.position\n  }\n\n  getVelocity(): number {\n    return this.velocity\n  }\n\n  destroy(): void {\n    this.stop()\n    this.config.onUpdate = undefined\n    this.config.onStart = undefined\n    this.config.onComplete = undefined\n    this.config.onRest = undefined\n  }\n}\n\n/**\n * Create a spring animation\n *\n * @param from - Starting value\n * @param to - Target value\n * @param config - Spring configuration\n * @returns Spring animation controller\n *\n * @example\n * ```ts\n * const anim = spring(0, 100, {\n *   onUpdate: (value) => {\n *     element.style.transform = `translateX(${value}px)`\n *   },\n * })\n *\n * anim.start()\n * ```\n */\nexport function spring(\n  from: number,\n  to: number,\n  config?: SpringConfig\n): SpringAnimation {\n  return new SpringAnimationImpl(from, to, config)\n}\n","import type { SpringConfig } from './config.js'\nimport { defaultConfig } from './config.js'\nimport { spring, type SpringAnimation } from './spring.js'\n\n/**\n * Spring value interface\n */\nexport interface SpringValue {\n  /** Get current value */\n  get(): number\n  /** Get current velocity */\n  getVelocity(): number\n  /** Animate to a new value */\n  set(to: number, config?: Partial<SpringConfig>): void\n  /** Set value immediately without animation */\n  jump(to: number): void\n  /** Stop current animation at current position */\n  stop(): void\n  /** Update spring configuration */\n  setConfig(config: Partial<SpringConfig>): void\n  /** Subscribe to value changes */\n  subscribe(callback: (value: number) => void): () => void\n  /** Check if currently animating */\n  isAnimating(): boolean\n  /** Promise that resolves when current animation completes */\n  finished: Promise<void>\n  /** Clean up resources */\n  destroy(): void\n}\n\n/**\n * Spring value implementation\n */\nclass SpringValueImpl implements SpringValue {\n  private value: number\n  private config: SpringConfig\n  private currentAnimation: SpringAnimation | null = null\n  private subscribers = new Set<(value: number) => void>()\n  private resolveComplete: (() => void) | null = null\n  private finishedPromise: Promise<void>\n\n  constructor(initial: number, config: SpringConfig = {}) {\n    this.value = initial\n    this.config = { ...defaultConfig, ...config }\n\n    this.finishedPromise = new Promise((resolve) => {\n      this.resolveComplete = resolve\n    })\n  }\n\n  get(): number {\n    return this.value\n  }\n\n  getVelocity(): number {\n    return this.currentAnimation?.getVelocity() ?? 0\n  }\n\n  set(to: number, config: Partial<SpringConfig> = {}): void {\n    // Cancel existing animation\n    if (this.currentAnimation) {\n      this.currentAnimation.destroy()\n      this.currentAnimation = null\n    }\n\n    // Create new promise for this animation\n    this.finishedPromise = new Promise((resolve) => {\n      this.resolveComplete = resolve\n    })\n\n    // Create new animation\n    const mergedConfig = { ...this.config, ...config }\n    const originalOnUpdate = mergedConfig.onUpdate\n    const originalOnComplete = mergedConfig.onComplete\n\n    this.currentAnimation = spring(this.value, to, {\n      ...mergedConfig,\n      onUpdate: (value) => {\n        this.value = value\n        this.notify()\n        // Also call original onUpdate if provided\n        originalOnUpdate?.(value)\n      },\n      onComplete: () => {\n        originalOnComplete?.()\n        if (this.resolveComplete) {\n          this.resolveComplete()\n        }\n      },\n    })\n\n    this.currentAnimation.start()\n  }\n\n  jump(to: number): void {\n    if (this.currentAnimation) {\n      this.currentAnimation.destroy()\n      this.currentAnimation = null\n    }\n    this.value = to\n    this.notify()\n  }\n\n  stop(): void {\n    if (this.currentAnimation) {\n      this.currentAnimation.destroy()\n      this.currentAnimation = null\n    }\n    if (this.resolveComplete) {\n      this.resolveComplete()\n    }\n  }\n\n  setConfig(config: Partial<SpringConfig>): void {\n    this.config = { ...this.config, ...config }\n  }\n\n  subscribe(callback: (value: number) => void): () => void {\n    this.subscribers.add(callback)\n\n    // Immediately call with current value\n    callback(this.value)\n\n    return () => {\n      this.subscribers.delete(callback)\n    }\n  }\n\n  isAnimating(): boolean {\n    return this.currentAnimation?.isAnimating() ?? false\n  }\n\n  get finished(): Promise<void> {\n    return this.finishedPromise\n  }\n\n  private notify(): void {\n    for (const subscriber of this.subscribers) {\n      subscriber(this.value)\n    }\n  }\n\n  destroy(): void {\n    this.currentAnimation?.destroy()\n    this.currentAnimation = null\n    this.subscribers.clear()\n  }\n}\n\n/**\n * Create a spring value\n *\n * @param initial - Initial value\n * @param config - Spring configuration\n * @returns Spring value controller\n *\n * @example\n * ```ts\n * const x = createSpringValue(0, { stiffness: 100, damping: 10 })\n *\n * x.subscribe((value) => {\n *   element.style.transform = `translateX(${value}px)`\n * })\n *\n * x.set(100) // Animates to 100\n * x.jump(0)  // Jumps to 0 immediately\n * ```\n */\nexport function createSpringValue(\n  initial: number,\n  config?: SpringConfig\n): SpringValue {\n  return new SpringValueImpl(initial, config)\n}\n\n// Re-export for type usage\nexport { SpringValueImpl as SpringValueClass }\n","import type { SpringConfig } from './config.js'\nimport { defaultConfig } from './config.js'\nimport { createSpringValue, type SpringValue } from './spring-value.js'\n\n/**\n * Spring group interface\n */\nexport interface SpringGroup<T extends Record<string, number>> {\n  /** Get all current values */\n  get(): T\n  /** Get a single value by key */\n  getValue(key: keyof T): number\n  /** Animate to new values (partial update) */\n  set(values: Partial<T>, config?: Partial<SpringConfig>): void\n  /** Set values immediately without animation */\n  jump(values: Partial<T>): void\n  /** Subscribe to value changes */\n  subscribe(callback: (values: T) => void): () => void\n  /** Check if any spring is animating */\n  isAnimating(): boolean\n  /** Promise that resolves when all animations complete */\n  finished: Promise<void>\n  /** Clean up resources */\n  destroy(): void\n}\n\n/**\n * Spring group implementation\n */\nclass SpringGroupImpl<T extends Record<string, number>> implements SpringGroup<T> {\n  private values: Map<keyof T, SpringValue>\n  private config: SpringConfig\n  private subscribers = new Set<(values: T) => void>()\n  private resolveComplete: (() => void) | null = null\n  private finishedPromise: Promise<void>\n\n  constructor(initialValues: T, config: SpringConfig = {}) {\n    this.config = { ...defaultConfig, ...config }\n\n    // Create SpringValue for each key\n    this.values = new Map()\n    for (const [key, value] of Object.entries(initialValues)) {\n      const springValue = createSpringValue(value, this.config)\n      springValue.subscribe(() => this.notify())\n      this.values.set(key as keyof T, springValue)\n    }\n\n    this.finishedPromise = Promise.resolve()\n\n    // Initialize promise handler\n    this.resetPromise()\n  }\n\n  private resetPromise(): void {\n    this.finishedPromise = new Promise((resolve) => {\n      this.resolveComplete = resolve\n    })\n  }\n\n  get(): T {\n    const result = {} as T\n    for (const [key, springValue] of this.values) {\n      (result as Record<string, number>)[key as string] = springValue.get()\n    }\n    return result\n  }\n\n  getValue(key: keyof T): number {\n    return this.values.get(key)?.get() ?? 0\n  }\n\n  set(values: Partial<T>, config: Partial<SpringConfig> = {}): void {\n    // Reset promise for new batch of animations\n    this.resetPromise()\n\n    const promises: Promise<void>[] = []\n\n    for (const [key, value] of Object.entries(values)) {\n      const springValue = this.values.get(key as keyof T)\n      if (springValue) {\n        springValue.set(value, config)\n        promises.push(springValue.finished)\n      }\n    }\n\n    // Resolve when all animations complete\n    Promise.all(promises).then(() => {\n      if (this.resolveComplete) {\n        this.resolveComplete()\n      }\n    })\n  }\n\n  jump(values: Partial<T>): void {\n    for (const [key, value] of Object.entries(values)) {\n      const springValue = this.values.get(key as keyof T)\n      if (springValue) {\n        springValue.jump(value)\n      }\n    }\n    // Note: notify() is already called by the spring subscriptions, so we don't call it again\n  }\n\n  subscribe(callback: (values: T) => void): () => void {\n    this.subscribers.add(callback)\n    callback(this.get())\n    return () => this.subscribers.delete(callback)\n  }\n\n  isAnimating(): boolean {\n    for (const springValue of this.values.values()) {\n      if (springValue.isAnimating()) return true\n    }\n    return false\n  }\n\n  get finished(): Promise<void> {\n    return this.finishedPromise\n  }\n\n  private notify(): void {\n    const values = this.get()\n    for (const subscriber of this.subscribers) {\n      subscriber(values)\n    }\n  }\n\n  destroy(): void {\n    for (const springValue of this.values.values()) {\n      springValue.destroy()\n    }\n    this.subscribers.clear()\n  }\n}\n\n/**\n * Create a spring group for animating multiple values together\n *\n * @param initialValues - Initial values object\n * @param config - Spring configuration\n * @returns Spring group controller\n *\n * @example\n * ```ts\n * const group = createSpringGroup(\n *   { x: 0, y: 0, scale: 1 },\n *   { stiffness: 100, damping: 10 }\n * )\n *\n * group.subscribe((values) => {\n *   element.style.transform = `\n *     translate(${values.x}px, ${values.y}px)\n *     scale(${values.scale})\n *   `\n * })\n *\n * group.set({ x: 100, scale: 1.5 })\n * ```\n */\nexport function createSpringGroup<T extends Record<string, number>>(\n  initialValues: T,\n  config?: SpringConfig\n): SpringGroup<T> {\n  return new SpringGroupImpl(initialValues, config)\n}\n\n// Re-export for type usage\nexport { SpringGroupImpl as SpringGroupClass }\n","import type { SpringAnimation } from '../core/spring.js'\n\n/**\n * Stagger options interface\n */\nexport interface StaggerOptions {\n  /** Delay between animations (ms) or function returning delay */\n  delay?: number | ((index: number) => number)\n  /** Where to start staggering from */\n  from?: 'first' | 'last' | 'center' | number\n}\n\n/**\n * Run animations one after another (sequentially)\n *\n * @param animations - Array of functions that create animations\n * @returns Promise that resolves when all animations complete\n *\n * @example\n * ```ts\n * await sequence([\n *   () => spring(0, 100, { onUpdate: updateOpacity }).start(),\n *   () => spring(0, 200, { onUpdate: updateX }).start(),\n *   () => spring(0, 50, { onUpdate: updateY }).start(),\n * ])\n *\n * console.log('All animations complete!')\n * ```\n */\nexport async function sequence(\n  animations: Array<() => SpringAnimation>\n): Promise<void> {\n  for (const createAnimation of animations) {\n    const anim = createAnimation()\n    await anim.finished\n  }\n}\n\n/**\n * Run animations simultaneously (in parallel)\n *\n * @param animations - Array of functions that create animations\n * @returns Promise that resolves when all animations complete\n *\n * @example\n * ```ts\n * await parallel([\n *   () => spring(0, 100, { onUpdate: updateOpacity }).start(),\n *   () => spring(0, 200, { onUpdate: updateX }).start(),\n *   () => spring(1, 2, { onUpdate: updateScale }).start(),\n * ])\n *\n * console.log('All animations complete!')\n * ```\n */\nexport async function parallel(\n  animations: Array<() => SpringAnimation>\n): Promise<void> {\n  const promises = animations.map((createAnimation) => {\n    const anim = createAnimation()\n    return anim.finished\n  })\n  await Promise.all(promises)\n}\n\n/**\n * Run animations with staggered delays\n *\n * @param items - Array of items to animate\n * @param animate - Function that creates an animation for each item\n * @param options - Stagger options\n * @returns Promise that resolves when all animations complete\n *\n * @example\n * ```ts\n * const elements = document.querySelectorAll('.item')\n *\n * await stagger(\n *   elements,\n *   (element, index) => {\n *     return spring(0, 1, {\n *       onUpdate: (value) => {\n *         element.style.opacity = String(value)\n *       },\n *     }).start()\n *   },\n *   { delay: 50 }\n * )\n * ```\n */\nexport async function stagger<T>(\n  items: T[],\n  animate: (item: T, index: number) => SpringAnimation,\n  options: StaggerOptions = {}\n): Promise<void> {\n  const { delay = 0, from = 'first' } = options\n\n  // Calculate start index based on 'from' option\n  let startIndex = 0\n  if (from === 'last') startIndex = items.length - 1\n  else if (from === 'center') startIndex = Math.floor(items.length / 2)\n  else if (typeof from === 'number') startIndex = from\n\n  // Build index order from start point outward\n  const indices: number[] = []\n  const used = new Set<number>()\n\n  indices.push(startIndex)\n  used.add(startIndex)\n\n  for (let offset = 1; offset < items.length; offset++) {\n    const left = startIndex - offset\n    const right = startIndex + offset\n\n    // Add right first if it exists\n    if (right < items.length && !used.has(right)) {\n      indices.push(right)\n      used.add(right)\n    }\n\n    // Then add left if it exists\n    if (left >= 0 && !used.has(left)) {\n      indices.push(left)\n      used.add(left)\n    }\n  }\n\n  // All indices are already added by the main loop above\n  // No need for defensive fallback as the logic is complete\n\n  // Start animations with delay\n  const getDelay = typeof delay === 'function' ? delay : (_i: number) => delay\n  const animations: SpringAnimation[] = []\n\n  for (let i = 0; i < indices.length; i++) {\n    const index = indices[i]!\n    const anim = animate(items[index]!, index)\n    animations.push(anim)\n\n    const delayMs = getDelay(i)\n\n    if (delayMs > 0) {\n      setTimeout(() => {\n        anim.start()\n      }, delayMs)\n    } else {\n      anim.start()\n    }\n  }\n\n  await Promise.all(animations.map((a) => a.finished))\n}\n","import type { SpringConfig } from '../core/config.js'\nimport { defaultConfig } from '../core/config.js'\nimport { createSpringValue, type SpringValue } from '../core/spring-value.js'\n\n/**\n * Trail configuration interface\n */\nexport interface TrailConfig extends SpringConfig {\n  /** Frames delay between items following each other */\n  followDelay?: number\n}\n\n/**\n * Trail interface\n */\nexport interface Trail {\n  /** Set the leader value (followers will follow with delay) */\n  set(value: number): void\n  /** Set all values immediately without animation */\n  jump(value: number): void\n  /** Get all current values */\n  getValues(): number[]\n  /** Subscribe to value changes */\n  subscribe(callback: (values: number[]) => void): () => void\n  /** Clean up resources */\n  destroy(): void\n}\n\n/**\n * Trail implementation\n * Creates a chain of springs where each spring follows the previous one\n */\nclass TrailImpl implements Trail {\n  private springs: SpringValue[]\n  private leader: SpringValue\n  private followDelay: number\n  private subscribers = new Set<(values: number[]) => void>()\n  private frameCount: number = 0\n  private pendingUpdates: Map<number, number> = new Map()\n\n  constructor(count: number, config: TrailConfig = {}) {\n    const { followDelay = 2, ...springConfig } = config\n\n    this.followDelay = followDelay\n\n    // Create leader spring\n    this.leader = createSpringValue(0, springConfig)\n\n    // Create follower springs\n    this.springs = []\n    for (let i = 0; i < count; i++) {\n      const spring = createSpringValue(0, springConfig)\n      this.springs.push(spring)\n    }\n\n    // Connect leader to followers with delay\n    this.leader.subscribe(() => {\n      this.frameCount++\n      this.scheduleFollowerUpdates()\n    })\n  }\n\n  private scheduleFollowerUpdates(): void {\n    const targetValue = this.leader.get()\n\n    for (let i = 0; i < this.springs.length; i++) {\n      const delayFrames = (i + 1) * this.followDelay\n      const targetFrame = this.frameCount + delayFrames\n\n      // Store the pending update\n      this.pendingUpdates.set(i, targetFrame)\n\n      // Schedule the update\n      this.scheduleFollowerUpdate(i, targetValue, targetFrame, delayFrames)\n    }\n  }\n\n  private scheduleFollowerUpdate(\n    index: number,\n    targetValue: number,\n    targetFrame: number,\n    delayFrames: number\n  ): void {\n    const startFrame = this.frameCount\n    const framesToWait = targetFrame - startFrame\n\n    if (framesToWait <= 0) {\n      // Update immediately if delay has passed\n      this.springs[index]!.set(targetValue)\n    } else {\n      // Use setTimeout for delay (approximately 16ms per frame at 60fps)\n      const delayMs = Math.max(framesToWait * 16, 0)\n\n      setTimeout(() => {\n        // Only update if this is still the current pending update\n        const currentTarget = this.pendingUpdates.get(index)\n        if (currentTarget === targetFrame) {\n          this.springs[index]!.set(targetValue)\n        }\n      }, delayMs)\n    }\n  }\n\n  set(value: number): void {\n    this.leader.set(value)\n  }\n\n  jump(value: number): void {\n    this.leader.jump(value)\n    for (const spring of this.springs) {\n      spring.jump(value)\n    }\n  }\n\n  getValues(): number[] {\n    return this.springs.map((s) => s.get())\n  }\n\n  subscribe(callback: (values: number[]) => void): () => void {\n    this.subscribers.add(callback)\n\n    // Subscribe to each follower spring\n    const unsubscribers: (() => void)[] = []\n    for (const spring of this.springs) {\n      unsubscribers.push(\n        spring.subscribe(() => {\n          this.notify()\n        })\n      )\n    }\n\n    // Immediately call with current values\n    callback(this.getValues())\n\n    // Return unsubscribe function\n    return () => {\n      this.subscribers.delete(callback)\n      for (const unsubscribe of unsubscribers) {\n        unsubscribe()\n      }\n    }\n  }\n\n  private notify(): void {\n    const values = this.getValues()\n    for (const subscriber of this.subscribers) {\n      subscriber(values)\n    }\n  }\n\n  destroy(): void {\n    this.leader.destroy()\n    for (const spring of this.springs) {\n      spring.destroy()\n    }\n    this.subscribers.clear()\n    this.pendingUpdates.clear()\n  }\n}\n\n/**\n * Create a trail animation\n *\n * @param count - Number of items in the trail\n * @param config - Trail configuration\n * @returns Trail controller\n *\n * @example\n * ```ts\n * const trail = createTrail(5, {\n *   stiffness: 200,\n *   damping: 25,\n *   followDelay: 3,\n * })\n *\n * trail.subscribe((values) => {\n *   elements.forEach((el, i) => {\n *     el.style.transform = `translateX(${values[i]}px)`\n *   })\n * })\n *\n * trail.set(100) // First item moves immediately, others follow\n * ```\n */\nexport function createTrail(count: number, config?: TrailConfig): Trail {\n  return new TrailImpl(count, config)\n}\n","import { globalLoop, type Animatable, AnimationState } from './loop.js'\nimport { clamp } from '../utils/math.js'\nimport { validateDecayConfig } from '../utils/warnings.js'\n\n/**\n * Decay animation configuration interface\n */\nexport interface DecayConfig {\n  /** Initial velocity */\n  velocity: number\n  /** Deceleration factor (0-1, higher = slower decay) */\n  deceleration?: number\n  /** Optional clamp range [min, max] */\n  clamp?: [number, number]\n  /** Callback called on each update */\n  onUpdate?: (value: number) => void\n  /** Callback called when complete */\n  onComplete?: () => void\n}\n\n/**\n * Decay animation interface\n */\nexport interface DecayAnimation {\n  /** Start the decay animation */\n  start(): DecayAnimation\n  /** Stop the decay animation */\n  stop(): void\n  /** Promise that resolves when complete */\n  finished: Promise<void>\n}\n\n/**\n * Decay animation implementation\n * Simulates natural momentum/deceleration\n */\nclass DecayAnimationImpl implements DecayAnimation, Animatable {\n  private value: number\n  private velocity: number\n  private deceleration: number\n  private clampRange: [number, number] | undefined\n  private state: AnimationState = AnimationState.Idle\n  private rafId: number | null = null\n  private resolveComplete: (() => void) | null = null\n  private config: DecayConfig\n\n  finished: Promise<void>\n\n  constructor(config: DecayConfig) {\n    // Validate config in development mode\n    validateDecayConfig(config)\n\n    this.value = 0\n    this.velocity = config.velocity\n    this.deceleration = config.deceleration ?? 0.998\n    this.clampRange = config.clamp\n    this.state = AnimationState.Idle\n    this.config = config\n\n    this.finished = new Promise((resolve) => {\n      this.resolveComplete = resolve\n    })\n  }\n\n  start(): DecayAnimation {\n    if (this.state === AnimationState.Running) return this\n    this.state = AnimationState.Running\n    globalLoop.add(this)\n    return this\n  }\n\n  stop(): void {\n    this.state = AnimationState.Idle\n    globalLoop.remove(this)\n  }\n\n  update(_now: number): void {\n    if (this.state !== AnimationState.Running) return\n\n    // Apply deceleration\n    this.velocity *= this.deceleration\n    this.value += this.velocity\n\n    // Apply clamp\n    if (this.clampRange) {\n      const [min, max] = this.clampRange\n      this.value = clamp(this.value, min, max)\n\n      // Stop if we hit a boundary with velocity in that direction\n      if ((this.value <= min && this.velocity < 0) || (this.value >= max && this.velocity > 0)) {\n        this.velocity = 0\n      }\n    }\n\n    this.config.onUpdate?.(this.value)\n\n    // Check if stopped\n    if (Math.abs(this.velocity) < 0.01) {\n      this.state = AnimationState.Complete\n      globalLoop.remove(this)\n      this.config.onComplete?.()\n      this.resolveComplete?.()\n    }\n  }\n\n  isComplete(): boolean {\n    return this.state === AnimationState.Complete\n  }\n\n  destroy(): void {\n    this.stop()\n    this.config.onUpdate = undefined\n    this.config.onComplete = undefined\n  }\n}\n\n/**\n * Create a decay animation\n *\n * @param config - Decay configuration\n * @returns Decay animation controller\n *\n * @example\n * ```ts\n * const anim = decay({\n *   velocity: 1000,\n *   onUpdate: (value) => {\n *     element.style.transform = `translateX(${value}px)`\n *   },\n * })\n *\n * anim.start()\n * ```\n */\nexport function decay(config: DecayConfig): DecayAnimation {\n  return new DecayAnimationImpl(config)\n}\n","import { createSpringValue } from '../core/spring-value.js'\nimport type { SpringConfig } from '../types.js'\n\n/**\n * Keyframe definition with optional per-keyframe config\n */\nexport interface Keyframe<T = number> {\n  /** Target value at this keyframe */\n  value: T\n  /** Time position (0-1) for this keyframe. If not provided, evenly distributed */\n  at?: number\n  /** Spring config override for transition TO this keyframe */\n  config?: SpringConfig\n}\n\n/**\n * Options for keyframe animation\n */\nexport interface KeyframesOptions {\n  /** Default spring configuration */\n  config?: SpringConfig\n  /** Time positions for keyframes (0-1). Length must match values array */\n  times?: number[]\n  /** Callback for each keyframe transition start */\n  onKeyframe?: (index: number) => void\n  /** Callback when all keyframes complete */\n  onComplete?: () => void\n  /** Callback for value updates */\n  onUpdate?: (value: number) => void\n}\n\n/**\n * Keyframes animation controller\n */\nexport interface KeyframesAnimation {\n  /** Start the animation */\n  play: () => Promise<void>\n  /** Pause the animation */\n  pause: () => void\n  /** Resume a paused animation */\n  resume: () => void\n  /** Stop and reset to initial value */\n  stop: () => void\n  /** Get current value */\n  get: () => number\n  /** Get current keyframe index */\n  getCurrentKeyframe: () => number\n  /** Check if animation is playing */\n  isPlaying: () => boolean\n  /** Jump to specific keyframe */\n  jumpTo: (index: number) => void\n  /** Destroy and cleanup */\n  destroy: () => void\n}\n\n/**\n * Create a keyframe-based spring animation.\n * Animates through a sequence of values using spring physics.\n *\n * @example Basic keyframes\n * ```ts\n * const anim = keyframes([0, 100, 50, 100], {\n *   config: { stiffness: 200, damping: 20 },\n *   onUpdate: (value) => element.style.opacity = value / 100,\n * })\n * await anim.play()\n * ```\n *\n * @example With time positions\n * ```ts\n * const anim = keyframes([0, 100, 0], {\n *   times: [0, 0.3, 1], // 100 at 30%, back to 0 at 100%\n *   onUpdate: (value) => console.log(value),\n * })\n * ```\n *\n * @example With per-keyframe configs\n * ```ts\n * const anim = keyframes([\n *   { value: 0 },\n *   { value: 100, config: { stiffness: 500 } }, // Quick to 100\n *   { value: 50, config: { stiffness: 100 } },  // Slow to 50\n * ])\n * ```\n */\nexport function keyframes(\n  values: (number | Keyframe<number>)[],\n  options: KeyframesOptions = {}\n): KeyframesAnimation {\n  const {\n    config = {},\n    times,\n    onKeyframe,\n    onComplete,\n    onUpdate,\n  } = options\n\n  // Normalize keyframes\n  const normalizedKeyframes = values.map((v, i): Keyframe<number> => {\n    if (typeof v === 'number') {\n      return {\n        value: v,\n        at: times?.[i],\n      }\n    }\n    return { ...v, at: v.at ?? times?.[i] }\n  })\n\n  // Fill in missing time positions (evenly distributed)\n  const keyframeCount = normalizedKeyframes.length\n  normalizedKeyframes.forEach((kf, i) => {\n    if (kf.at === undefined) {\n      kf.at = keyframeCount > 1 ? i / (keyframeCount - 1) : 0\n    }\n  })\n\n  // Sort by time position\n  normalizedKeyframes.sort((a, b) => (a.at ?? 0) - (b.at ?? 0))\n\n  // State\n  let currentIndex = 0\n  let isPlaying = false\n  let isPaused = false\n  let spring: ReturnType<typeof createSpringValue> | null = null\n  let currentValue = normalizedKeyframes[0]?.value ?? 0\n  let destroyed = false\n\n  const createSpring = () => {\n    if (spring) {\n      spring.destroy()\n    }\n\n    const currentKf = normalizedKeyframes[currentIndex]\n    const springConfig = currentKf?.config ?? config\n\n    spring = createSpringValue(currentValue, springConfig)\n    spring.subscribe((value) => {\n      currentValue = value\n      onUpdate?.(value)\n    })\n  }\n\n  const animateToNext = async (): Promise<boolean> => {\n    if (destroyed || isPaused) return false\n    if (currentIndex >= normalizedKeyframes.length - 1) return false\n\n    currentIndex++\n    const targetKf = normalizedKeyframes[currentIndex]\n    if (!targetKf) return false\n\n    // Create new spring with keyframe-specific config if needed\n    if (targetKf.config) {\n      createSpring()\n    }\n\n    onKeyframe?.(currentIndex)\n\n    if (spring) {\n      spring.set(targetKf.value)\n\n      // Wait for spring to settle\n      await new Promise<void>((resolve) => {\n        const checkComplete = () => {\n          if (destroyed || isPaused) {\n            resolve()\n            return\n          }\n\n          if (spring && !spring.isAnimating()) {\n            resolve()\n          } else {\n            requestAnimationFrame(checkComplete)\n          }\n        }\n        // Give spring time to start\n        setTimeout(checkComplete, 16)\n      })\n    }\n\n    return true\n  }\n\n  const animation: KeyframesAnimation = {\n    play: async () => {\n      if (destroyed) return\n      if (isPlaying) return\n\n      isPlaying = true\n      isPaused = false\n\n      // Reset if at end\n      if (currentIndex >= normalizedKeyframes.length - 1) {\n        currentIndex = 0\n        currentValue = normalizedKeyframes[0]?.value ?? 0\n      }\n\n      createSpring()\n      onKeyframe?.(0)\n\n      // Animate through all keyframes\n      while (await animateToNext()) {\n        // Continue to next keyframe\n      }\n\n      if (!isPaused && !destroyed) {\n        isPlaying = false\n        onComplete?.()\n      }\n    },\n\n    pause: () => {\n      isPaused = true\n      isPlaying = false\n      if (spring) {\n        spring.stop()\n      }\n    },\n\n    resume: () => {\n      if (!isPaused || destroyed) return\n      isPaused = false\n      isPlaying = true\n\n      // Continue from current position\n      const continueAnimation = async () => {\n        while (await animateToNext()) {\n          // Continue to next keyframe\n        }\n\n        if (!isPaused && !destroyed) {\n          isPlaying = false\n          onComplete?.()\n        }\n      }\n\n      continueAnimation()\n    },\n\n    stop: () => {\n      isPaused = false\n      isPlaying = false\n      currentIndex = 0\n      currentValue = normalizedKeyframes[0]?.value ?? 0\n\n      if (spring) {\n        spring.jump(currentValue)\n      }\n    },\n\n    get: () => currentValue,\n\n    getCurrentKeyframe: () => currentIndex,\n\n    isPlaying: () => isPlaying,\n\n    jumpTo: (index: number) => {\n      if (index < 0 || index >= normalizedKeyframes.length) return\n\n      currentIndex = index\n      const targetValue = normalizedKeyframes[index]?.value ?? 0\n      currentValue = targetValue\n\n      if (spring) {\n        spring.jump(targetValue)\n      }\n\n      onUpdate?.(targetValue)\n      onKeyframe?.(index)\n    },\n\n    destroy: () => {\n      destroyed = true\n      isPlaying = false\n      isPaused = false\n\n      if (spring) {\n        spring.destroy()\n        spring = null\n      }\n    },\n  }\n\n  return animation\n}\n\n/**\n * Helper to create a keyframe sequence from an array shorthand\n *\n * @example\n * ```ts\n * // Equivalent to: keyframes([0, 100, 50])\n * const values = parseKeyframeArray([0, 100, 50])\n * ```\n */\nexport function parseKeyframeArray(\n  values: number[],\n  times?: number[]\n): Keyframe<number>[] {\n  return values.map((value, index) => ({\n    value,\n    at: times?.[index],\n  }))\n}\n\n/**\n * Check if a value is a keyframe array (for animate prop detection)\n */\nexport function isKeyframeArray(value: unknown): value is number[] {\n  return Array.isArray(value) && value.every((v) => typeof v === 'number')\n}\n","import type { SpringValue } from '../core/spring-value.js'\n\n/**\n * Interpolation options interface\n */\nexport interface InterpolateOptions {\n  /** Clamp output to output range */\n  clamp?: boolean\n  /** Default extrapolation mode */\n  extrapolate?: 'extend' | 'clamp' | 'identity'\n  /** Extrapolation mode for left side */\n  extrapolateLeft?: 'extend' | 'clamp' | 'identity'\n  /** Extrapolation mode for right side */\n  extrapolateRight?: 'extend' | 'clamp' | 'identity'\n}\n\n/**\n * Interpolation interface\n */\nexport interface Interpolation {\n  /** Get current interpolated value */\n  get(): number\n}\n\n/**\n * Default interpolation options\n * Note: extrapolate is handled inline to allow proper branch coverage\n */\nconst defaultInterpolateOptions: Required<Pick<InterpolateOptions, 'clamp'>> = {\n  clamp: false,\n}\n\n/**\n * Value interpolation implementation\n */\nclass InterpolationImpl implements Interpolation {\n  private source: SpringValue | (() => number)\n  private input: number[]\n  private output: number[]\n  private options: InterpolateOptions\n\n  constructor(\n    source: SpringValue | (() => number),\n    input: number[],\n    output: number[],\n    options: InterpolateOptions = {}\n  ) {\n    this.source = source\n    this.input = input\n    this.output = output\n    this.options = { ...defaultInterpolateOptions, ...options }\n  }\n\n  get(): number {\n    const value = typeof this.source === 'function' ? this.source() : this.source.get()\n    return this.interpolate(value)\n  }\n\n  private interpolate(value: number): number {\n    const { input, output } = this\n    const { extrapolate, extrapolateLeft, extrapolateRight, clamp } = this.options\n\n    // Handle single point case - just return the output value\n    if (input.length === 1) {\n      return output[0]!\n    }\n\n    // Handle extrapolation\n    if (value < input[0]!) {\n      // Pass extrapolate as-is (may be undefined to test default branch)\n      const mode = this.getExtrapolationMode(extrapolateLeft, extrapolate)\n      if (mode === 'clamp') {\n        value = input[0]!\n      } else if (mode === 'identity') {\n        return value\n      }\n    } else if (value > input[input.length - 1]!) {\n      // Pass extrapolate as-is (may be undefined to test default branch)\n      const mode = this.getExtrapolationMode(extrapolateRight, extrapolate)\n      if (mode === 'clamp') {\n        value = input[input.length - 1]!\n      } else if (mode === 'identity') {\n        return value\n      }\n    }\n\n    // Find the segment\n    let i = 1\n    while (i < input.length - 1 && value > input[i]!) {\n      i++\n    }\n\n    // Linear interpolation within segment\n    const ratio = (value - input[i - 1]!) / (input[i]! - input[i - 1]!)\n    const result = output[i - 1]! + ratio * (output[i]! - output[i - 1]!)\n\n    if (clamp) {\n      const min = Math.min(...output)\n      const max = Math.max(...output)\n      return Math.max(min, Math.min(max, result))\n    }\n\n    return result\n  }\n\n  private getExtrapolationMode(\n    specificMode: 'extend' | 'clamp' | 'identity' | undefined,\n    fallbackMode: 'extend' | 'clamp' | 'identity' | undefined\n  ): 'extend' | 'clamp' | 'identity' {\n    if (specificMode !== undefined) {\n      return specificMode\n    }\n    if (fallbackMode !== undefined) {\n      return fallbackMode\n    }\n    return 'extend'\n  }\n}\n\n/**\n * Create a value interpolation\n *\n * @param value - Spring value or function that returns a number\n * @param input - Input range (array of numbers)\n * @param output - Output range (array of numbers)\n * @param options - Interpolation options\n * @returns Interpolation controller\n *\n * @example\n * ```ts\n * const x = createSpringValue(0)\n *\n * // Map 0-100 to 0-1 (opacity)\n * const opacity = interpolate(x, [0, 100], [0, 1])\n *\n * x.subscribe(() => {\n *   element.style.opacity = String(opacity.get())\n * })\n *\n * x.set(100) // opacity animates to 1\n * ```\n */\nexport function interpolate(\n  value: SpringValue | (() => number),\n  input: number[],\n  output: number[],\n  options?: InterpolateOptions\n): Interpolation {\n  return new InterpolationImpl(value, input, output, options)\n}\n","import type { SpringValue } from '../core/spring-value.js'\nimport type { InterpolateOptions } from './interpolate.js'\n\n/**\n * Color interpolation interface\n */\nexport interface ColorInterpolation {\n  /** Get current interpolated color */\n  get(): string\n}\n\n/**\n * Color interpolation implementation\n */\nclass ColorInterpolationImpl implements ColorInterpolation {\n  private source: SpringValue | (() => number)\n  private input: number[]\n  private colors: [number, number, number][]\n  private options: InterpolateOptions\n\n  constructor(\n    source: SpringValue | (() => number),\n    input: number[],\n    colorStrings: string[],\n    options: InterpolateOptions = {}\n  ) {\n    this.source = source\n    this.input = input\n    this.colors = colorStrings.map((c) => this.parseColor(c))\n    this.options = options\n  }\n\n  get(): string {\n    let value = typeof this.source === 'function' ? this.source() : this.source.get()\n    const { extrapolate, extrapolateLeft, extrapolateRight } = this.options\n\n    // Handle single color case\n    if (this.input.length === 1) {\n      const [r, g, b] = this.colors[0]!\n      return `rgb(${r}, ${g}, ${b})`\n    }\n\n    // Handle extrapolation\n    if (value < this.input[0]!) {\n      const mode = extrapolateLeft ?? extrapolate ?? 'extend'\n      if (mode === 'clamp') {\n        value = this.input[0]!\n      } else if (mode === 'identity') {\n        // For color, we can't return identity, so we clamp\n        value = this.input[0]!\n      }\n    } else if (value > this.input[this.input.length - 1]!) {\n      const mode = extrapolateRight ?? extrapolate ?? 'extend'\n      if (mode === 'clamp') {\n        value = this.input[this.input.length - 1]!\n      } else if (mode === 'identity') {\n        // For color, we can't return identity, so we clamp\n        value = this.input[this.input.length - 1]!\n      }\n    }\n\n    // Find the segment\n    let i = 1\n    while (i < this.input.length - 1 && value > this.input[i]!) {\n      i++\n    }\n\n    // Calculate interpolation ratio\n    const ratio = (value - this.input[i - 1]!) / (this.input[i]! - this.input[i - 1]!)\n\n    // Interpolate each color channel\n    const r = this.lerp(this.colors[i - 1]![0], this.colors[i]![0], ratio)\n    const g = this.lerp(this.colors[i - 1]![1], this.colors[i]![1], ratio)\n    const b = this.lerp(this.colors[i - 1]![2], this.colors[i]![2], ratio)\n\n    return `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`\n  }\n\n  private parseColor(color: string): [number, number, number] {\n    // Try to parse hex\n    const hexMatch = color.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)\n    if (hexMatch) {\n      const hex = hexMatch[1]!\n      if (hex.length === 3) {\n        return [\n          parseInt(hex.charAt(0) + hex.charAt(0), 16),\n          parseInt(hex.charAt(1) + hex.charAt(1), 16),\n          parseInt(hex.charAt(2) + hex.charAt(2), 16),\n        ]\n      }\n      return [\n        parseInt(hex.slice(0, 2), 16),\n        parseInt(hex.slice(2, 4), 16),\n        parseInt(hex.slice(4, 6), 16),\n      ]\n    }\n\n    // Try to parse rgb()\n    const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/i)\n    if (rgbMatch) {\n      return [\n        parseInt(rgbMatch[1]!, 10),\n        parseInt(rgbMatch[2]!, 10),\n        parseInt(rgbMatch[3]!, 10),\n      ]\n    }\n\n    // Try to parse rgba()\n    const rgbaMatch = color.match(/rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*[\\d.]+\\)/i)\n    if (rgbaMatch) {\n      return [\n        parseInt(rgbaMatch[1]!, 10),\n        parseInt(rgbaMatch[2]!, 10),\n        parseInt(rgbaMatch[3]!, 10),\n      ]\n    }\n\n    // Try to parse hsl()\n    const hslMatch = color.match(/hsl\\((\\d+),\\s*(\\d+)%,\\s*(\\d+)%\\)/i)\n    if (hslMatch) {\n      return this.hslToRgb(\n        parseInt(hslMatch[1]!, 10),\n        parseInt(hslMatch[2]!, 10),\n        parseInt(hslMatch[3]!, 10)\n      )\n    }\n\n    // Default to black\n    return [0, 0, 0]\n  }\n\n  private hslToRgb(h: number, s: number, l: number): [number, number, number] {\n    h = ((h % 360) + 360) % 360\n    s = Math.max(0, Math.min(100, s)) / 100\n    l = Math.max(0, Math.min(100, l)) / 100\n\n    if (s === 0) {\n      const gray = Math.round(l * 255)\n      return [gray, gray, gray]\n    }\n\n    const hue2rgb = (p: number, q: number, t: number): number => {\n      if (t < 0) t += 1\n      if (t > 1) t -= 1\n      if (t < 1 / 6) return p + (q - p) * 6 * t\n      if (t < 1 / 2) return q\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6\n      return p\n    }\n\n    const q = l < 0.5 ? l * (1 + s) : l + s - l * s\n    const p = 2 * l - q\n\n    return [\n      Math.round(hue2rgb(p, q, h / 360 + 1 / 3) * 255),\n      Math.round(hue2rgb(p, q, h / 360) * 255),\n      Math.round(hue2rgb(p, q, h / 360 - 1 / 3) * 255),\n    ]\n  }\n\n  private lerp(a: number, b: number, t: number): number {\n    return a + (b - a) * t\n  }\n}\n\n/**\n * Create a color interpolation\n *\n * @param value - Spring value or function that returns a number\n * @param input - Input range (array of numbers)\n * @param colors - Array of color strings (hex, rgb, hsl)\n * @param options - Interpolation options\n * @returns Color interpolation controller\n *\n * @example\n * ```ts\n * const progress = createSpringValue(0)\n *\n * // Interpolate through colors\n * const color = interpolateColor(\n *   progress,\n *   [0, 50, 100],\n *   ['#ff0000', '#00ff00', '#0000ff']\n * )\n *\n * progress.subscribe(() => {\n *   element.style.backgroundColor = color.get()\n * })\n *\n * progress.set(50) // color is '#00ff00'\n * ```\n */\nexport function interpolateColor(\n  value: SpringValue | (() => number),\n  input: number[],\n  colors: string[],\n  options?: InterpolateOptions\n): ColorInterpolation {\n  return new ColorInterpolationImpl(value, input, colors, options)\n}\n","import { defaultConfig } from '../core/config.js'\nimport { createSpringValue, type SpringValue } from '../core/spring-value.js'\nimport { clamp } from '../utils/math.js'\n\n/**\n * Drag spring configuration interface\n */\nexport interface DragSpringConfig {\n  /** Spring stiffness (default: 100) */\n  stiffness?: number\n  /** Damping ratio (default: 10) */\n  damping?: number\n  /** Mass (default: 1) */\n  mass?: number\n  /** Initial velocity */\n  velocity?: number\n  /** Speed threshold for considering spring at rest (default: 0.01) */\n  restSpeed?: number\n  /** Position threshold for considering spring at rest (default: 0.01) */\n  restDelta?: number\n  /** Clamp value to [from, to] range */\n  clamp?: boolean\n  /** Axis constraint */\n  axis?: 'x' | 'y' | 'both'\n  /** Boundary constraints */\n  bounds?: {\n    left?: number\n    right?: number\n    top?: number\n    bottom?: number\n  }\n  /** Enable rubber band effect at bounds */\n  rubberBand?: boolean\n  /** Rubber band stretch factor (0-1) */\n  rubberBandFactor?: number\n  /** Callback called when drag starts */\n  onDragStart?: (event: PointerEvent) => void\n  /** Callback called during drag */\n  onDrag?: (x: number, y: number, event: PointerEvent) => void\n  /** Callback called when drag ends */\n  onDragEnd?: (x: number, y: number, velocity: { x: number; y: number }) => void\n  /** Callback called on position update */\n  onUpdate?: (x: number, y: number) => void\n}\n\n/**\n * Drag spring interface\n */\nexport interface DragSpring {\n  /** Enable drag interaction */\n  enable(): void\n  /** Disable drag interaction */\n  disable(): void\n  /** Check if currently enabled */\n  isEnabled(): boolean\n  /** Reset to initial position */\n  reset(): void\n  /** Get current position */\n  getPosition(): { x: number; y: number }\n  /** Set position (animated) */\n  setPosition(x: number, y: number): void\n  /** Release with velocity */\n  release(velocityX: number, velocityY: number): void\n  /** Clean up resources */\n  destroy(): void\n}\n\n/**\n * Default drag spring configuration\n */\nconst defaultDragConfig: Required<Omit<DragSpringConfig, 'onDragStart' | 'onDrag' | 'onDragEnd' | 'onUpdate' | 'velocity' | 'bounds'>> = {\n  axis: 'both',\n  rubberBand: false,\n  rubberBandFactor: 0.5,\n  stiffness: 200,\n  damping: 20,\n  mass: 1,\n  restSpeed: 0.01,\n  restDelta: 0.01,\n  clamp: false,\n}\n\n/**\n * Drag spring implementation\n */\nclass DragSpringImpl implements DragSpring {\n  private element: HTMLElement\n  private config: DragSpringConfig\n  private enabled = true\n  private position = { x: 0, y: 0 }\n  private isDragging = false\n  private startPosition = { x: 0, y: 0 }\n  private pointerStart = { x: 0, y: 0 }\n  private lastPosition = { x: 0, y: 0 }\n  private lastTime = 0\n  private velocity = { x: 0, y: 0 }\n\n  // Springs for each axis\n  private springX: SpringValue\n  private springY: SpringValue\n\n  constructor(element: HTMLElement, config: DragSpringConfig = {}) {\n    this.element = element\n    this.config = { ...defaultDragConfig, ...config }\n\n    // Extract only spring physics config for createSpringValue\n    const springConfig = {\n      stiffness: this.config.stiffness,\n      damping: this.config.damping,\n      mass: this.config.mass,\n      restSpeed: this.config.restSpeed,\n      restDelta: this.config.restDelta,\n      clamp: this.config.clamp,\n    }\n\n    this.springX = createSpringValue(0, springConfig)\n    this.springY = createSpringValue(0, springConfig)\n\n    // Subscribe to spring updates\n    this.springX.subscribe(() => {\n      if (!this.isDragging) {\n        this.position.x = this.springX.get()\n        if (this.config.onUpdate) {\n          this.config.onUpdate(this.position.x, this.position.y)\n        }\n      }\n    })\n\n    this.springY.subscribe(() => {\n      if (!this.isDragging) {\n        this.position.y = this.springY.get()\n        if (this.config.onUpdate) {\n          this.config.onUpdate(this.position.x, this.position.y)\n        }\n      }\n    })\n\n    this.setupPointerEvents()\n  }\n\n  private setupPointerEvents(): void {\n    this.element.addEventListener('pointerdown', this.onPointerDown)\n  }\n\n  private onPointerDown = (e: PointerEvent): void => {\n    if (!this.enabled || e.button !== 0) return\n\n    this.isDragging = true\n    this.startPosition = { ...this.position }\n    this.pointerStart = { x: e.clientX, y: e.clientY }\n    this.lastPosition = { x: e.clientX, y: e.clientY }\n    this.lastTime = performance.now()\n    this.velocity = { x: 0, y: 0 }\n\n    this.element.setPointerCapture(e.pointerId)\n    this.element.addEventListener('pointermove', this.onPointerMove)\n    this.element.addEventListener('pointerup', this.onPointerUp)\n    this.element.addEventListener('pointercancel', this.onPointerUp)\n\n    // Explicit if for better branch coverage\n    if (this.config.onDragStart) {\n      this.config.onDragStart(e)\n    }\n  }\n\n  private onPointerMove = (e: PointerEvent): void => {\n    const now = performance.now()\n    const dt = now - this.lastTime\n\n    // Calculate velocity (pixels per ms, scaled to pixels per second)\n    this.velocity = {\n      x: (e.clientX - this.lastPosition.x) / Math.max(dt, 1),\n      y: (e.clientY - this.lastPosition.y) / Math.max(dt, 1),\n    }\n\n    this.lastPosition = { x: e.clientX, y: e.clientY }\n    this.lastTime = now\n\n    // Calculate new position\n    let newX = this.startPosition.x + (e.clientX - this.pointerStart.x)\n    let newY = this.startPosition.y + (e.clientY - this.pointerStart.y)\n\n    // Apply bounds with rubber band\n    if (this.config.bounds) {\n      newX = this.applyBounds(\n        newX,\n        this.config.bounds.left ?? -Infinity,\n        this.config.bounds.right ?? Infinity\n      )\n      newY = this.applyBounds(\n        newY,\n        this.config.bounds.top ?? -Infinity,\n        this.config.bounds.bottom ?? Infinity\n      )\n    }\n\n    // Apply axis constraint\n    if (this.config.axis === 'x') {\n      newY = 0\n    } else if (this.config.axis === 'y') {\n      newX = 0\n    }\n\n    this.position = { x: newX, y: newY }\n    if (this.config.onDrag) {\n      this.config.onDrag(newX, newY, e)\n    }\n    if (this.config.onUpdate) {\n      this.config.onUpdate(newX, newY)\n    }\n  }\n\n  private applyBounds(value: number, min: number, max: number): number {\n    if (!isFinite(min) && !isFinite(max)) return value\n\n    const actualMin = isFinite(min) ? min : -Infinity\n    const actualMax = isFinite(max) ? max : Infinity\n\n    if (this.config.rubberBand) {\n      const factor = this.config.rubberBandFactor || 0.5\n      if (value < actualMin) {\n        return actualMin - (actualMin - value) * factor\n      }\n      if (value > actualMax) {\n        return actualMax + (value - actualMax) * factor\n      }\n    }\n\n    return clamp(value, actualMin, actualMax)\n  }\n\n  private onPointerUp = (e: PointerEvent): void => {\n    this.isDragging = false\n\n    this.element.releasePointerCapture(e.pointerId)\n    this.element.removeEventListener('pointermove', this.onPointerMove)\n    this.element.removeEventListener('pointerup', this.onPointerUp)\n    this.element.removeEventListener('pointercancel', this.onPointerUp)\n\n    // Scale velocity for spring (convert from pixels/ms to more reasonable units)\n    this.release(this.velocity.x * 16, this.velocity.y * 16)\n\n    if (this.config.onDragEnd) {\n      this.config.onDragEnd(this.position.x, this.position.y, this.velocity)\n    }\n  }\n\n  enable(): void {\n    this.enabled = true\n  }\n\n  disable(): void {\n    this.enabled = false\n    if (this.isDragging) {\n      this.isDragging = false\n    }\n  }\n\n  isEnabled(): boolean {\n    return this.enabled\n  }\n\n  reset(): void {\n    this.springX.jump(0)\n    this.springY.jump(0)\n    this.position = { x: 0, y: 0 }\n    // Explicit if for better branch coverage\n    if (this.config.onUpdate) {\n      this.config.onUpdate(0, 0)\n    }\n  }\n\n  getPosition(): { x: number; y: number } {\n    return { ...this.position }\n  }\n\n  setPosition(x: number, y: number): void {\n    // Update position immediately for synchronous access\n    this.position = { x, y }\n    // Animate to the new position\n    this.springX.jump(x)\n    this.springY.jump(y)\n  }\n\n  release(velocityX: number, velocityY: number): void {\n    // Animate back to bounds if outside\n    if (this.config.bounds) {\n      const {\n        left = -Infinity,\n        right = Infinity,\n        top = -Infinity,\n        bottom = Infinity,\n      } = this.config.bounds\n\n      const targetX = clamp(this.position.x, left, right)\n      const targetY = clamp(this.position.y, top, bottom)\n\n      if (targetX !== this.position.x) {\n        this.springX.set(targetX, { velocity: velocityX })\n      }\n      if (targetY !== this.position.y) {\n        this.springY.set(targetY, { velocity: velocityY })\n      }\n    }\n  }\n\n  destroy(): void {\n    this.element.removeEventListener('pointerdown', this.onPointerDown)\n    this.springX.destroy()\n    this.springY.destroy()\n  }\n}\n\n/**\n * Create a drag spring\n *\n * @param element - HTML element to make draggable\n * @param config - Drag spring configuration\n * @returns Drag spring controller\n *\n * @example\n * ```ts\n * const drag = createDragSpring(element, {\n *   onUpdate: (x, y) => {\n *     element.style.transform = `translate(${x}px, ${y}px)`\n *   },\n * })\n * ```\n */\nexport function createDragSpring(\n  element: HTMLElement,\n  config?: DragSpringConfig\n): DragSpring {\n  return new DragSpringImpl(element, config)\n}\n","import { defaultConfig } from '../core/config.js'\nimport { createSpringValue, type SpringValue } from '../core/spring-value.js'\n\n/**\n * Scroll spring configuration interface\n */\nexport interface ScrollSpringConfig {\n  /** Spring stiffness (default: 100) */\n  stiffness?: number\n  /** Damping ratio (default: 10) */\n  damping?: number\n  /** Mass (default: 1) */\n  mass?: number\n  /** Speed threshold for considering spring at rest (default: 0.01) */\n  restSpeed?: number\n  /** Position threshold for considering spring at rest (default: 0.01) */\n  restDelta?: number\n  /** Clamp value to [from, to] range */\n  clamp?: boolean\n  /** Scroll direction */\n  direction?: 'horizontal' | 'vertical' | 'both'\n  /** Enable momentum/inertia */\n  momentum?: boolean\n  /** Momentum decay factor (0-1) */\n  momentumDecay?: number\n  /** Enable bounce at edges */\n  bounce?: boolean\n  /** Bounce spring stiffness */\n  bounceStiffness?: number\n  /** Bounce spring damping */\n  bounceDamping?: number\n  /** Callback called on scroll */\n  onScroll?: (scrollX: number, scrollY: number) => void\n  /** Callback called when scroll starts */\n  onScrollStart?: () => void\n  /** Callback called when scroll ends */\n  onScrollEnd?: () => void\n}\n\n/**\n * Scroll spring interface\n */\nexport interface ScrollSpring {\n  /** Get current scroll position */\n  getScroll(): { x: number; y: number }\n  /** Scroll to position */\n  scrollTo(x: number, y: number): void\n  /** Scroll to element */\n  scrollToElement(element: HTMLElement, offset?: number): void\n  /** Enable scroll handling */\n  enable(): void\n  /** Disable scroll handling */\n  disable(): void\n  /** Clean up resources */\n  destroy(): void\n}\n\n/**\n * Default scroll spring configuration\n */\nconst defaultScrollConfig: Required<\n  Omit<\n    ScrollSpringConfig,\n    | 'onScroll'\n    | 'onScrollStart'\n    | 'onScrollEnd'\n    | 'bounceStiffness'\n    | 'bounceDamping'\n    | 'velocity'\n  >\n> = {\n  direction: 'vertical',\n  momentum: false,\n  momentumDecay: 0.95,\n  bounce: false,\n  stiffness: 100,\n  damping: 10,\n  mass: 1,\n  restSpeed: 0.01,\n  restDelta: 0.01,\n  clamp: false,\n}\n\n/**\n * Scroll spring implementation\n */\nclass ScrollSpringImpl implements ScrollSpring {\n  private container: HTMLElement\n  private config: ScrollSpringConfig\n  private scroll = { x: 0, y: 0 }\n  private target = { x: 0, y: 0 }\n  private isScrolling = false\n  private isEnabled = true\n\n  private springX: SpringValue\n  private springY: SpringValue\n\n  constructor(container: HTMLElement, config: ScrollSpringConfig = {}) {\n    this.container = container\n    this.config = { ...defaultScrollConfig, ...config }\n\n    // Extract only spring physics config for createSpringValue\n    const springConfig = {\n      stiffness: this.config.stiffness,\n      damping: this.config.damping,\n      mass: this.config.mass,\n      restSpeed: this.config.restSpeed,\n      restDelta: this.config.restDelta,\n      clamp: this.config.clamp,\n    }\n\n    this.springX = createSpringValue(0, springConfig)\n    this.springY = createSpringValue(0, springConfig)\n\n    // Subscribe to spring updates\n    this.springX.subscribe(() => {\n      this.scroll.x = this.springX.get()\n      this.config.onScroll?.(this.scroll.x, this.scroll.y)\n    })\n\n    this.springY.subscribe(() => {\n      this.scroll.y = this.springY.get()\n      this.config.onScroll?.(this.scroll.x, this.scroll.y)\n    })\n\n    this.setupScrollEvents()\n  }\n\n  private setupScrollEvents(): void {\n    this.container.addEventListener('wheel', this.onWheel, { passive: false })\n  }\n\n  private onWheel = (e: WheelEvent): void => {\n    if (!this.isEnabled) return\n\n    if (!this.isScrolling) {\n      this.isScrolling = true\n      this.config.onScrollStart?.()\n    }\n\n    // Apply direction filter\n    let deltaX = e.deltaX\n    let deltaY = e.deltaY\n\n    if (this.config.direction === 'horizontal') {\n      deltaY = 0\n    } else if (this.config.direction === 'vertical') {\n      deltaX = 0\n    }\n\n    // Apply bounce at edges\n    if (this.config.bounce) {\n      const maxScrollX = this.container.scrollWidth - this.container.clientWidth\n      const maxScrollY = this.container.scrollHeight - this.container.clientHeight\n\n      this.target.x += deltaX\n      this.target.y += deltaY\n\n      // Apply rubber band at edges\n      if (this.target.x < 0) {\n        this.target.x = -Math.sqrt(-this.target.x) * 10\n      } else if (this.target.x > maxScrollX) {\n        this.target.x = maxScrollX + Math.sqrt(this.target.x - maxScrollX) * 10\n      }\n\n      if (this.target.y < 0) {\n        this.target.y = -Math.sqrt(-this.target.y) * 10\n      } else if (this.target.y > maxScrollY) {\n        this.target.y = maxScrollY + Math.sqrt(this.target.y - maxScrollY) * 10\n      }\n\n      // Prevent default to handle scroll ourselves\n      e.preventDefault()\n    } else {\n      this.target.x += deltaX\n      this.target.y += deltaY\n\n      // Clamp to bounds\n      const maxScrollX = this.container.scrollWidth - this.container.clientWidth\n      const maxScrollY = this.container.scrollHeight - this.container.clientHeight\n\n      this.target.x = Math.max(0, Math.min(this.target.x, maxScrollX))\n      this.target.y = Math.max(0, Math.min(this.target.y, maxScrollY))\n    }\n\n    this.startScrollLoop()\n  }\n\n  private startScrollLoop(): void {\n    // Update springs towards target\n    this.springX.set(this.target.x)\n    this.springY.set(this.target.y)\n\n    // Check for scroll end\n    const checkEnd = () => {\n      const settled =\n        Math.abs(this.scroll.x - this.target.x) < 0.1 &&\n        Math.abs(this.scroll.y - this.target.y) < 0.1 &&\n        !this.springX.isAnimating() &&\n        !this.springY.isAnimating()\n\n      if (settled && this.isScrolling) {\n        this.isScrolling = false\n        this.config.onScrollEnd?.()\n      } else if (this.isScrolling) {\n        requestAnimationFrame(checkEnd)\n      }\n    }\n\n    checkEnd()\n  }\n\n  getScroll(): { x: number; y: number } {\n    return { ...this.scroll }\n  }\n\n  scrollTo(x: number, y: number): void {\n    this.target = { x, y }\n    this.springX.set(x)\n    this.springY.set(y)\n  }\n\n  scrollToElement(element: HTMLElement, offset = 0): void {\n    const containerRect = this.container.getBoundingClientRect()\n    const elementRect = element.getBoundingClientRect()\n\n    const x = elementRect.left - containerRect.left + this.scroll.x + offset\n    const y = elementRect.top - containerRect.top + this.scroll.y + offset\n\n    this.scrollTo(x, y)\n  }\n\n  enable(): void {\n    this.isEnabled = true\n  }\n\n  disable(): void {\n    this.isEnabled = false\n  }\n\n  destroy(): void {\n    this.container.removeEventListener('wheel', this.onWheel)\n    this.springX.destroy()\n    this.springY.destroy()\n  }\n}\n\n/**\n * Create a scroll spring\n *\n * @param container - Scrollable container element\n * @param config - Scroll spring configuration\n * @returns Scroll spring controller\n *\n * @example\n * ```ts\n * const scroll = createScrollSpring(container, {\n *   onScroll: (x, y) => {\n *     content.style.transform = `translate(${-x}px, ${-y}px)`\n *   },\n * })\n * ```\n */\nexport function createScrollSpring(\n  container: HTMLElement,\n  config?: ScrollSpringConfig\n): ScrollSpring {\n  return new ScrollSpringImpl(container, config)\n}\n","import type { SpringValue } from '../core/spring-value.js'\n\n/**\n * RGB color representation\n */\nexport interface RGB {\n  r: number\n  g: number\n  b: number\n}\n\n/**\n * HSL color representation\n */\nexport interface HSL {\n  h: number\n  s: number\n  l: number\n}\n\n/**\n * Parse a color string to RGB\n * Supports hex (#rgb, #rrggbb), rgb(), and named colors\n * @param color - The color string to parse\n * @returns The RGB representation\n */\nexport function parseColor(color: string): RGB {\n  // Try hex format first\n  const hexMatch = color.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)\n  if (hexMatch) {\n    return hexToRgb(color)\n  }\n\n  // Try rgb() format\n  const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/i)\n  if (rgbMatch) {\n    return {\n      r: parseInt(rgbMatch[1]!, 10),\n      g: parseInt(rgbMatch[2]!, 10),\n      b: parseInt(rgbMatch[3]!, 10),\n    }\n  }\n\n  // Try rgba() format\n  const rgbaMatch = color.match(/rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*[\\d.]+\\)/i)\n  if (rgbaMatch) {\n    return {\n      r: parseInt(rgbaMatch[1]!, 10),\n      g: parseInt(rgbaMatch[2]!, 10),\n      b: parseInt(rgbaMatch[3]!, 10),\n    }\n  }\n\n  // Try hsl() format\n  const hslMatch = color.match(/hsl\\((\\d+),\\s*(\\d+)%,\\s*(\\d+)%\\)/i)\n  if (hslMatch) {\n    return hslToRgb(\n      parseInt(hslMatch[1]!, 10),\n      parseInt(hslMatch[2]!, 10),\n      parseInt(hslMatch[3]!, 10)\n    )\n  }\n\n  // Default to black for unknown formats\n  return { r: 0, g: 0, b: 0 }\n}\n\n/**\n * Convert RGB to hex color string\n * @param r - Red component (0-255)\n * @param g - Green component (0-255)\n * @param b - Blue component (0-255)\n * @returns Hex color string\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  const toHex = (n: number): string => {\n    const clamped = Math.round(Math.max(0, Math.min(255, n)))\n    return clamped.toString(16).padStart(2, '0')\n  }\n  return `#${toHex(r)}${toHex(g)}${toHex(b)}`\n}\n\n/**\n * Convert hex color string to RGB\n * @param hex - Hex color string (with or without #)\n * @returns RGB representation\n */\nexport function hexToRgb(hex: string): RGB {\n  const cleanHex = hex.replace('#', '')\n\n  if (cleanHex.length === 3) {\n    return {\n      r: parseInt(cleanHex.charAt(0) + cleanHex.charAt(0), 16),\n      g: parseInt(cleanHex.charAt(1) + cleanHex.charAt(1), 16),\n      b: parseInt(cleanHex.charAt(2) + cleanHex.charAt(2), 16),\n    }\n  }\n\n  return {\n    r: parseInt(cleanHex.slice(0, 2), 16),\n    g: parseInt(cleanHex.slice(2, 4), 16),\n    b: parseInt(cleanHex.slice(4, 6), 16),\n  }\n}\n\n/**\n * Convert HSL to RGB\n * @param h - Hue (0-360)\n * @param s - Saturation (0-100)\n * @param l - Lightness (0-100)\n * @returns RGB representation\n */\nexport function hslToRgb(h: number, s: number, l: number): RGB {\n  h = ((h % 360) + 360) % 360\n  s = Math.max(0, Math.min(100, s)) / 100\n  l = Math.max(0, Math.min(100, l)) / 100\n\n  if (s === 0) {\n    const gray = Math.round(l * 255)\n    return { r: gray, g: gray, b: gray }\n  }\n\n  const hue2rgb = (p: number, q: number, t: number): number => {\n    if (t < 0) t += 1\n    if (t > 1) t -= 1\n    if (t < 1 / 6) return p + (q - p) * 6 * t\n    if (t < 1 / 2) return q\n    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6\n    return p\n  }\n\n  const q = l < 0.5 ? l * (1 + s) : l + s - l * s\n  const p = 2 * l - q\n\n  return {\n    r: Math.round(hue2rgb(p, q, h / 360 + 1 / 3) * 255),\n    g: Math.round(hue2rgb(p, q, h / 360) * 255),\n    b: Math.round(hue2rgb(p, q, h / 360 - 1 / 3) * 255),\n  }\n}\n\n/**\n * Convert RGB to HSL\n * @param r - Red component (0-255)\n * @param g - Green component (0-255)\n * @param b - Blue component (0-255)\n * @returns HSL representation\n */\nexport function rgbToHsl(r: number, g: number, b: number): HSL {\n  r = Math.max(0, Math.min(255, r)) / 255\n  g = Math.max(0, Math.min(255, g)) / 255\n  b = Math.max(0, Math.min(255, b)) / 255\n\n  const max = Math.max(r, g, b)\n  const min = Math.min(r, g, b)\n  const delta = max - min\n\n  let h = 0\n  let s = 0\n\n  if (delta !== 0) {\n    s = (max + min) / 2 > 0.5\n      ? delta / (2 - max - min)\n      : delta / (max + min)\n\n    if (max === r) {\n      h = ((g - b) / delta + (g < b ? 6 : 0)) / 6\n    } else if (max === g) {\n      h = ((b - r) / delta + 2) / 6\n    } else {\n      h = ((r - g) / delta + 4) / 6\n    }\n  }\n\n  return {\n    h: Math.round(h * 360),\n    s: Math.round(s * 100),\n    l: Math.round(((max + min) / 2) * 100),\n  }\n}\n","/**\n * MotionValue - High-performance animated value without React re-renders\n *\n * Unlike React state, MotionValue updates don't trigger component re-renders.\n * This makes it ideal for high-frequency animations like drag, scroll, and gestures.\n *\n * @example\n * ```ts\n * const x = createMotionValue(0)\n *\n * // Subscribe to changes (no React re-render)\n * x.on('change', (value) => {\n *   element.style.transform = `translateX(${value}px)`\n * })\n *\n * // Update value\n * x.set(100)  // Triggers spring animation\n * x.jump(100) // Instant update, no animation\n * ```\n */\n\nimport { createSpringValue } from './spring-value.js'\nimport type { SpringConfig } from '../types.js'\n\nexport type MotionValueSubscriber<T> = (value: T) => void\nexport type MotionValueEvent = 'change' | 'animationStart' | 'animationEnd'\n\nexport interface MotionValueOptions {\n  /** Spring configuration for animated transitions */\n  spring?: SpringConfig\n}\n\n/**\n * MotionValue class - Performant animated values\n *\n * Key advantages over React state:\n * - No re-renders on value change\n * - Direct DOM manipulation for 60fps animations\n * - Chainable with useTransform\n * - Memory efficient with automatic cleanup\n */\nexport class MotionValue<T = number> {\n  private _value: T\n  private _velocity: number = 0\n  private _subscribers: Set<MotionValueSubscriber<T>> = new Set()\n  private _eventListeners: Map<MotionValueEvent, Set<() => void>> = new Map()\n  private _springValue: ReturnType<typeof createSpringValue> | null = null\n  private _springConfig: SpringConfig\n  private _isAnimating: boolean = false\n  private _destroyed: boolean = false\n\n  constructor(initialValue: T, options: MotionValueOptions = {}) {\n    this._value = initialValue\n    this._springConfig = options.spring ?? { stiffness: 100, damping: 15 }\n\n    // Initialize spring for numeric values\n    if (typeof initialValue === 'number') {\n      this._springValue = createSpringValue(initialValue as number, {\n        ...this._springConfig,\n        onUpdate: (v: number) => {\n          if (this._destroyed) return\n          this._value = v as T\n          this._velocity = this._springValue?.getVelocity() ?? 0\n          this._notify()\n        },\n      })\n    }\n  }\n\n  /**\n   * Get current value synchronously\n   */\n  get(): T {\n    return this._value\n  }\n\n  /**\n   * Get current velocity (for numeric values)\n   */\n  getVelocity(): number {\n    return this._velocity\n  }\n\n  /**\n   * Check if currently animating\n   */\n  isAnimating(): boolean {\n    return this._isAnimating\n  }\n\n  /**\n   * Set value with spring animation\n   */\n  set(newValue: T, animate: boolean = true): void {\n    if (this._destroyed) return\n\n    if (typeof newValue === 'number' && this._springValue && animate) {\n      this._isAnimating = true\n      this._emit('animationStart')\n\n      this._springValue.set(newValue as number)\n\n      // Check for animation end\n      const checkEnd = () => {\n        if (this._springValue && Math.abs(this._springValue.getVelocity()) < 0.01) {\n          this._isAnimating = false\n          this._emit('animationEnd')\n        } else if (this._isAnimating) {\n          requestAnimationFrame(checkEnd)\n        }\n      }\n      requestAnimationFrame(checkEnd)\n    } else {\n      this._value = newValue\n      this._velocity = 0\n      this._notify()\n    }\n  }\n\n  /**\n   * Instantly set value without animation\n   */\n  jump(newValue: T): void {\n    if (this._destroyed) return\n\n    this._value = newValue\n    this._velocity = 0\n\n    if (typeof newValue === 'number' && this._springValue) {\n      this._springValue.jump(newValue as number)\n    }\n\n    this._isAnimating = false\n    this._notify()\n  }\n\n  /**\n   * Stop any running animation\n   */\n  stop(): void {\n    // SpringValue doesn't have stop(), so we jump to current value\n    if (this._springValue) {\n      this._springValue.jump(this._springValue.get())\n    }\n    this._isAnimating = false\n    this._emit('animationEnd')\n  }\n\n  /**\n   * Subscribe to value changes\n   * Returns unsubscribe function\n   */\n  subscribe(callback: MotionValueSubscriber<T>): () => void {\n    this._subscribers.add(callback)\n\n    // Immediately call with current value\n    callback(this._value)\n\n    return () => {\n      this._subscribers.delete(callback)\n    }\n  }\n\n  /**\n   * Add event listener\n   */\n  on(event: MotionValueEvent, callback: () => void): () => void {\n    if (!this._eventListeners.has(event)) {\n      this._eventListeners.set(event, new Set())\n    }\n    this._eventListeners.get(event)!.add(callback)\n\n    return () => {\n      this._eventListeners.get(event)?.delete(callback)\n    }\n  }\n\n  /**\n   * Update spring configuration\n   */\n  setConfig(config: Partial<SpringConfig>): void {\n    this._springConfig = { ...this._springConfig, ...config }\n    // Note: Config change takes effect on next animation\n  }\n\n  /**\n   * Destroy and cleanup\n   */\n  destroy(): void {\n    this._destroyed = true\n    this._subscribers.clear()\n    this._eventListeners.clear()\n\n    if (this._springValue) {\n      this._springValue.destroy()\n      this._springValue = null\n    }\n  }\n\n  private _notify(): void {\n    this._subscribers.forEach((callback) => {\n      try {\n        callback(this._value)\n      } catch (e) {\n        console.error('MotionValue subscriber error:', e)\n      }\n    })\n    this._emit('change')\n  }\n\n  private _emit(event: MotionValueEvent): void {\n    this._eventListeners.get(event)?.forEach((callback) => {\n      try {\n        callback()\n      } catch (e) {\n        console.error(`MotionValue ${event} listener error:`, e)\n      }\n    })\n  }\n}\n\n/**\n * Create a new MotionValue\n *\n * @example\n * ```ts\n * const x = createMotionValue(0)\n * const opacity = createMotionValue(1)\n * const scale = createMotionValue(1, { spring: { stiffness: 300, damping: 30 } })\n * ```\n */\nexport function createMotionValue<T = number>(\n  initialValue: T,\n  options?: MotionValueOptions\n): MotionValue<T> {\n  return new MotionValue(initialValue, options)\n}\n\n/**\n * Transform a MotionValue using a mapping function\n *\n * Creates a derived MotionValue that automatically updates\n * when the source value changes.\n *\n * @example\n * ```ts\n * const x = createMotionValue(0)\n * const opacity = transformValue(x, (v) => 1 - v / 100)\n * const inverted = transformValue(x, (v) => -v)\n * ```\n */\nexport function transformValue<T, U>(\n  source: MotionValue<T>,\n  transform: (value: T) => U\n): MotionValue<U> {\n  const derived = new MotionValue<U>(transform(source.get()))\n\n  source.subscribe((value) => {\n    derived.jump(transform(value))\n  })\n\n  return derived\n}\n\n/**\n * Map a MotionValue from one range to another\n *\n * @example\n * ```ts\n * const x = createMotionValue(0)\n * // Map 0-100 to 0-1\n * const progress = mapRange(x, [0, 100], [0, 1])\n * // Map with extrapolation clamped\n * const clamped = mapRange(x, [0, 100], [0, 1], { clamp: true })\n * ```\n */\nexport function mapRange(\n  source: MotionValue<number>,\n  inputRange: [number, number],\n  outputRange: [number, number],\n  options: { clamp?: boolean } = {}\n): MotionValue<number> {\n  const [inMin, inMax] = inputRange\n  const [outMin, outMax] = outputRange\n\n  return transformValue(source, (value) => {\n    let normalized = (value - inMin) / (inMax - inMin)\n\n    if (options.clamp) {\n      normalized = Math.max(0, Math.min(1, normalized))\n    }\n\n    return outMin + normalized * (outMax - outMin)\n  })\n}\n","import { createSpringValue } from '../core/spring-value.js'\nimport type { SpringConfig } from '../types.js'\n\n/**\n * Options for path animation\n */\nexport interface PathAnimationOptions {\n  /** Spring configuration */\n  config?: SpringConfig\n  /** Whether to auto-play on creation */\n  autoPlay?: boolean\n  /** Callback for value updates */\n  onUpdate?: (value: number) => void\n  /** Callback when animation completes */\n  onComplete?: () => void\n}\n\n/**\n * Path animation controller\n */\nexport interface PathAnimation {\n  /** Start the animation from 0 to target */\n  play: (target?: number) => Promise<void>\n  /** Reverse the animation */\n  reverse: () => Promise<void>\n  /** Set path length directly (0-1) */\n  set: (value: number, animate?: boolean) => void\n  /** Get current path length */\n  get: () => number\n  /** Pause the animation */\n  pause: () => void\n  /** Resume the animation */\n  resume: () => void\n  /** Stop and reset */\n  reset: () => void\n  /** Check if animating */\n  isAnimating: () => boolean\n  /** Destroy and cleanup */\n  destroy: () => void\n}\n\n/**\n * Create a path length animation for SVG stroke drawing effects.\n * Animates stroke-dashoffset to reveal/hide a path.\n *\n * @example Basic path drawing\n * ```ts\n * const pathAnim = createPathAnimation(pathElement, {\n *   config: { stiffness: 100, damping: 15 },\n * })\n *\n * // Draw the path\n * await pathAnim.play()\n *\n * // Erase the path\n * await pathAnim.reverse()\n * ```\n *\n * @example With offset control\n * ```ts\n * const anim = createPathAnimation(path)\n *\n * // Draw 50% of the path\n * anim.set(0.5)\n *\n * // Draw full path with animation\n * anim.set(1, true)\n * ```\n */\nexport function createPathAnimation(\n  element: SVGPathElement | SVGCircleElement | SVGRectElement | SVGLineElement | SVGPolylineElement | SVGPolygonElement | SVGEllipseElement,\n  options: PathAnimationOptions = {}\n): PathAnimation {\n  const {\n    config = {},\n    autoPlay = false,\n    onUpdate,\n    onComplete,\n  } = options\n\n  // Get total path length\n  const totalLength = element.getTotalLength?.() ?? 0\n\n  // Set initial stroke properties\n  element.style.strokeDasharray = String(totalLength)\n  element.style.strokeDashoffset = String(totalLength)\n\n  let currentValue = 0\n  let destroyed = false\n  const spring = createSpringValue(0, config)\n\n  // Subscribe to updates\n  const unsubscribe = spring.subscribe((value) => {\n    if (destroyed) return\n\n    currentValue = value\n    // Convert 0-1 to offset (1 = hidden, 0 = visible)\n    const offset = totalLength * (1 - value)\n    element.style.strokeDashoffset = String(offset)\n    onUpdate?.(value)\n  })\n\n  const waitForRest = (): Promise<void> => {\n    return new Promise((resolve) => {\n      const check = () => {\n        if (destroyed || !spring.isAnimating()) {\n          resolve()\n        } else {\n          requestAnimationFrame(check)\n        }\n      }\n      setTimeout(check, 16)\n    })\n  }\n\n  const animation: PathAnimation = {\n    play: async (target = 1) => {\n      if (destroyed) return\n      spring.set(target)\n      await waitForRest()\n      onComplete?.()\n    },\n\n    reverse: async () => {\n      if (destroyed) return\n      spring.set(0)\n      await waitForRest()\n      onComplete?.()\n    },\n\n    set: (value: number, animate = false) => {\n      if (destroyed) return\n\n      if (animate) {\n        spring.set(value)\n      } else {\n        spring.jump(value)\n        currentValue = value\n        const offset = totalLength * (1 - value)\n        element.style.strokeDashoffset = String(offset)\n      }\n    },\n\n    get: () => currentValue,\n\n    pause: () => {\n      if (destroyed) return\n      spring.stop()\n    },\n\n    resume: () => {\n      if (destroyed) return\n      // Resume by re-setting target\n      spring.set(currentValue)\n    },\n\n    reset: () => {\n      if (destroyed) return\n      spring.jump(0)\n      currentValue = 0\n      element.style.strokeDashoffset = String(totalLength)\n    },\n\n    isAnimating: () => spring.isAnimating(),\n\n    destroy: () => {\n      destroyed = true\n      unsubscribe()\n      spring.destroy()\n    },\n  }\n\n  if (autoPlay) {\n    animation.play()\n  }\n\n  return animation\n}\n\n/**\n * Get the total length of an SVG path element\n */\nexport function getPathLength(\n  element: SVGPathElement | SVGCircleElement | SVGRectElement | SVGLineElement | SVGPolylineElement | SVGPolygonElement | SVGEllipseElement\n): number {\n  return element.getTotalLength?.() ?? 0\n}\n\n/**\n * Set up an element for path animation (sets dasharray and dashoffset)\n */\nexport function preparePathForAnimation(\n  element: SVGPathElement | SVGCircleElement | SVGRectElement | SVGLineElement | SVGPolylineElement | SVGPolygonElement | SVGEllipseElement,\n  initialProgress = 0\n): void {\n  const length = element.getTotalLength?.() ?? 0\n  element.style.strokeDasharray = String(length)\n  element.style.strokeDashoffset = String(length * (1 - initialProgress))\n}\n\n/**\n * Calculate the point on a path at a given percentage\n */\nexport function getPointAtProgress(\n  path: SVGPathElement,\n  progress: number\n): DOMPoint | null {\n  try {\n    const length = path.getTotalLength()\n    return path.getPointAtLength(length * Math.max(0, Math.min(1, progress)))\n  } catch {\n    return null\n  }\n}\n","import { createSpringValue } from '../core/spring-value.js'\nimport type { SpringConfig } from '../types.js'\n\n/**\n * Measured box dimensions\n */\nexport interface MeasuredBox {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * FLIP animation options\n */\nexport interface FlipOptions {\n  /** Spring configuration */\n  config?: SpringConfig\n  /** Whether to animate position */\n  position?: boolean\n  /** Whether to animate size */\n  size?: boolean\n  /** Callback when animation completes */\n  onComplete?: () => void\n  /** Callback for value updates */\n  onUpdate?: (progress: number) => void\n}\n\n/**\n * FLIP animation controller\n */\nexport interface FlipAnimation {\n  /** Play the FLIP animation */\n  play: () => Promise<void>\n  /** Get current progress (0-1) */\n  getProgress: () => number\n  /** Cancel the animation */\n  cancel: () => void\n  /** Check if animating */\n  isAnimating: () => boolean\n}\n\n/**\n * Measure the bounding box of an element\n */\nexport function measureElement(element: HTMLElement): MeasuredBox {\n  const rect = element.getBoundingClientRect()\n  return {\n    x: rect.left + window.scrollX,\n    y: rect.top + window.scrollY,\n    width: rect.width,\n    height: rect.height,\n  }\n}\n\n/**\n * Create a FLIP (First, Last, Invert, Play) animation.\n *\n * FLIP is a technique for animating layout changes performantly:\n * 1. First: Measure the element's initial position\n * 2. Last: Apply the change and measure final position\n * 3. Invert: Apply transforms to make it look like it's still in the first position\n * 4. Play: Animate the transforms to zero\n *\n * @example Basic FLIP\n * ```ts\n * // Measure first position\n * const first = measureElement(element)\n *\n * // Make layout change\n * element.classList.toggle('expanded')\n *\n * // Measure last position\n * const last = measureElement(element)\n *\n * // Create and play FLIP animation\n * const flip = createFlip(element, first, last)\n * await flip.play()\n * ```\n *\n * @example With options\n * ```ts\n * const flip = createFlip(element, first, last, {\n *   config: { stiffness: 300, damping: 30 },\n *   position: true,  // Animate position\n *   size: true,      // Animate size\n *   onComplete: () => console.log('Done!'),\n * })\n * ```\n */\nexport function createFlip(\n  element: HTMLElement,\n  first: MeasuredBox,\n  last: MeasuredBox,\n  options: FlipOptions = {}\n): FlipAnimation {\n  const {\n    config = {},\n    position = true,\n    size = true,\n    onComplete,\n    onUpdate,\n  } = options\n\n  // Calculate the inversion (how much to transform to get back to \"first\")\n  const deltaX = first.x - last.x\n  const deltaY = first.y - last.y\n  const deltaWidth = first.width / last.width\n  const deltaHeight = first.height / last.height\n\n  let progress = 0\n  let isPlaying = false\n  let cancelled = false\n\n  const spring = createSpringValue(0, config)\n\n  // Store original transform\n  const originalTransform = element.style.transform\n  const originalTransformOrigin = element.style.transformOrigin\n\n  // Set transform origin to top-left for size animations\n  if (size) {\n    element.style.transformOrigin = '0 0'\n  }\n\n  const applyTransform = (t: number) => {\n    progress = t\n    const invertedT = 1 - t\n\n    const transforms: string[] = []\n\n    if (position) {\n      transforms.push(`translate(${deltaX * invertedT}px, ${deltaY * invertedT}px)`)\n    }\n\n    if (size && (deltaWidth !== 1 || deltaHeight !== 1)) {\n      const scaleX = 1 + (deltaWidth - 1) * invertedT\n      const scaleY = 1 + (deltaHeight - 1) * invertedT\n      transforms.push(`scale(${scaleX}, ${scaleY})`)\n    }\n\n    element.style.transform = transforms.length > 0 ? transforms.join(' ') : ''\n    onUpdate?.(t)\n  }\n\n  // Apply initial inversion\n  applyTransform(0)\n\n  const cleanup = () => {\n    // Restore original styles\n    element.style.transform = originalTransform\n    element.style.transformOrigin = originalTransformOrigin\n  }\n\n  return {\n    play: async () => {\n      if (cancelled) return\n\n      isPlaying = true\n\n      return new Promise<void>((resolve) => {\n        const unsubscribe = spring.subscribe((value) => {\n          if (cancelled) {\n            unsubscribe()\n            resolve()\n            return\n          }\n          applyTransform(value)\n        })\n\n        spring.set(1)\n\n        // Wait for animation to complete\n        const checkComplete = () => {\n          if (cancelled) {\n            unsubscribe()\n            cleanup()\n            resolve()\n            return\n          }\n\n          if (!spring.isAnimating()) {\n            isPlaying = false\n            unsubscribe()\n            cleanup()\n            onComplete?.()\n            resolve()\n          } else {\n            requestAnimationFrame(checkComplete)\n          }\n        }\n\n        setTimeout(checkComplete, 16)\n      })\n    },\n\n    getProgress: () => progress,\n\n    cancel: () => {\n      cancelled = true\n      isPlaying = false\n      spring.stop()\n      cleanup()\n    },\n\n    isAnimating: () => isPlaying,\n  }\n}\n\n/**\n * Higher-level helper that handles the full FLIP flow.\n * Automatically measures before/after states.\n *\n * @example\n * ```ts\n * await flip(element, () => {\n *   element.classList.toggle('expanded')\n * }, { config: { stiffness: 200 } })\n * ```\n */\nexport async function flip(\n  element: HTMLElement,\n  mutate: () => void | Promise<void>,\n  options: FlipOptions = {}\n): Promise<void> {\n  // First: measure initial state\n  const first = measureElement(element)\n\n  // Last: apply mutation and measure final state\n  await mutate()\n\n  // Force layout recalculation\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n  element.offsetHeight\n\n  const last = measureElement(element)\n\n  // Invert & Play\n  const animation = createFlip(element, first, last, options)\n  await animation.play()\n}\n\n/**\n * Batch FLIP animations for multiple elements.\n * Useful when multiple elements change position together.\n *\n * @example\n * ```ts\n * await flipBatch(\n *   [card1, card2, card3],\n *   () => container.classList.toggle('grid'),\n *   { config: { stiffness: 150 } }\n * )\n * ```\n */\nexport async function flipBatch(\n  elements: HTMLElement[],\n  mutate: () => void | Promise<void>,\n  options: FlipOptions = {}\n): Promise<void> {\n  // First: measure all elements\n  const firstStates = elements.map((el) => measureElement(el))\n\n  // Last: apply mutation\n  await mutate()\n\n  // Force layout recalculation\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n  document.body.offsetHeight\n\n  // Measure all final states and create animations\n  const animations = elements.map((element, i) => {\n    const last = measureElement(element)\n    return createFlip(element, firstStates[i]!, last, options)\n  })\n\n  // Play all animations\n  await Promise.all(animations.map((anim) => anim.play()))\n}\n"]}