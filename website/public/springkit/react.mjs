import N,{useRef,useState,useEffect}from'react';import {jsx,Fragment}from'react/jsx-runtime';var b={stiffness:100,damping:10,mass:1,velocity:0,restSpeed:.01,restDelta:.01,clamp:false};function G(o,e,t,i){let{stiffness:n=100,damping:r=10,mass:s=1,restSpeed:m=.01,restDelta:a=.01}=i,f=t-o,c=Math.abs(f),p=Math.abs(e);if(c<=a&&p<=m)return {position:t,velocity:0,isRest:true};let u=1/60,d=n*f,g=p>1e-4?r*e:0,y=(d-g)/s,T=e+y*u,S=o+T*u,R=c<=a&&Math.abs(T)<=m;return {position:S,velocity:T,isRest:R}}var D=class{constructor(){this.animations=new Set;this.animationMap=new WeakMap;this.rafId=null;this.isRunning=false;this.lastTime=0;this.nextId=1;this.idMap=new WeakMap;this.frameListeners=new Set;this.registry=new FinalizationRegistry(e=>{this.cleanupCallbacks.forEach(t=>t(e));});this.cleanupCallbacks=new Set;this.tick=()=>{let e=performance.now(),t=e-this.lastTime,i=Math.min(t,64);this.lastTime=e;for(let r of this.frameListeners)r(i);let n=[];for(let r of this.animations){let s=r.deref();if(!s){n.push(r);continue}s.update(e),s.isComplete()&&(n.push(r),this.animationMap.delete(s),this.idMap.delete(s));}for(let r=0;r<n.length;r++)this.animations.delete(n[r]);this.animations.size>0?this.rafId=requestAnimationFrame(this.tick):this.stop();};}add(e){let t=this.idMap.get(e);if(t!==void 0)return t;let i=this.nextId++,n=new WeakRef(e);return this.animations.add(n),this.animationMap.set(e,n),this.idMap.set(e,i),this.registry.register(e,i),this.start(),i}remove(e){let t=this.animationMap.get(e);t&&(this.animations.delete(t),this.animationMap.delete(e),this.idMap.delete(e)),this.animations.size===0&&this.stop();}onCleanup(e){return this.cleanupCallbacks.add(e),()=>this.cleanupCallbacks.delete(e)}onFrame(e){return this.frameListeners.add(e),()=>this.frameListeners.delete(e)}start(){this.isRunning||(this.isRunning=true,this.lastTime=performance.now(),this.tick());}stop(){this.isRunning=false,this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null);}get size(){return this.animations.size}getAliveCount(){let e=0;for(let t of this.animations)t.deref()&&e++;return e}getFPS(){let e=performance.now()-this.lastTime;return e>0?Math.round(1e3/e):60}},x=new D;function C(o,e,t){let i=Math.min(e,t),n=Math.max(e,t);return Math.max(i,Math.min(n,o))}var O=typeof process<"u"&&process.env?.NODE_ENV!=="production",Y=new Set;function P(o){!O||Y.has(o)||(Y.add(o),console.warn(`[SpringKit] ${o}`));}function L(o){if(!O)return;let{stiffness:e=100,damping:t=10,mass:i=1}=o;e>400&&t<10&&P(`High stiffness (${e}) with low damping (${t}) may cause excessive oscillation. Consider increasing damping to at least ${Math.round(e/20)} for smoother animation.`),e<20&&P(`Very low stiffness (${e}) will result in sluggish animation. Consider using stiffness >= 50 for more responsive feel.`),t>e&&P(`Damping (${t}) is higher than stiffness (${e}), which removes the "springy" feel. Consider reducing damping for bouncier animation.`),i<=0&&P(`Mass must be positive. Got ${i}. Using default mass of 1.`),i>10&&P(`High mass (${i}) will make the animation very slow. Consider mass between 0.5 and 5 for typical use cases.`);}var w=class{constructor(e,t,i={}){this.state="idle";this.resolveComplete=null;L(i),this.from=e,this.to=t,this.clampedFrom=e,this.clampedTo=t,this.position=e,this.velocity=i.velocity??0,this.target=t,this.config={...b,...i,stiffness:i.stiffness??b.stiffness,damping:i.damping??b.damping,mass:i.mass??b.mass,restSpeed:i.restSpeed??b.restSpeed,restDelta:i.restDelta??b.restDelta},this.finished=new Promise(n=>{this.resolveComplete=n;});}start(){return this.state==="running"?this:(this.state="running",this.config.onStart?.(),x.add(this),this)}stop(){this.state="idle",x.remove(this);}pause(){this.state==="running"&&(this.state="paused",x.remove(this));}resume(){this.state==="paused"&&(this.state="running",x.add(this));}reverse(){let e=this.from;this.from=this.to,this.to=e,this.clampedFrom=this.from,this.clampedTo=this.to,this.target=this.to;}set(e){this.to=e,this.clampedTo=e,this.target=e;}setWithVelocity(e,t){this.from=this.position,this.clampedFrom=this.position,this.to=e,this.clampedTo=e,this.target=e,t!==void 0&&(this.velocity=t),this.state!=="running"&&this.start();}update(e){if(this.state!=="running")return;let t=G(this.position,this.velocity,this.target,this.config);if(this.position=t.position,this.velocity=t.velocity,this.config.clamp){let i=Math.min(this.clampedFrom,this.clampedTo),n=Math.max(this.clampedFrom,this.clampedTo);this.position=C(this.position,i,n);}this.config.onUpdate?.(this.position),t.isRest&&(this.state="complete",x.remove(this),this.position=this.target,this.config.onUpdate?.(this.position),this.config.onComplete?.(),this.config.onRest?.(),this.resolveComplete?.());}isAnimating(){return this.state==="running"}isPaused(){return this.state==="paused"}isComplete(){return this.state==="complete"}getValue(){return this.position}getVelocity(){return this.velocity}destroy(){this.stop(),this.config.onUpdate=void 0,this.config.onStart=void 0,this.config.onComplete=void 0,this.config.onRest=void 0;}};function B(o,e,t){return new w(o,e,t)}var E=class{constructor(e,t={}){this.currentAnimation=null;this.subscribers=new Set;this.resolveComplete=null;this.value=e,this.config={...b,...t},this.finishedPromise=new Promise(i=>{this.resolveComplete=i;});}get(){return this.value}getVelocity(){return this.currentAnimation?.getVelocity()??0}set(e,t={}){this.currentAnimation&&(this.currentAnimation.destroy(),this.currentAnimation=null),this.finishedPromise=new Promise(s=>{this.resolveComplete=s;});let i={...this.config,...t},n=i.onUpdate,r=i.onComplete;this.currentAnimation=B(this.value,e,{...i,onUpdate:s=>{this.value=s,this.notify(),n?.(s);},onComplete:()=>{r?.(),this.resolveComplete&&this.resolveComplete();}}),this.currentAnimation.start();}jump(e){this.currentAnimation&&(this.currentAnimation.destroy(),this.currentAnimation=null),this.value=e,this.notify();}subscribe(e){return this.subscribers.add(e),e(this.value),()=>{this.subscribers.delete(e);}}isAnimating(){return this.currentAnimation?.isAnimating()??false}get finished(){return this.finishedPromise}notify(){for(let e of this.subscribers)e(this.value);}destroy(){this.currentAnimation?.destroy(),this.currentAnimation=null,this.subscribers.clear();}};function h(o,e){return new E(o,e)}var V=class{constructor(e,t={}){this.subscribers=new Set;this.resolveComplete=null;this.config={...b,...t},this.values=new Map;for(let[i,n]of Object.entries(e)){let r=h(n,this.config);r.subscribe(()=>this.notify()),this.values.set(i,r);}this.finishedPromise=Promise.resolve(),this.resetPromise();}resetPromise(){this.finishedPromise=new Promise(e=>{this.resolveComplete=e;});}get(){let e={};for(let[t,i]of this.values)e[t]=i.get();return e}getValue(e){return this.values.get(e)?.get()??0}set(e,t={}){this.resetPromise();let i=[];for(let[n,r]of Object.entries(e)){let s=this.values.get(n);s&&(s.set(r,t),i.push(s.finished));}Promise.all(i).then(()=>{this.resolveComplete&&this.resolveComplete();});}jump(e){for(let[t,i]of Object.entries(e)){let n=this.values.get(t);n&&n.jump(i);}}subscribe(e){return this.subscribers.add(e),e(this.get()),()=>this.subscribers.delete(e)}isAnimating(){for(let e of this.values.values())if(e.isAnimating())return  true;return  false}get finished(){return this.finishedPromise}notify(){let e=this.get();for(let t of this.subscribers)t(e);}destroy(){for(let e of this.values.values())e.destroy();this.subscribers.clear();}};function v(o,e){return new V(o,e)}var M=class{constructor(e,t={}){this.subscribers=new Set;this.frameCount=0;this.pendingUpdates=new Map;let{followDelay:i=2,...n}=t;this.followDelay=i,this.leader=h(0,n),this.springs=[];for(let r=0;r<e;r++){let s=h(0,n);this.springs.push(s);}this.leader.subscribe(()=>{this.frameCount++,this.scheduleFollowerUpdates();});}scheduleFollowerUpdates(){let e=this.leader.get();for(let t=0;t<this.springs.length;t++){let i=(t+1)*this.followDelay,n=this.frameCount+i;this.pendingUpdates.set(t,n),this.scheduleFollowerUpdate(t,e,n,i);}}scheduleFollowerUpdate(e,t,i,n){let r=this.frameCount,s=i-r;if(s<=0)this.springs[e].set(t);else {let m=Math.max(s*16,0);setTimeout(()=>{this.pendingUpdates.get(e)===i&&this.springs[e].set(t);},m);}}set(e){this.leader.set(e);}jump(e){this.leader.jump(e);for(let t of this.springs)t.jump(e);}getValues(){return this.springs.map(e=>e.get())}subscribe(e){this.subscribers.add(e);let t=[];for(let i of this.springs)t.push(i.subscribe(()=>{this.notify();}));return e(this.getValues()),()=>{this.subscribers.delete(e);for(let i of t)i();}}notify(){let e=this.getValues();for(let t of this.subscribers)t(e);}destroy(){this.leader.destroy();for(let e of this.springs)e.destroy();this.subscribers.clear(),this.pendingUpdates.clear();}};function A(o,e){return new M(o,e)}var Q={axis:"both",rubberBand:false,rubberBandFactor:.5,stiffness:200,damping:20,mass:1,restSpeed:.01,restDelta:.01,clamp:false},U=class{constructor(e,t={}){this.enabled=true;this.position={x:0,y:0};this.isDragging=false;this.startPosition={x:0,y:0};this.pointerStart={x:0,y:0};this.lastPosition={x:0,y:0};this.lastTime=0;this.velocity={x:0,y:0};this.onPointerDown=e=>{!this.enabled||e.button!==0||(this.isDragging=true,this.startPosition={...this.position},this.pointerStart={x:e.clientX,y:e.clientY},this.lastPosition={x:e.clientX,y:e.clientY},this.lastTime=performance.now(),this.velocity={x:0,y:0},this.element.setPointerCapture(e.pointerId),this.element.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp),this.element.addEventListener("pointercancel",this.onPointerUp),this.config.onDragStart&&this.config.onDragStart(e));};this.onPointerMove=e=>{let t=performance.now(),i=t-this.lastTime;this.velocity={x:(e.clientX-this.lastPosition.x)/Math.max(i,1),y:(e.clientY-this.lastPosition.y)/Math.max(i,1)},this.lastPosition={x:e.clientX,y:e.clientY},this.lastTime=t;let n=this.startPosition.x+(e.clientX-this.pointerStart.x),r=this.startPosition.y+(e.clientY-this.pointerStart.y);this.config.bounds&&(n=this.applyBounds(n,this.config.bounds.left??-1/0,this.config.bounds.right??1/0),r=this.applyBounds(r,this.config.bounds.top??-1/0,this.config.bounds.bottom??1/0)),this.config.axis==="x"?r=0:this.config.axis==="y"&&(n=0),this.position={x:n,y:r},this.config.onDrag&&this.config.onDrag(n,r,e),this.config.onUpdate&&this.config.onUpdate(n,r);};this.onPointerUp=e=>{this.isDragging=false,this.element.releasePointerCapture(e.pointerId),this.element.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp),this.element.removeEventListener("pointercancel",this.onPointerUp),this.release(this.velocity.x*16,this.velocity.y*16),this.config.onDragEnd&&this.config.onDragEnd(this.position.x,this.position.y,this.velocity);};this.element=e,this.config={...Q,...t};let i={stiffness:this.config.stiffness,damping:this.config.damping,mass:this.config.mass,restSpeed:this.config.restSpeed,restDelta:this.config.restDelta,clamp:this.config.clamp};this.springX=h(0,i),this.springY=h(0,i),this.springX.subscribe(()=>{this.isDragging||(this.position.x=this.springX.get(),this.config.onUpdate&&this.config.onUpdate(this.position.x,this.position.y));}),this.springY.subscribe(()=>{this.isDragging||(this.position.y=this.springY.get(),this.config.onUpdate&&this.config.onUpdate(this.position.x,this.position.y));}),this.setupPointerEvents();}setupPointerEvents(){this.element.addEventListener("pointerdown",this.onPointerDown);}applyBounds(e,t,i){if(!isFinite(t)&&!isFinite(i))return e;let n=isFinite(t)?t:-1/0,r=isFinite(i)?i:1/0;if(this.config.rubberBand){let s=this.config.rubberBandFactor||.5;if(e<n)return n-(n-e)*s;if(e>r)return r+(e-r)*s}return C(e,n,r)}enable(){this.enabled=true;}disable(){this.enabled=false,this.isDragging&&(this.isDragging=false);}isEnabled(){return this.enabled}reset(){this.springX.jump(0),this.springY.jump(0),this.position={x:0,y:0},this.config.onUpdate&&this.config.onUpdate(0,0);}getPosition(){return {...this.position}}setPosition(e,t){this.position={x:e,y:t},this.springX.jump(e),this.springY.jump(t);}release(e,t){if(this.config.bounds){let{left:i=-1/0,right:n=1/0,top:r=-1/0,bottom:s=1/0}=this.config.bounds,m=C(this.position.x,i,n),a=C(this.position.y,r,s);m!==this.position.x&&this.springX.set(m,{velocity:e}),a!==this.position.y&&this.springY.set(a,{velocity:t});}}destroy(){this.element.removeEventListener("pointerdown",this.onPointerDown),this.springX.destroy(),this.springY.destroy();}};function F(o,e){return new U(o,e)}function ee(o,e={}){let t=useRef(null),[,i]=useState({}),n=useRef(true),r=useRef(JSON.stringify(o));return t.current||(t.current=v(o,e),t.current.subscribe(()=>i({}))),useEffect(()=>{if(n.current){n.current=false;return}let s=JSON.stringify(o);s!==r.current&&(t.current?.set(o,e),r.current=s);},[JSON.stringify(o)]),useEffect(()=>()=>t.current?.destroy(),[]),t.current.get()}function ne(o,e={}){let t=useRef(null);return t.current||(t.current=h(o,e)),useEffect(()=>()=>t.current?.destroy(),[]),t.current}function ae(o,e,t={}){let i=useRef([]),[,n]=useState({});return useEffect(()=>{i.current.forEach(r=>r?.destroy()),i.current=[];for(let r=0;r<o;r++){let s=e(r),m=s.from??s.values,a=v(m,{...t,...s.config});a.subscribe(()=>n({})),i.current.push(a),setTimeout(()=>{a.set(s.values);},s.delay??0);}return ()=>{i.current.forEach(r=>r?.destroy());}},[o,t]),i.current.map(r=>r?.get()??{})}function pe(o,e,t={}){let i=useRef(null),[n,r]=useState(()=>Array.from({length:o},()=>({...e}))),s=useRef(true),m=useRef(JSON.stringify(e));return useEffect(()=>{let a=Object.keys(e),f=new Map;a.forEach(p=>{let u=[],d=e[p];for(let g=0;g<o;g++){let y=h(d,t);u.push(y);}f.set(p,u);}),i.current=f;let c=[];return f.forEach((p,u)=>{p.forEach((d,g)=>{let y=d.subscribe(()=>{r(T=>{let S=[...T];S[g]||(S[g]={...e});let R={...S[g]};return f.forEach((J,K)=>{R[K]=J[g].get();}),S[g]=R,S});});c.push(y);});}),()=>{c.forEach(p=>p()),f.forEach(p=>{p.forEach(u=>u.destroy());}),i.current=null;}},[o]),useEffect(()=>{if(!i.current)return;let a=JSON.stringify(e);if(s.current){s.current=false,m.current=a;return}if(a===m.current)return;m.current=a;let f=Object.keys(e),c=50;f.forEach(p=>{let u=i.current?.get(p);if(!u)return;let d=e[p];u.forEach((g,y)=>{setTimeout(()=>{g.set(d,t);},y*c);});});},[JSON.stringify(e),t.stiffness,t.damping]),n}function le(o={}){let e=useRef(null),t=useRef({x:0,y:0}),[i,n]=useState(null),[r,s]=useState(false),[,m]=useState({}),a=useRef(o);a.current=o;let f=u=>{n(u);};useEffect(()=>(e.current&&(e.current.destroy(),e.current=null),i&&(e.current=F(i,{...a.current,onDragStart:u=>{s(true),a.current.onDragStart?.(u);},onDragEnd:(u,d,g)=>{s(false),a.current.onDragEnd?.(u,d,g);},onUpdate:(u,d)=>{t.current={x:u,y:d},m({}),a.current.onUpdate?.(u,d);}})),()=>{e.current?.destroy(),e.current=null;}),[i]);let c=u=>{let d=u.x??t.current.x,g=u.y??t.current.y;e.current?.setPosition(d,g);},p=()=>{e.current?.reset(),t.current={x:0,y:0},m({});};return [t.current,{ref:f,set:c,reset:p,isDragging:r}]}function fe(o){let e=useRef({isDragging:false,startX:0,startY:0,currentX:0,currentY:0});return {onPointerDown:s=>{e.current={isDragging:true,startX:s.clientX,startY:s.clientY,currentX:s.clientX,currentY:s.clientY};},onPointerMove:s=>{if(!e.current.isDragging)return;let m=s.clientX-e.current.startX,a=s.clientY-e.current.startY;o.onDrag?.({x:m,y:a}),e.current.currentX=s.clientX,e.current.currentY=s.clientY;},onPointerUp:()=>{e.current.isDragging=false;},onPointerCancel:()=>{e.current.isDragging=false;}}}var he=({from:o,to:e,config:t={},onRest:i,children:n})=>{let r=useRef(null),[s,m]=useState(o);return useEffect(()=>{let a=v(o,t);return a.subscribe(m),r.current=a,requestAnimationFrame(()=>{a.set(e,{...t,onRest:i});}),()=>a.destroy()},[]),useEffect(()=>{r.current?.set(e,{...t,onRest:i});},[e,t,i]),jsx(Fragment,{children:n(s)})};function l(o){return N.forwardRef(({children:e,style:t={},config:i={},...n},r)=>{let s=useRef(null),[m,a]=useState({}),f=Object.fromEntries(Object.entries(t).filter(p=>typeof p[1]=="number"));useEffect(()=>{let p=v(Object.fromEntries(Object.keys(f).map(u=>[u,0])),i);return p.subscribe(u=>{a(u);}),s.current=p,()=>p.destroy()},[i.stiffness,i.damping]),useEffect(()=>{s.current?.set(f);},[f]);let c=Object.fromEntries(Object.entries(t).filter(([p,u])=>typeof u!="number"));return N.createElement(o,{...n,ref:r,style:{...c,...m}},e)})}var xe={div:l("div"),span:l("span"),button:l("button"),a:l("a"),p:l("p"),h1:l("h1"),h2:l("h2"),h3:l("h3"),h4:l("h4"),h5:l("h5"),h6:l("h6"),ul:l("ul"),ol:l("ol"),li:l("li"),section:l("section"),article:l("article"),header:l("header"),footer:l("footer"),nav:l("nav"),main:l("main"),aside:l("aside"),img:l("img")};var Re=({items:o,keys:e,from:t,to:i,config:n={},reverse:r=false,children:s})=>{let m=useRef(null),[a,f]=useState(()=>o.map(()=>({...t})));return useEffect(()=>{let c=A(o.length,n),p=c.subscribe(d=>{f(d.map(g=>({...i,x:g})));});m.current=c;let u=Object.values(i)[0];return c.set(u),()=>{p(),c.destroy();}},[o.length,n.stiffness,n.damping]),useEffect(()=>{let c=Object.values(i)[0];m.current?.set(c);},[i]),jsx(Fragment,{children:o.map((c,p)=>jsx(N.Fragment,{children:s(a[p],c,r?o.length-1-p:p)},e(c,p)))})};export{xe as Animated,he as Spring,Re as Trail,le as useDrag,fe as useGesture,ee as useSpring,ne as useSpringValue,ae as useSprings,pe as useTrail};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map