import G,{useRef,useState,useEffect}from'react';import {jsx,Fragment}from'react/jsx-runtime';var g={stiffness:100,damping:10,mass:1,velocity:0,restSpeed:.01,restDelta:.01,clamp:false};function M(o,e,t,i){let{stiffness:n=100,damping:s=10,mass:r=1,restSpeed:m=.01,restDelta:a=.01}=i,c=1/60,u=t-o,l=n*u,f=s*e,x=(l-f)/r,y=e+x*c,k=o+y*c,H=Math.abs(u)<=a&&Math.abs(y)<=m;return {position:k,velocity:y,isRest:H}}var P=class{constructor(){this.animations=new Set;this.rafId=null;this.isRunning=false;this.tick=()=>{let e=performance.now();for(let i of this.animations)i.update(e);let t=[];for(let i of this.animations)i.isComplete()&&t.push(i);for(let i of t)this.animations.delete(i);this.animations.size>0?this.rafId=requestAnimationFrame(this.tick):this.stop();};}add(e){this.animations.add(e),this.start();}remove(e){this.animations.delete(e),this.animations.size===0&&this.stop();}start(){this.isRunning||(this.isRunning=true,this.tick());}stop(){this.isRunning=false,this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null);}get size(){return this.animations.size}},b=new P;function v(o,e,t){let i=Math.min(e,t),n=Math.max(e,t);return Math.max(i,Math.min(n,o))}var C=class{constructor(e,t,i={}){this.state="idle";this.resolveComplete=null;this.from=e,this.to=t,this.clampedFrom=e,this.clampedTo=t,this.position=e,this.velocity=i.velocity??0,this.target=t,this.config={...g,...i,stiffness:i.stiffness??g.stiffness,damping:i.damping??g.damping,mass:i.mass??g.mass,restSpeed:i.restSpeed??g.restSpeed,restDelta:i.restDelta??g.restDelta},this.finished=new Promise(n=>{this.resolveComplete=n;});}start(){return this.state==="running"?this:(this.state="running",this.config.onStart?.(),b.add(this),this)}stop(){this.state="idle",b.remove(this);}pause(){this.state==="running"&&(this.state="paused",b.remove(this));}resume(){this.state==="paused"&&(this.state="running",b.add(this));}reverse(){let e=this.from;this.from=this.to,this.to=e,this.clampedFrom=this.from,this.clampedTo=this.to,this.target=this.to;}set(e){this.to=e,this.clampedTo=e,this.target=e;}update(e){if(this.state!=="running")return;let t=M(this.position,this.velocity,this.target,this.config);if(this.position=t.position,this.velocity=t.velocity,this.config.clamp){let i=Math.min(this.clampedFrom,this.clampedTo),n=Math.max(this.clampedFrom,this.clampedTo);this.position=v(this.position,i,n);}this.config.onUpdate?.(this.position),t.isRest&&(this.state="complete",b.remove(this),this.position=this.target,this.config.onUpdate?.(this.position),this.config.onComplete?.(),this.config.onRest?.(),this.resolveComplete?.());}isAnimating(){return this.state==="running"}isPaused(){return this.state==="paused"}isComplete(){return this.state==="complete"}getValue(){return this.position}getVelocity(){return this.velocity}destroy(){this.stop(),this.config.onUpdate=void 0,this.config.onStart=void 0,this.config.onComplete=void 0,this.config.onRest=void 0;}};function U(o,e,t){return new C(o,e,t)}var T=class{constructor(e,t={}){this.currentAnimation=null;this.subscribers=new Set;this.resolveComplete=null;this.value=e,this.config={...g,...t},this.finishedPromise=new Promise(i=>{this.resolveComplete=i;});}get(){return this.value}getVelocity(){return this.currentAnimation?.getVelocity()??0}set(e,t={}){this.currentAnimation&&(this.currentAnimation.destroy(),this.currentAnimation=null),this.finishedPromise=new Promise(r=>{this.resolveComplete=r;});let i={...this.config,...t},n=i.onUpdate,s=i.onComplete;this.currentAnimation=U(this.value,e,{...i,onUpdate:r=>{this.value=r,this.notify(),n?.(r);},onComplete:()=>{s?.(),this.resolveComplete&&this.resolveComplete();}}),this.currentAnimation.start();}jump(e){this.currentAnimation&&(this.currentAnimation.destroy(),this.currentAnimation=null),this.value=e,this.notify();}subscribe(e){return this.subscribers.add(e),e(this.value),()=>{this.subscribers.delete(e);}}isAnimating(){return this.currentAnimation?.isAnimating()??false}get finished(){return this.finishedPromise}notify(){for(let e of this.subscribers)e(this.value);}destroy(){this.currentAnimation?.destroy(),this.currentAnimation=null,this.subscribers.clear();}};function d(o,e){return new T(o,e)}var R=class{constructor(e,t={}){this.subscribers=new Set;this.resolveComplete=null;this.config={...g,...t},this.values=new Map;for(let[i,n]of Object.entries(e)){let s=d(n,this.config);s.subscribe(()=>this.notify()),this.values.set(i,s);}this.finishedPromise=Promise.resolve(),this.resetPromise();}resetPromise(){this.finishedPromise=new Promise(e=>{this.resolveComplete=e;});}get(){let e={};for(let[t,i]of this.values)e[t]=i.get();return e}getValue(e){return this.values.get(e)?.get()??0}set(e,t={}){this.resetPromise();let i=[];for(let[n,s]of Object.entries(e)){let r=this.values.get(n);r&&(r.set(s,t),i.push(r.finished));}Promise.all(i).then(()=>{this.resolveComplete&&this.resolveComplete();});}jump(e){for(let[t,i]of Object.entries(e)){let n=this.values.get(t);n&&n.jump(i);}}subscribe(e){return this.subscribers.add(e),e(this.get()),()=>this.subscribers.delete(e)}isAnimating(){for(let e of this.values.values())if(e.isAnimating())return  true;return  false}get finished(){return this.finishedPromise}notify(){let e=this.get();for(let t of this.subscribers)t(e);}destroy(){for(let e of this.values.values())e.destroy();this.subscribers.clear();}};function h(o,e){return new R(o,e)}var D=class{constructor(e,t={}){this.subscribers=new Set;this.frameCount=0;this.pendingUpdates=new Map;let{followDelay:i=2,...n}=t;this.followDelay=i,this.leader=d(0,n),this.springs=[];for(let s=0;s<e;s++){let r=d(0,n);this.springs.push(r);}this.leader.subscribe(()=>{this.frameCount++,this.scheduleFollowerUpdates();});}scheduleFollowerUpdates(){let e=this.leader.get();for(let t=0;t<this.springs.length;t++){let i=(t+1)*this.followDelay,n=this.frameCount+i;this.pendingUpdates.set(t,n),this.scheduleFollowerUpdate(t,e,n,i);}}scheduleFollowerUpdate(e,t,i,n){let s=this.frameCount,r=i-s;if(r<=0)this.springs[e].set(t);else {let m=Math.max(r*16,0);setTimeout(()=>{this.pendingUpdates.get(e)===i&&this.springs[e].set(t);},m);}}set(e){this.leader.set(e);}jump(e){this.leader.jump(e);for(let t of this.springs)t.jump(e);}getValues(){return this.springs.map(e=>e.get())}subscribe(e){this.subscribers.add(e);let t=[];for(let i of this.springs)t.push(i.subscribe(()=>{this.notify();}));return e(this.getValues()),()=>{this.subscribers.delete(e);for(let i of t)i();}}notify(){let e=this.getValues();for(let t of this.subscribers)t(e);}destroy(){this.leader.destroy();for(let e of this.springs)e.destroy();this.subscribers.clear(),this.pendingUpdates.clear();}};function S(o,e){return new D(o,e)}var B={axis:"both",rubberBand:false,rubberBandFactor:.5,stiffness:200,damping:20,mass:1,restSpeed:.01,restDelta:.01,clamp:false},V=class{constructor(e,t={}){this.enabled=true;this.position={x:0,y:0};this.isDragging=false;this.startPosition={x:0,y:0};this.pointerStart={x:0,y:0};this.lastPosition={x:0,y:0};this.lastTime=0;this.velocity={x:0,y:0};this.onPointerDown=e=>{!this.enabled||e.button!==0||(this.isDragging=true,this.startPosition={...this.position},this.pointerStart={x:e.clientX,y:e.clientY},this.lastPosition={x:e.clientX,y:e.clientY},this.lastTime=performance.now(),this.velocity={x:0,y:0},this.element.setPointerCapture(e.pointerId),this.element.addEventListener("pointermove",this.onPointerMove),this.element.addEventListener("pointerup",this.onPointerUp),this.element.addEventListener("pointercancel",this.onPointerUp),this.config.onDragStart&&this.config.onDragStart(e));};this.onPointerMove=e=>{let t=performance.now(),i=t-this.lastTime;this.velocity={x:(e.clientX-this.lastPosition.x)/Math.max(i,1),y:(e.clientY-this.lastPosition.y)/Math.max(i,1)},this.lastPosition={x:e.clientX,y:e.clientY},this.lastTime=t;let n=this.startPosition.x+(e.clientX-this.pointerStart.x),s=this.startPosition.y+(e.clientY-this.pointerStart.y);this.config.bounds&&(n=this.applyBounds(n,this.config.bounds.left??-1/0,this.config.bounds.right??1/0),s=this.applyBounds(s,this.config.bounds.top??-1/0,this.config.bounds.bottom??1/0)),this.config.axis==="x"?s=0:this.config.axis==="y"&&(n=0),this.position={x:n,y:s},this.config.onDrag&&this.config.onDrag(n,s,e),this.config.onUpdate&&this.config.onUpdate(n,s);};this.onPointerUp=e=>{this.isDragging=false,this.element.releasePointerCapture(e.pointerId),this.element.removeEventListener("pointermove",this.onPointerMove),this.element.removeEventListener("pointerup",this.onPointerUp),this.element.removeEventListener("pointercancel",this.onPointerUp),this.release(this.velocity.x*16,this.velocity.y*16),this.config.onDragEnd&&this.config.onDragEnd(this.position.x,this.position.y,this.velocity);};this.element=e,this.config={...B,...t};let i={stiffness:this.config.stiffness,damping:this.config.damping,mass:this.config.mass,restSpeed:this.config.restSpeed,restDelta:this.config.restDelta,clamp:this.config.clamp};this.springX=d(0,i),this.springY=d(0,i),this.springX.subscribe(()=>{this.isDragging||(this.position.x=this.springX.get(),this.config.onUpdate&&this.config.onUpdate(this.position.x,this.position.y));}),this.springY.subscribe(()=>{this.isDragging||(this.position.y=this.springY.get(),this.config.onUpdate&&this.config.onUpdate(this.position.x,this.position.y));}),this.setupPointerEvents();}setupPointerEvents(){this.element.addEventListener("pointerdown",this.onPointerDown);}applyBounds(e,t,i){if(!isFinite(t)&&!isFinite(i))return e;let n=isFinite(t)?t:-1/0,s=isFinite(i)?i:1/0;if(this.config.rubberBand){let r=this.config.rubberBandFactor||.5;if(e<n)return n-(n-e)*r;if(e>s)return s+(e-s)*r}return v(e,n,s)}enable(){this.enabled=true;}disable(){this.enabled=false,this.isDragging&&(this.isDragging=false);}isEnabled(){return this.enabled}reset(){this.springX.jump(0),this.springY.jump(0),this.position={x:0,y:0},this.config.onUpdate&&this.config.onUpdate(0,0);}getPosition(){return {...this.position}}setPosition(e,t){this.position={x:e,y:t},this.springX.jump(e),this.springY.jump(t);}release(e,t){if(this.config.bounds){let{left:i=-1/0,right:n=1/0,top:s=-1/0,bottom:r=1/0}=this.config.bounds,m=v(this.position.x,i,n),a=v(this.position.y,s,r);m!==this.position.x&&this.springX.set(m,{velocity:e}),a!==this.position.y&&this.springY.set(a,{velocity:t});}}destroy(){this.element.removeEventListener("pointerdown",this.onPointerDown),this.springX.destroy(),this.springY.destroy();}};function E(o,e){return new V(o,e)}function N(o,e={}){let t=useRef(null),[,i]=useState({}),n=useRef(true),s=useRef(JSON.stringify(o));return t.current||(t.current=h(o,e),t.current.subscribe(()=>i({}))),useEffect(()=>{if(n.current){n.current=false;return}let r=JSON.stringify(o);r!==s.current&&(t.current?.set(o,e),s.current=r);},[JSON.stringify(o)]),useEffect(()=>()=>t.current?.destroy(),[]),t.current.get()}function J(o,e={}){let t=useRef(null);return t.current||(t.current=d(o,e)),useEffect(()=>()=>t.current?.destroy(),[]),t.current}function Z(o,e,t={}){let i=useRef([]),[,n]=useState({});return useEffect(()=>{i.current.forEach(s=>s?.destroy()),i.current=[];for(let s=0;s<o;s++){let r=e(s),m=r.from??r.values,a=h(m,{...t,...r.config});a.subscribe(()=>n({})),i.current.push(a),setTimeout(()=>{a.set(r.values);},r.delay??0);}return ()=>{i.current.forEach(s=>s?.destroy());}},[o,t]),i.current.map(s=>s?.get()??{})}function te(o,e,t={}){let i=useRef(null),[n,s]=useState(()=>Array.from({length:o},()=>({...e})));return useEffect(()=>{i.current=S(o,t);let r=i.current.subscribe(a=>{s(a.map(c=>({...e,x:c})));}),m=Object.values(e)[0];return i.current.set(m),()=>{r(),i.current?.destroy();}},[o,t.stiffness,t.damping]),useEffect(()=>{let r=Object.values(e)[0];i.current?.set(r);},[e]),n}function ne(o={}){let e=useRef(null),t=useRef({x:0,y:0}),[i,n]=useState(null),[,s]=useState({}),r=useRef(o);r.current=o;let m=u=>{n(u);};useEffect(()=>(e.current&&(e.current.destroy(),e.current=null),i&&(e.current=E(i,{...r.current,onUpdate:(u,l)=>{t.current={x:u,y:l},s({}),r.current.onUpdate?.(u,l);}})),()=>{e.current?.destroy(),e.current=null;}),[i]);let a=u=>{let l=u.x??t.current.x,f=u.y??t.current.y;e.current?.setPosition(l,f);},c=()=>{e.current?.reset(),t.current={x:0,y:0},s({});};return [t.current,{ref:m,set:a,reset:c}]}function se(o){let e=useRef({isDragging:false,startX:0,startY:0,currentX:0,currentY:0});return {onPointerDown:r=>{e.current={isDragging:true,startX:r.clientX,startY:r.clientY,currentX:r.clientX,currentY:r.clientY};},onPointerMove:r=>{if(!e.current.isDragging)return;let m=r.clientX-e.current.startX,a=r.clientY-e.current.startY;o.onDrag?.({x:m,y:a}),e.current.currentX=r.clientX,e.current.currentY=r.clientY;},onPointerUp:()=>{e.current.isDragging=false;},onPointerCancel:()=>{e.current.isDragging=false;}}}var ue=({from:o,to:e,config:t={},onRest:i,children:n})=>{let s=useRef(null),[r,m]=useState(o);return useEffect(()=>{let a=h(o,t);return a.subscribe(m),s.current=a,requestAnimationFrame(()=>{a.set(e,{...t,onRest:i});}),()=>a.destroy()},[]),useEffect(()=>{s.current?.set(e,{...t,onRest:i});},[e,t,i]),jsx(Fragment,{children:n(r)})};function p(o){return G.forwardRef(({children:e,style:t={},config:i={},...n},s)=>{let r=useRef(null),[m,a]=useState({}),c=Object.fromEntries(Object.entries(t).filter(l=>typeof l[1]=="number"));useEffect(()=>{let l=h(Object.fromEntries(Object.keys(c).map(f=>[f,0])),i);return l.subscribe(f=>{a(f);}),r.current=l,()=>l.destroy()},[i.stiffness,i.damping]),useEffect(()=>{r.current?.set(c);},[c]);let u=Object.fromEntries(Object.entries(t).filter(([l,f])=>typeof f!="number"));return G.createElement(o,{...n,ref:s,style:{...u,...m}},e)})}var fe={div:p("div"),span:p("span"),button:p("button"),a:p("a"),p:p("p"),h1:p("h1"),h2:p("h2"),h3:p("h3"),h4:p("h4"),h5:p("h5"),h6:p("h6"),ul:p("ul"),ol:p("ol"),li:p("li"),section:p("section"),article:p("article"),header:p("header"),footer:p("footer"),nav:p("nav"),main:p("main"),aside:p("aside"),img:p("img")};var be=({items:o,keys:e,from:t,to:i,config:n={},reverse:s=false,children:r})=>{let m=useRef(null),[a,c]=useState(()=>o.map(()=>({...t})));return useEffect(()=>{let u=S(o.length,n),l=u.subscribe(x=>{c(x.map(y=>({...i,x:y})));});m.current=u;let f=Object.values(i)[0];return u.set(f),()=>{l(),u.destroy();}},[o.length,n.stiffness,n.damping]),useEffect(()=>{let u=Object.values(i)[0];m.current?.set(u);},[i]),jsx(Fragment,{children:o.map((u,l)=>jsx(G.Fragment,{children:r(a[l],u,s?o.length-1-l:l)},e(u,l)))})};export{fe as Animated,ue as Spring,be as Trail,ne as useDrag,se as useGesture,N as useSpring,J as useSpringValue,Z as useSprings,te as useTrail};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map